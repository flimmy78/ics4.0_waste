                                                                                      
                                                            

                          
                      
                      
                             
                                           
                


                                                      
                                                         

                                                                               
#include <sql.h>
#define   FmpSrcLen     22                 
#define   FmpValLen     32                 
#define   MaxLen         8               

                                                                               

                                              
 
                       
                
                 
                     
                               
            
            

                                
                                                                        
                              
                                                                                
   
                                                                               

#ifndef _LIB_BASE_H_
#define _LIB_BASE_H_

#ifdef DEBUG
 extern void hassert(char *FileName, int LineNo);
 #define HASSERT(f) \
  if(f) \
   hdonothing(); \
  else \
   hassert(__FILE__, __LINE__)
#else   
 #define HASSERT(f) hdonothing()
#endif

#include <stdlib.h>
#include <stdio.h>
                               
#ifndef _H_STDARG
#include <stdarg.h>
#endif
#include <time.h>
#include <string.h>
#include <errno.h>
#include <fcntl.h>
#include <netdb.h>
#include <signal.h>
#include <unistd.h>
#include <sys/time.h>
#include <sys/timeb.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <sys/signal.h>
#include <sys/sem.h>
#include <sys/ipc.h>
#include <sys/socket.h>
#include <sys/socketvar.h>
#include <netinet/in.h>
#include <netinet/tcp.h>
#include <arpa/inet.h>

#ifndef _HP_SYSTEM_
#include <sys/select.h>
#endif

                    
                                                            
#define SYS_LOG_FILE "SYS.log"

                        
                             
#define LOG_DIR "log"
#define TRC_DIR "trc"

                          
#define LEFT "left"
#define RIGHT "right"
#define BOTH "both"
#define ALL "all"

#ifdef LIB_BASE_EXTERN
#define EXTERN
#else
#define EXTERN extern
#endif                      

char _local_ip[15+1];

#ifndef TRUE
#define TRUE 1
#endif
#ifndef FALSE
#define FALSE 0
#endif

                    

EXTERN char *hamtadddot(char *);
                                                                               
                                
                                      
                                           
                                
                                                                               

EXTERN int  hamttocap(char *);
                                                                               
                               
                                  
                                           
                                     
                                                                               

EXTERN int  hamtdelzero(char *);
                                                                               
                                 
                                             
                                           
                                     
                                                                               

EXTERN int  hamtfmt(char *);
                                                                               
                             
                                                                   
                                           
                                     
                                                                               

EXTERN int  hamtsimplefmt(char *);
                                                                               
                                   
                                                          
                                           
                                     
                                                                               

                    

EXTERN void hhextoasc(char *, char *, int);
                                                                               
                               
                                                           
                                           
                                        
                                                  
                      
                                                                               

EXTERN void hasctohex(char *, char *, int);
                                                                               
                               
                                                           
                                           
                                        
                                                  
                      
                                                                               

EXTERN int  hinttostr(int, char *, int);
                                                                               
                               
                                                
                                     
                                    
                        
                                     
                                                                               

EXTERN int  hbintoshort(unsigned char *, int len, short *);
                                                                               
                                 
                                            
                                         
                                    
                                
                                     
                                                                               

EXTERN int  hbintolong(unsigned char *, int len, long *);
                                                                               
                                
                                            
                                         
                                    
                                
                                     
                                                                               

EXTERN int  hshorttobin(short, int, unsigned char *);
                                                                               
                                 
                                        
                                     
                                          
                                      
                                     
                                                                               

EXTERN int  hlongtobin(long, int, unsigned char *);
                                                                               
                                
                                        
                                     
                                          
                                      
                                     
                                                                               

EXTERN short hshortswap(short);
                                                                               
                                
                                    
                                    
                                    
                                                                               

EXTERN long hlongswap(long);
                                                                               
                               
                                    
                                    
                                    
                                                                               

                     

EXTERN int  hisleapyear(int);
                                                                               
                                 
                                  
                                 
                                   
                                                                               

EXTERN int  hisvaliddate(char *);
                                                                               
                                  
                                                       
                                       
                                   
                                                                               

EXTERN int  hgettoday(char *);
                                                                               
                               
                                         
                                               
                                     
                                                                               

EXTERN int  hgetdatetime(char *);
                                                                               
                                  
                                                                           
                                                   
                                     
                                                                               

EXTERN int  hfmtdate(char *,char *, char *, char *);
                                                                               
                              
                                                  
                                           
                            
                            
                            
                                     
                                                    
                                  
                       
                 
                                                                               

EXTERN int  hcalcdate(char *, int, char, char *);
                                                                               
                               
                                                        
                                     
                      
                      
                      
                                     
                                     
                           
                                                                               

EXTERN int  hgetsecond(char *);
                                                                               
                                
                            
                                       
                           
                 
                                                                               

EXTERN int  hgetmicrosecond(char *);
                                                                               
                                     
                          
                                       
                                     
                               
                                                                               

EXTERN float hdifftime(struct timeb, struct timeb);
                                                                               
                               
                              
                                       
                        
                                     
                 
                                                                               

struct timeval  haddtimeval(struct timeval srctv, struct timeval addtv);
                                                                               
                                 
                            
                                     
                                                         
                          
                       
                                                                               

EXTERN struct timeval  hdifftimeval(struct timeval time2, struct timeval time1);
                                                                               
                                  
                              
                                       
                                                           
                                     
                       
                                                                               

EXTERN void hnsleep(long);
                                                                               
                             
                                
                                     
                   
                         
                                                                               

EXTERN int  hcvttime(time_t, char *);
                                                                               
                              
                                          
                                     
                                        
                   
                           
                                                                               

EXTERN int  hgetcurrenttime(char *);
                                                                               
                                     
                                                  
                                               
                   
                             
                                                                               

EXTERN int hisyearend(char *);
                                                                               
                        
                                    
                                  
                                  
                                                                               

EXTERN int hisquarterend(char *);
                                                                               
                           
                                    
                                  
              
                                  
                                                                               

EXTERN int hismonthend(char *);
                                                                               
                         
                                    
                                  
              
                                  
                                                                               

EXTERN int hisweekend(char *);
                                                                               
                        
                                    
                                  
              
                                                            
                                                                               

                    

EXTERN int  hsavefile(char *, char *, int, char *);
                                                                               
                               
                                                
                                       
                      
                      
                                              
                                     
                                                                               

EXTERN int  hfilelog(char *, char *, ...);
                                                                               
                              
                                                    
                                       
                      
                                     
                                                                               

EXTERN int  hsyslog(char *, ...);
                                                                               
                             
                                      
                                     
                                     
                                                                               

EXTERN int  happlog(char *, ...);
                                                                               
                             
                                              
                                     
                                     
                                                                               

EXTERN int  herrlog(char *, char *, ...);
                                                                               
                             
                              
                                       
                      
                                     
                                                                               

EXTERN int  hverrlog(char *, char *, va_list);
                                                                               
                              
                              
                                       
                      
                                     
                                                                               

EXTERN int  htrace(char *, char *, ...);
                                                                               
                            
                              
                                       
                      
                                     
                                                                               

EXTERN int  hvtrace(char *, char *, va_list);
                                                                               
                            
                              
                                       
                      
                                     
                                                                               

                   

EXTERN int  hfgetsize(FILE *);
                                                                               
                               
                                
                                       
                            
                                                                               

EXTERN int  hfreadline(FILE *, char *, int);
                                                                               
                                
                                    
                                       
                              
                                          
                                     
                                                                               

EXTERN int  hfreadpara(char *, char *, char *, char *);
                                                                               
                                
                                          
                                   
                    
                              
                    
                                     
                             
                    
              
                                       
                                           
                           
                                                                               

EXTERN int hfilecopy(char *, char *);
                                                                               
                               
                            
                                     
                        
                                     
                                                                               

EXTERN int hfilelines(char *, int *, long *);
                                                                               
                                
                                
                                     
                                                 
                                                 
                                     
                                                                               

EXTERN int hfreadtobuf(char *, char **);
                                                                               
                                 
                                      
                                   
                            
                                                
                                                                               

EXTERN int hexistpath(char *);
                                                                               
                                
                                        
                                   
                                                        
                                                                               

EXTERN int hexistfile(char *);
                                                                               
                                
                                    
                                   
                                                        
                                                                               

EXTERN int hfilelock(char *filename);
                                                                               
                               
                            
                                   
                                             
                                                                               

EXTERN int hfileunlock(int fd);
                                                                               
                                 
                            
                                   
                               
                                                                               


                  

EXTERN int  hshmcreate(key_t, int, char **);
                                                                               
                                
                                                    
                                            
                            
                                    
                                       
                                                                               

EXTERN int  hshmopen(key_t, char **);
                                                                               
                              
                                                    
                                            
                                    
                                       
                                                                               

EXTERN int  hshmclose(char *);
                                                                               
                               
                                                  
                                             
                                     
                                                                               

EXTERN int  hshmrm(int);
                                                                               
                            
                                
                                           
                                     
                                                                               

EXTERN int  hsemcreate(key_t);
                                                                               
                                
                              
                                          
                                       
                                                                               

EXTERN int  hsemop(int, int);
                                                                               
                            
                                              
                                         
                            
                                     
                                                                               
    
EXTERN int  hsempossess(int);
                                                                               
                                 
                                   
                                         
                                     
                                                                               

EXTERN int  hsemvacate(int);
                                                                               
                                
                                   
                                         
                                     
                                                                               

                     

EXTERN long hgetrandom(void);
                                                                               
                                
                                  
                      
                                
                                                                               

EXTERN void hsetrandom(void);
                                                                               
                                
                                          
                      
                      
                                                                               

EXTERN int  hshortpower(int, unsigned int);
                                                                               
                                 
                              
                                    
                 
                      
                                                                               

EXTERN long hlongpower(long, unsigned int);
                                                                               
                                
                              
                                    
                 
                      
                                                                               

EXTERN double hdoublepower(double, unsigned int);
                                                                               
                                  
                              
                                    
                 
                      
                                                                               

                     

EXTERN int  hsocketbindlisten(int);
                                                                               
                                       
                                                 
                                  
                                     
                                                                               

EXTERN int  hsocketaccept(int);
                                                                               
                                   
                                         
                                                
                                          
                                                                               

EXTERN int  hsocketconnect(char *, int);
                                                                               
                                    
                                             
                                   
                 
                                          
                                                                               

EXTERN int hsocketselect(int timeout, int sockfd);
                                                                               
                                   
                                                               
                                    
                                   
                                               
                                                                               

EXTERN int hsocketsendselect(int timeout, int sockfd);
                                                                               
                                       
                                                               
                                    
                                   
                                                                                 
                                                                               

EXTERN int  hsocketclose(int);
                                                                               
                                  
                                                     
                                                  
                                     
                                                                               

EXTERN int  hsocketshutdown(int, int);
                                                                               
                                     
                                                     
                                                        
                     
                            
                            
                        
                                     
                                                                               

EXTERN int  hsocketwrite(int, char *, int);
                                                                               
                                  
                                           
                                                  
                       
                           
                                  
                                                                               

EXTERN int  hsocketread(int, char *, int);
                                                                               
                                 
                                           
                                                  
                                 
                           
                                  
                                                                               

EXTERN int hsocketwritebylen(int, char *, int, int);
                                                                               
                                       
                                                       
                                                  
                     
                           
                           
                                      
                                                                               

EXTERN int hsocketreadbylen(int, char **, int);
                                                                               
                                      
                                                       
                                                  
                           
                           
                                  
                                                                               

EXTERN int  hgethostip(char *, int);
                                                                               
                                
                                     
                                                   
                          
                                     
                                                                               

EXTERN int     hgetip(char *name, char *ip, int len);
                                                                               
                            
                                    
                                  
                                                   
                                         
                                     
                                                                               

EXTERN int  hsocketsetnodelay(int);
                                                                               
                                       
                                       
                                        
                                     
                                                                               

int hsocketrecv(int, char *, int);
                                                                               
                                 
                                                                         
                                                  
                                 
                          
                                  
                                                                               

EXTERN int  hsocketsetlocalip(char *);
                                                                               
                                       
                                             
                                   
                                     
                                                                               

                     

EXTERN void *hmalloc(size_t);
                                                                               
                             
                                
                                        
                                
                                                                               

EXTERN void *hrealloc(void *, size_t);
                                                                               
                              
                                  
                                      
                           
                                
                                                                               

EXTERN void hfree(void **);
                                                                               
                           
                                
                                                
                      
                                                                               

EXTERN int  hdelrightspace(char *);
                                                                               
                                    
                                      
                                  
                                     
                                                                               

EXTERN int  hdelleftspace(char *);
                                                                               
                                   
                                      
                                  
                                     
                                                                               

EXTERN int  hdelbothspace(char *);
                                                                               
                                   
                                      
                                  
                                     
                                                                               

EXTERN int  hdelallspace(char *);
                                                                               
                                  
                                              
                                  
                                     
                                                                               

EXTERN int  hdelspace(char *, char *);
                                                                               
                               
                                  
                                  
                                                             
                                   
                                  
                                   
                                          
                                  
                                                                               

EXTERN int  hstrncpy(char *, char *, size_t);
                                                                               
                              
                                                                      
                                        
                     
                         
                                  
                                                                               

EXTERN int  hcharncat(char *, char, size_t);
                                                                               
                               
                                                                    
                                        
                 
                     
                                  
                                                                               

EXTERN void hcharreplace(char *, char *, char);
                                                                               
                                  
                                                                  
                                            
                                     
                         
                   
                                                                               

EXTERN int  hstrncat(char *, char *, size_t);
                                                                               
                              
                                                                  
                                        
                     
                         
                                  
                                                                               

EXTERN int  htoupper(char *,char *);
                                                                               
                              
                                                
                                    
                           
                                  
                                                                               

EXTERN int  htolower(char *,char *);
                                                                               
                              
                                                
                                    
                           
                                  
                                                                               

EXTERN int  hisnumber(char *);
                                                                               
                               
                                                  
                                  
                              
                                                                               

EXTERN int  hisint(char *);
                                                                               
                            
                                            
                                  
                             
                                                                               

EXTERN int  hcountchar(char *);
                                                                               
                                
                                                      
                                  
                           
                                                                               

EXTERN int  hgetcharpos(char *, unsigned char, int);
                                                                               
                                 
                                              
                                  
                     
                     
                           
                                                                               

EXTERN int  hgetlastcharpos(char *, unsigned char, int);
                                                                               
                                     
                                                      
                                  
                     
                     
                           
                                                                               

                                                                               
                                 
                                                  
                                  
                                    
                            
                                                                               
EXTERN int hgetcharnum(char * str, char ch);

EXTERN int  hgetworddelimiter(char *, char *, char *, int);
                                                                               
                                       
                                                  
                                      
                           
                             
                         
                                     
                                                                               

EXTERN int  hgetwordspace(char *, char *);
                                                                               
                                   
                                                                   
                                      
                           
                                     
                                                                               

EXTERN int  hgetstrstr(char *, int *, char *, int, int *);
                                                                               
                                
                                                        
                                      
                                             
                       
                                                 
                             
                                  
                                                                               

EXTERN int  haddchar(char *, int, char, int);
                                                                               
                              
                                                
                                      
                       
                         
                                                 
                                  
                                                                               

EXTERN int  hcutchar(char *, int);
                                                                               
                              
                                                      
                                      
                       
                                  
                                                                               

EXTERN int  hisupper(char *);
                                                                               
                              
                                              
                                  
                              
                                                                               

EXTERN int  hgetcharspos(char *, char *);
                                                                               
                                  
                                    
                                      
                       
                                      
                                                                               

EXTERN int  hvalistalloc(int, char **, va_list *);
                                                                     
                          
                                            
                           
                           
                                
                              
                                                                     

EXTERN int  hvalistfree(va_list);
                                                                     
                          
                                 
                                        
         
                               
                                                                     

EXTERN int  hvaralloc(char ***, int, int);
                                                                     
                        
                                     
                        
                        
                               
                              
                                                                     

EXTERN int  hvarfree(char ***, int);
                                                                     
                       
                               
                                      
                        
         
                              
                                                                     

EXTERN int  hstrrep(char *, char *, char *);
                                                                      
                            
                                        
                                    
                                    
                                
                     
                                                 
                     
                                                                     

EXTERN int  hstrrep_all(char *, char *, char *, char *);
                                                                      
                                
                                              
                                    
                                    
                                    
                                
                     
                                   
                     
                                                                     

EXTERN int  hdelchar(char *, char);
                                                                      
                             
                                         
                                    
                                        
                     
                                   
                     
                                                                     

EXTERN int  hdelctrl(char *);
                                                                      
                             
                                              
                                    
                     
                                   
                     
                                                                     

EXTERN int  hrepctrl(char *, char);
                                                                      
                             
                                                          
                                    
                                      
                     
                                   
                     
                                                                     

EXTERN int  hsnprintf(char *, size_t, const char *, ...);
                                                                      
                              
                                     
                                    
                                            
                                      
                     
                                   
                     
                                                                     

EXTERN int  hmalloc_sprintf(char **, const char *, ...);
                                                                      
                                    
                                                                           
                                    
                                      
                     
                                              
                              
                     
                                                                     

EXTERN int  hrealloc_sprintf(char **, size_t, const char *, ...);
                                                                      
                                     
                                                                               
                                                   
                                    
                                        
                                      
                     
                                              
                              
                     
                                                                     

void freePointerArray(char **p, int num);
                                                                      
                                     
                                 
                                  
                                  
                     
                       
                     
                                                                     

EXTERN char **parseStringByDelimiter(char *strings, char ch, int *num);
                                                                      
                                           
                                              
                                        
                                              
                                        
                       
                     
                                                                     

char * hrepallvar(char * str);
                                                                      
                               
                                                
                                    
                    
                                                
                     
                                                                     
                       


                  

EXTERN int hudpbind(char *local_ip, int port);
                                                                               
                              
                               
                                                
                            
                                       
                                                                               

int hudprecv(int sockfd, char *buf, int max_size, int *len, char *remote_ip, int *remote_port);
                                                                               
                              
                            
                                        
                       
                             
                             
                   
                     
                                       
                                                                               

int hudpsend(char *ip, int port, char *data, int len);
                                                                               
                              
                               
                                           
                                 
                      
                      
                                       
                                                                               

#undef EXTERN 

#endif                   
 

                                                                               

                                              

                        
                         
               
                    
                                 
            
           

                                
                                                                        
                          
                                                                  
                                                           
                                                                    

                                                                               
#ifndef  _HI_ONLINE_H
#define  _HI_ONLINE_H


#include <math.h>
  
                                                                    
                                                                               
                                                                            
                                                                                

#ifndef _HI_SERVER_H_
#define _HI_SERVER_H_

#define _H_LOCALEDEF

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <pthread.h>
#include <dlfcn.h>
#include <errno.h>
#include <fcntl.h>
#include <string.h>
#include <malloc.h>
#include <stdarg.h>


#ifndef _HIXML_H
#define _HIXML_H

#ifdef __cplusplus
extern "C" {
#endif

#include <stdlib.h>
  
                   
                    
     
                   
      
  

#include <expat.h>

                    
#include <errno.h>

#define MALLOC  malloc
#define CALLOC  calloc
#define REALLOC realloc
#define FREE    free
#define STRDUP  strdup

enum ReplaceFlag {
 XML_NODE_NO_REPLACE = 0,
 XML_NODE_REPLACE,
 XML_NODE_APPEND
};

enum HiXmlError {
   HX_ERR_NONE,
   HX_ERR_NO_MEM,
   HX_ERR_NO_NODE,
   HX_ERR_INVALID_PARAM,
   HX_ERR_INVALID_NODE_TYPE,
   HX_ERR_INCONSISTENT,
   HX_ERR_CREATE_FILE,
   HX_ERR_OPEN_FILE,
   HX_ERR_UNSORT,
   HX_ERR_PARSE,
   HX_ERR_OPEN_MODE,                                 
   HX_ERR_APPEND_FILE,                               
   HX_ERR_NO_VALUE,                                  
   HX_ERR_MAX_NUM

};

#define xmlGetParserErrStr(p) XML_ErrorString(XML_GetErrorCode(p->parser))
#define xmlGetParserErrLine(p) XML_GetCurrentLineNumber(p->parser)
#define xmlGetParserErrCol(p) XML_GetCurrentColumnNumber(p->parser)

#define DEFAULT_PROLOG "<?xml version='1.0' encoding='ISO-8859-1'?>"
#define DEFAULT_PROLOG_LEN strlen(DEFAULT_PROLOG)

#define TEXT_NODE_NAME                "#text"
#define COMMENT_NODE_NAME             "#comment"
#define CDATA_SECTION_NODE_NAME       "#cdata-section"
#define DOCUMENT_NODE_NAME            "#document"
#define DOCUMENT_FRAGMENT_NODE_NAME   "#document-fragment"

enum NodeType {
   MIN_NODE_TYPE = 0,
   ELEMENT_NODE,
   ATTRIBUTE_NODE,
   TEXT_NODE,
   CDATA_SECTION_NODE,
   ENTITY_REFERENCE_NODE,
   ENTITY_NODE,
   PROCESSING_INSTRUCTION_NODE,
   COMMENT_NODE,
   DOCUMENT_NODE,
   DOCUMENT_TYPE_NODE,
   DOCUMENT_FRAGMENT_NODE,
   NOTATION_NODE,
   MAX_NODE_TYPE
};

#ifdef _HIXML_NODE
   static char *def_node_name[] = {
      NULL,
      NULL,
      NULL,
      TEXT_NODE_NAME,
      CDATA_SECTION_NODE_NAME,
      NULL,
      NULL,
      NULL,
      COMMENT_NODE_NAME,
      DOCUMENT_NODE_NAME,
      NULL,
      DOCUMENT_FRAGMENT_NODE_NAME,
      NULL,
      ""
   };
#endif

struct _xml_node_list;
typedef struct _xml_node ElemAttr;

typedef struct _xml_node {
   int    type;                                      
   char * name;                                     
   char * value;                                 
   ElemAttr * attrs;                               

   struct _xml_node * parent;                        
   struct _xml_node * first_child;                     
   struct _xml_node * last_child;                      
   struct _xml_node * prev_sibling;                        
   struct _xml_node * next_sibling;                        
   struct _xml_nodelist * child_list;                      
} XmlNode;

typedef struct _xml_document {
   XmlNode element;                                    
   int doctype;                                        
} XmlDocument;

enum OrderMethod {
  NO_ORDER,
  ASCEND_ORDER,
  DESCEND_ORDER,
  ORDER_METHOD_NUM
};

typedef struct _xml_nodelist {
   int num;                                        
   XmlNode ** item;                                        
   int size;                                                  
   int order;                                          
} XmlNodeList;

typedef struct _xml_parser {
   XML_Parser parser;
   XmlDocument * doc_node;                             
   XmlNode * curnt_node;                               
   int done;                                           
   int if_prolog;                                        
   int if_space;                                           
} XmlParser;

typedef struct _xml_block {
   int size;                                            
   char * s;                                            
   int len;                                           
   struct _xml_block * next;                          
} XmlBlock;

typedef struct _xml_builder {
   XmlDocument * doc_node;                            
   XmlNode * curnt_node;                              
   XmlBlock * first_block;                                
   XmlBlock * curnt_block;                                            
   int curnt_len;                                     
   int block_size;                                  
   int if_file;                                       
} XmlBuilder;

enum NodeDataType {
   NDT_INT,
   NDT_LONG,
   NDT_FLOAT,
   NDT_DOUBLE,
   NDT_CHAR,                  
   NDT_CHAR_ARRAY,                
   NDT_STRING,                      
   NDT_OTHER
};

typedef struct _xml_node_desc {
   char * name;                                   
   int data_type;                                     
   int len;                                                             
                                                                        
   int offset;                                      
} XmlNodeDesc;

                              
enum SaveMode
{
    WRITE,
    APPEND
};
             

                               
typedef struct _quick_search_node {
 char * id;
 XmlNode * node;
}QuickSearchNode;

typedef struct _quick_search_list {
 int    num;
 QuickSearchNode ** item;
}QuickSearchList;
             

#define _XML_NODE_SIZE       sizeof(XmlNode)
#define _XML_DOCUMENT_SIZE   sizeof(XmlDocument)
#define _ELEM_ATTR_SIZE      sizeof(ElemAttr)
#define _XML_NODE_LIST_SIZE   sizeof(XmlNodeList)
#define _XML_PARSER_SIZE     sizeof(XmlParser)
#define _XML_BLOCK_SIZE      sizeof(XmlBlock)
#define _XML_BUILDER_SIZE    sizeof(XmlBuilder)
#define _XML_NODE_DESC_SIZE  sizeof(XmlNodeDesc)

#ifndef _HIXML_PUBLIC
   #define EXTERN extern
#else                    
   #define EXTERN
#endif                    

EXTERN char * xmlJoinString( char *, char * );
EXTERN void * xmlDebugMalloc( size_t );
EXTERN void * xmlDebugRealloc( void *, size_t );
EXTERN void xmlDebugFree( void * );
EXTERN char * xmlDebugStrdup( const char * );
EXTERN int xmlGetErrno();
EXTERN void xmlSetErrno( int );
EXTERN const char * xmlGetErrStr( int );

#undef EXTERN

#ifndef _HIXML_ATTRIBUTE
   #define EXTERN extern
#else                       
   #define EXTERN
#endif                       

  
                                   
  
#ifdef _LINUX_SYSTEM_
EXTERN ElemAttr * xmlNewElemAttr(char **, ...);
#else
EXTERN ElemAttr * xmlNewElemAttr();
#endif

EXTERN ElemAttr * xmlCloneElemAttr( ElemAttr * );
EXTERN void xmlFreeElemAttr( ElemAttr * );
EXTERN int xmlAppendElemAttr( ElemAttr *, char *, char * );
EXTERN int xmlRemoveElemAttr( ElemAttr *, char * );
EXTERN int xmlReplaceElemAttr( ElemAttr *, char *, char * );
EXTERN char * xmlGetElemAttrValue( ElemAttr *, char * );
#undef EXTERN

#ifndef _HIXML_NODE
   #define EXTERN extern
#else                  
   #define EXTERN
#endif                  

EXTERN XmlNode * xmlNewNode( int, char *, char *, ElemAttr * );
EXTERN XmlNode * xmlNewTextNode( char *, char *, ElemAttr * );
EXTERN void xmlFreeNode( XmlNode *, int );
                              
EXTERN void xmlFreeDocument( XmlDocument* , int );
             
EXTERN XmlNodeList * xmlSortNode( XmlNode *, int );

EXTERN XmlNode * xmlAppendNode( XmlNode *, XmlNode * );
EXTERN XmlNode * xmlInsertNode( XmlNode *, XmlNode *, XmlNode * );
EXTERN XmlNode * xmlRemoveNode( XmlNode * );
EXTERN XmlNode * xmlReplaceNode( XmlNode *, XmlNode * );

EXTERN XmlNode * xmlCloneNode( XmlNode *, int );
EXTERN XmlNode * xmlGetNode( XmlNode *, XmlNode *, char * );
EXTERN XmlNode * xmlGetNodeQuick( XmlNode *, int *, char * );
extern char * xmlGetValue( XmlNode * );
                              
EXTERN int xmlSetValue( XmlNode*, char* );
             
extern XmlNodeList * xmlGetAllNode( XmlNode *, char * );
EXTERN XmlNode * xmlGetRootNode( XmlNode * );

EXTERN XmlNode * xmlFormatNode( XmlNode * );

                              
EXTERN XmlNode * xmlNewBinNode( char*, void*, int, ElemAttr* );
EXTERN void* xmlGetBinValue( XmlNode*, int* );
EXTERN int xmlSetBinValue( XmlNode*, void*, int );
             

                              
                                                               
                                           
                                                 
             


EXTERN XmlNodeList * xmlNewNodeList( int );
EXTERN XmlNodeList * xmlAppendNodeToList( XmlNodeList *, int, XmlNode **, int );
EXTERN XmlNodeList * xmlRemoveNodeFromList( XmlNodeList *, XmlNode * );
EXTERN XmlNodeList * xmlChangeNodeListOrder( XmlNodeList *, int );
EXTERN void xmlFreeNodeList( XmlNodeList * );

                                
EXTERN char * xmlGetAttrValue( XmlNode *, char * );
EXTERN int xmlAddAttrValue(XmlNode *, char *, char *);
EXTERN XmlNode * xmlGetChildNode( XmlNode *, XmlNode *, char * );
EXTERN XmlNode * xmlGetNodeByValue( XmlNode *, XmlNode *, char *, char * );
EXTERN XmlNode * xmlGetChildNodeByValue( XmlNode *, XmlNode *, char *, char * );
EXTERN XmlNode * xmlGetNodeByAttr( XmlNode *, XmlNode *, char *, char *, char * );
EXTERN XmlNode * xmlGetChildNodeByAttr( XmlNode *, XmlNode *, char *, char *, char * );
EXTERN char * xmlGetChildValue( XmlNode *, char * );
EXTERN int xmlSetChildValue( XmlNode *, char *, char * );
EXTERN int xmlDelChildValue( XmlNode *, char * );
EXTERN int xmlDelNode( XmlNode * );
EXTERN XmlNode * xmlStringToTree( char *, int );
EXTERN XmlNode * xmlStringToTreeNS( char *, int );
EXTERN char * xmlTreeToString( XmlNode * , int * );
EXTERN void xmlFreeTree( XmlNode * );
EXTERN void xmlFreeString( char * );
EXTERN XmlNode * xmlAddNode(XmlNode * , char *, int);
EXTERN XmlNode * xmlAddTextNode(XmlNode * , char *, char *, int);
EXTERN int xmlCombine(XmlNode *, XmlNode *, int);
EXTERN int xmlCombineReplace(XmlNode *, XmlNode *);
EXTERN int xmlCombineNoReplace(XmlNode *, XmlNode *);

                            
EXTERN char * xmlReadField(XmlNode *, char *);
                            
EXTERN XmlNode * xmlGetPrevNode(XmlNode *, char *);
EXTERN XmlNode * xmlGetNextNode(XmlNode *, char *);
EXTERN int xmlNodeRename(XmlNode *, char *);

#undef EXTERN

#ifndef _HIXML_PARSE
   #define EXTERN extern
#else                   
   #define EXTERN
#endif                   

extern XmlParser * xmlCreateParser( int, int );
extern XmlParser * xmlCreateParserNS( int, int );
extern int xmlParse( XmlParser * , char *, int, int );
extern void xmlFreeParser( XmlParser *, int );
extern XmlDocument * xmlLoadFile( char *, int );
extern XmlDocument * xmlLoadFileNS( char *, int );
#undef EXTERN

#ifndef _HIXML_BUILD
   #define EXTERN extern
#else                   
   #define EXTERN
#endif                   

extern XmlBuilder * xmlCreateBuilder( XmlDocument *, int, int );
extern int xmlBuild( XmlBuilder * , char **, int *, int * );
extern void xmlFreeBuilder( XmlBuilder * );
                                 
extern int xmlSaveFile( XmlDocument *, char *, int );
                
#undef EXTERN

#ifndef _HIXML_QSEARCH
   #define EXTERN extern
#else
   #define EXTERN
#endif
EXTERN QuickSearchList * xmlNewQuickSearchList(XmlNode *, char *, char *);
EXTERN XmlNode * xmlQuickSearch(QuickSearchList *, char *);
EXTERN void xmlFreeQuickSearchList(QuickSearchList *);
#undef EXTERN

#ifdef __cplusplus


}
#endif

#endif               

#ifndef _HIMEMPOOL_H_
#define _HIMEMPOOL_H_
#include <stdio.h>
#include <stdlib.h>
#include <pthread.h>

#ifndef MIN
#define MIN(x, y) ((x > y) ? y : x)
#endif

struct _memory_pool {
 short cursize;
 short maxsize;
 short unitsize;
 short expandflag;
 short expandscale;
 void (*initfun)(void *);
 void ** addr;
 short available;
 short fidle;
 short lidle;
 short * idles;
 short * allocedpos;
 pthread_mutex_t memlock;
};
typedef struct _memory_pool MemoryPool;

#ifdef _HIMEMPOOL_LIB_
#define EXTERN
#else
#define EXTERN extern
#endif

EXTERN void mplFree(MemoryPool *, short);
EXTERN void mplDestroy(MemoryPool *);
EXTERN MemoryPool * mplCreate(short, short, short, short, short, void (*)(void *));
EXTERN short mplMalloc(MemoryPool *);
#undef EXTERN

#endif                    

#ifndef _HITHREAD_H_
#define _HITHREAD_H_

#include <pthread.h>

#ifdef _HP_SYSTEM_
#ifndef PTHREAD_CREATE_UNDETACHED
#define PTHREAD_CREATE_UNDETACHED PTHREAD_CREATE_JOINABLE
#endif
#endif

#ifdef _HITHD_LIB_
#define EXTERN
#else
#define EXTERN extern
#endif

EXTERN int thdInitAttr(pthread_attr_t *);
EXTERN int thdDestroyAttr(pthread_attr_t *);
EXTERN int thdSetDetachState(pthread_attr_t *, int);
EXTERN int thdSetScope(pthread_attr_t *, int);
EXTERN int thdInitAttr(pthread_attr_t *);
EXTERN int thdCreate(pthread_t *, const pthread_attr_t *, void * (*)(void *), void *);
EXTERN void thdExit(void *);
EXTERN void thdTestCancel();
EXTERN int thdJoin(pthread_t, void **);
EXTERN int thdCancel(pthread_t);
EXTERN int thdInitMutex(pthread_mutex_t *);
EXTERN int thdLockMutex(pthread_mutex_t *);
EXTERN int thdUnlockMutex(pthread_mutex_t *);
EXTERN int thdDestroyMutex(pthread_mutex_t *);
EXTERN int thdInitCond(pthread_cond_t *);
EXTERN int thdWaitOnCond(pthread_cond_t *, pthread_mutex_t *, long);
EXTERN int thdSignalCond(pthread_cond_t *);
EXTERN int thdBroadcastCond(pthread_cond_t *);
EXTERN int thdDestroyCond(pthread_cond_t *);
EXTERN int thdSetCancelType(int, int *);
EXTERN int thdSetCancelState(int, int *);

#ifdef _AIX_SYSTEM_
EXTERN void thdCleanupPush(void (*)(void *), void *);
EXTERN void thdCleanupPop(int);
#endif

#ifdef _HP_SYSTEM_
#define thdCleanupPush(a,b) pthread_cleanup_push(a,b)
#define thdCleanupPos(a) pthread_cleanup_pop(a)
#endif

#undef EXTERN

#endif                   

                                                                               

                                                          

                         
                                
                     
                            
                                  
                    
                 

                                            
                                                                              
                                    

                                                                               
#ifndef _H_HIDSM_
#define _H_HIDSM_

#define DSM_INIT_SIZE  1024                        
#define DSM_NAMED_DS  9998                    
#define DSM_NON_NAMED_DS 9999                      

#define DSM_RDONLY   1                 
#define DSM_RWONLY   2                 


                    
typedef struct _named_data_node {
 int  type;                    
 char * name;                    
 char * data;                    
 int  len;                    
 struct _named_data_node * next;                  
}NamedDataNode;
typedef NamedDataNode NamedPointerNode;

                          
typedef struct _named_data_source {
 int  size;                      
 int  count;                          
 NamedDataNode * tbl;                    
 NamedDataNode ** ht;                
}NamedDataSource;
typedef NamedDataSource NamedPointerSource;

                
typedef struct _data_source_node {
 int  type;                      
 int  size;                      
 char * name;                      
 void * pointer;                     
 void (*done)(void *);                           
 struct _data_source_node * next;                 
}DataSourceNode;

                
typedef struct _data_source {
 int  size;                      
 int  count;                          
 DataSourceNode * tbl;                  
 DataSourceNode ** ht;                
}DataSource;

#ifdef _LIB_HIDSM_
#define EXTERN
#else
#define EXTERN extern
#endif

                
EXTERN DataSource * dsmNewDataSource(int);
                
EXTERN int dsmAddDataSource(DataSource *, char *, int, void *, int, void (*)(void *));
                      
EXTERN int dsmAddOrRepDataSource(DataSource *, char *, int, void *, int, void (*)(void *));
              
EXTERN void * dsmGetDataSource(DataSource *, char *, int *, int *);
                    
EXTERN void dsmFreeDataSource(DataSource *);
                
EXTERN void dsmDelDataSource(DataSource *, char *);
                    
EXTERN DataSourceNode * dsmFindDataSourceNode(DataSource *, char *);

                    
EXTERN NamedDataSource * dsmNewNamedDataSource(int);
                        
EXTERN NamedDataSource * dsmAddNamedDataSource(DataSource *, char *);
                                
EXTERN int dsmAddNamedData(NamedDataSource *, char *, char *, int, int);
                          
EXTERN char * dsmGetNamedData(NamedDataSource *, char *, int *);
                            
EXTERN void dsmDelNamedData(NamedDataSource *, char *);
                    
EXTERN void dsmFreeNamedDataSource(NamedDataSource *);
                    
EXTERN int dsmDumpNamedDataSource(NamedDataSource *, char **, int *);

                        
EXTERN NamedPointerSource * dsmNewNamedPointerSource(int);
                            
EXTERN NamedPointerSource * dsmAddNamedPointerSource(NamedPointerSource *, char *);
                              
EXTERN int dsmAddNamedPointer(NamedPointerSource *, char *, void *, int);
                
EXTERN void * dsmGetNamedPointer(NamedPointerSource *, char *);
                  
EXTERN void dsmDelNamedPointer(NamedPointerSource *, char *);
                    
EXTERN void dsmFreeNamedPointerSource(NamedPointerSource *);

  
                                             
   
                    
EXTERN DataSourceNode * dsmRemoveDataSource(DataSource *, char *);
                        
EXTERN void dsmFreeDataSourceNode(DataSourceNode *);

                        
EXTERN NamedDataNode * dsmRemoveNamedDataNode(NamedDataSource *, char *);
                            
EXTERN void dsmFreeNamedDataNode(NamedDataNode *);

                      
EXTERN NamedPointerNode * dsmRemoveNamedPointerNode(NamedPointerSource *, char *);
                          
EXTERN void dsmFreeNamedPointerNode(NamedPointerNode *);
#undef EXTERN

#endif               

#ifndef _HI_MMG_H_
#define _HI_MMG_H_
#include <stdio.h>
#include <pthread.h>

#ifdef _LIB_HIMMG_
#define EXTERN
#else
#define EXTERN extern
#endif

                                                                                
                                                                               
                                                                                
                      
EXTERN int pmm_create(unsigned int block_size, \
      unsigned short pool_init_size, \
      unsigned short pool_max_size, \
      unsigned short pool_add_step, \
      unsigned short page_size, \
            unsigned short max_blocks, \
      unsigned int timeout);

                      
EXTERN void    pmm_destroy(void);

                                  
                                                               
  
EXTERN void pmm_print_state(char * logname);

                    
EXTERN void * tsm_malloc(unsigned int size);

                    
EXTERN void   tsm_free(void * addr);

                                                                                
                                                                               
                                                                                
                                
EXTERN void * tmm_malloc(unsigned int size);

                
void * tmm_realloc(void *old_addr, unsigned int new_size);

                                        
EXTERN void * tmm_calloc(unsigned int count, unsigned int eltsize);

                                                           
EXTERN char * tmm_strdup(const char *s);

                                  
EXTERN void   tmm_free( void * addr );

                                                                  
EXTERN int   tmm_free_all(void);

#undef EXTERN
 
typedef struct _process_mem_manager ProcessMemoryManager;
  
                                               
   
#if !defined(SERVER_EXTERN) && !defined(_MMG_EXTERN_) && !defined(_MMG_STATIC_LIB_)
#define _MMG_EXTERN_
ProcessMemoryManager * _gProcessMemMng = NULL;
pthread_key_t     * _gThreadMngKey = NULL;
#else
extern ProcessMemoryManager     * _gProcessMemMng;
extern pthread_key_t     * _gThreadMngKey;
#endif
#endif               

                                                                               

                                              

                     
                         
               
                   
                               
              
           

                                
                                                                        
                                
                                               

                                                                               
#ifndef _HILGR_H_
#define _HILGR_H_







#include <pthread.h>

#define LOG_INFINITY  -1

                                                   
#define LOG_NO_DATETIME  0
#define LOG_ONLY_TIME  1
#define LOG_ALL_DATETIME 2

                                      
#define LOG_MODE_NO_DAY  0
#define LOG_MODE_HAVE_DAY 1

#define LOG_OFF    0
#define LOG_FATAL   1
#define LOG_ERROR   2 
#define LOG_WARN   3
#define LOG_INFO   4
#define LOG_INFO2   5
#define LOG_INFO3   6
#define LOG_DEBUG   7

#define LOG_FATAL_S  "FATAL"
#define LOG_ERROR_S  "ERROR"
#define LOG_WARN_S  "WARN"
#define LOG_INFO_S   "INFO"
#define LOG_INFO2_S   "INFO2"
#define LOG_INFO3_S   "INFO3"
#define LOG_DEBUG_S  "DEBUG"

#define LOG_COMM_SEND "SEND"
#define LOG_COMM_RECV "RECV"

#define LOG_MAX_PARA 100

  
                 
   
struct _logger_message {
 DataSource * msg_space;
};
typedef struct _logger_message LoggerMessage;

  
                   
   
struct _logger_para {
 int  seq;                   
 char * data;                                 
 struct _logger_para * next;              
};
typedef struct _logger_para LoggerPara;

  
               
   
struct _log_buffer {
 int  len;                   
 char * data;               
 struct _log_buffer * next;              
};
typedef struct _log_buffer LogBuffer;

  
                 
   
struct _logger {
 int    level;                 
 int    max_size;                    
 int    max_buffer;                    
 int    curr_buffer;                         
 int    format;                   
 int    path_mode;                
 char   * path;             
 char   * filename;              
#ifdef _PTHREAD_
 pthread_mutex_t lock;               
#endif
 FILE   * fp;                 
 LogBuffer  * buffer_head;                         
 LogBuffer  * buffer_tail;                         
 LoggerMessage * msg_mng;                  
   
                        
                                 
    
 int    mon_flag;                
 char   mon_ip[15+1];             
 int    mon_port;                
};
typedef struct _logger Logger;

#ifdef LIB_LGR_EXTERN
#define EXTERN
#else
#define EXTERN  extern
#endif                     

EXTERN LoggerMessage * logCreateMessage(int);
EXTERN void logDestroyMessage(LoggerMessage *);

EXTERN Logger * logCreate();
EXTERN void logDestroy(Logger *);

EXTERN int logSetFormat(Logger *, int);
EXTERN int logSetName(Logger *, char *);
EXTERN int logSetLevel(Logger *, int);
EXTERN int logSetMaxBuffer(Logger *, int);
EXTERN int logSetMaxSize(Logger *, int);
EXTERN int logSetMonitor(Logger *, int, char *, int);
EXTERN int logSetMessage(Logger *, LoggerMessage *);
EXTERN int logLevelS2N(char *, int *);
EXTERN char * logLevelN2S(int, char *);

EXTERN int logDebug(Logger *, char *, char *, ...);
EXTERN int logInfo(Logger *, char *, char *, ...);
EXTERN int logWarn(Logger *, char *, char *, ...);
EXTERN int logError(Logger *, char *, char *, ...);
EXTERN int logFatal(Logger *, char *, char *, ...);
EXTERN int logFlush(Logger *);
EXTERN int logComm(Logger *logger, char * req_id, char *type, char * addr, int text_len, char *text);
EXTERN int logSysDebug(char *, ...);
EXTERN int logSysInfo(char *, ...);
EXTERN int logSysWarn(char *, ...);
EXTERN int logSysError(char *, ...);
EXTERN int logSysFatal(char *, ...);

#undef EXTERN

#endif                


#ifndef HASH_H
#define HASH_H

#ifndef NULL
#define NULL 0x00
#endif
   
               
                           
   

#ifdef __cplusplus
extern "C"
{
#endif

   
                      
                 
     
   

   
                                                                
                                                                    
                        
  
                                                                       
                                                                        
                                                                          
                                                                        
   
#define HASH_KEY_STRING     (-1)

   
                                 
   
    typedef struct hash_t hash_t;

   
                                          
   
    typedef struct hash_index_t hash_index_t;

   
                                                  
                      
                                                                           
                                                                             
   
    typedef unsigned int (*hashfunc_t) (const char *key, int *klen);

   
                             
   
    unsigned int hashfunc_default (const char *key, int *klen);

   
                       
                                                               
                                      
    
  hash_t*  hash_make (void);

   
                                                  
                                                               
                                           
                                      
    
   hash_t*  hash_make_custom (hashfunc_t hash_func);

   
                              
                                    
                                                                       
                                      
                               
   
  hash_t*  hash_copy (const hash_t *ht);

   
                                                
                           
                                
                                                                                  
                                             
                                                          
   
  void  hash_set (hash_t *ht, const void *key
           , int klen, const void *val);

   
                                                           
                           
                                
                                                                                  
                                                  
   
   void*  hash_get (hash_t *ht, const void *key
            , int klen);

   
                                                    
                           
                                                                          
                                                                                    
                                                                             
                                                                            
                                                                 
                             

           
   
   
        
   
                                               
    
                        
                 
                   
                                                                
                                           
                              
        
                  
    
         
   
 hash_index_t*  hash_first (hash_t *ht);

   
                                                       
                                
                                                                                 
                   
   
 hash_index_t*  hash_next (hash_index_t *hi);

   
                                                            
                                
                                                        
                                                 
                                                      
                                                                                 
                                                                                 
   
 void  hash_this (hash_index_t *hi, const void **key
            , int *klen, void **val);

   
                                                       
                           
                                                           
   
   unsigned int  hash_count (hash_t *ht);

   
                                                                           
                                                                        
                                               
                                                       
                                                         
                                                                            
                                                                             
   
  hash_t*  hash_overlay (const hash_t *overlay, const hash_t *base);

   
                                                                 
                                                                 
                                                             
                                               
                                             
                                                         
                                              
                                                                
                                                                  
                   
                                                         
                                                                             
   
  hash_t*  hash_merge (const hash_t *h1
           , const hash_t *h2
            , void *(*merger) (const void *key
            , int klen, const void *h1_val, const void *h2_val
            , const void *data), const void *data);

   
                                                                  
                             
  
                                             
                                                 
   
int  
hash_contains_key (
        hash_t *ht, 
        const char *key);
                           
   
                                   
                                                   
                              
  
   
                           
int  hash_free(hash_t *ht);
                           
   
                                                  
                                               
                                                   
                             
   

int 
hash_free_void_arg (void *ht_void);

   
                                                         
                        
                             
   
typedef void (*free_key_func_t)(void *key);
typedef void (*free_data_func_t)(void *data);

int 
hash_free_all(hash_t *ht, free_key_func_t free_key, free_data_func_t free_data);

         

#ifdef __cplusplus
}
#endif

#endif                                       

                                                                               


                                              

                             
                        
               
                    
                                           
              
           

                                
                                                                        
                                 
  
                                                                               
#ifndef _HI_CONSTANT_H_
#define _HI_CONSTANT_H_

#define NODE_ID_LEN   20
#define MSGHEAD_SSC_LEN  6

#define ENV_WORKDIR    "WORKDIR"
#define ENV_LOCAL_ID   "ICS_LOCAL_ID"
#define ENV_APP_DIR    "ics.app.dir"
#define ENV_URL_DIR    "ics.plt.url_dir"
#define URL_RCV_TIMEOUT   "ics.plt.url_receive_timeout"
#define SHARE_FILE_MODE   "ics.plt.share_file_mode"

#define PLT_LOG_MESSAGE_FILE "ics.plt.log_message_file"
#define APP_LOG_MESSAGE_FILE "ics.app.log_message_file"
#define LOG_ERR_PATH   "ics.plt.log_error_path"
#define LOG_TRC_PATH   "ics.plt.log_trace_path"
#define LOG_PATH_MODE   "ics.plt.log_path_mode"
#define LOG_MAX_BUFFER   "ics.plt.log_max_buffer"
#define LOG_MAX_SIZE   "ics.plt.log_max_size"
#define LOG_DATETIME_FORMAT  "ics.plt.log_datetime_format"

              
#define ICS_PLT_LOG_MONFLAG  "ics.plt.log_mon_flag"
                                            
#define ICS_PLT_LOG_RECVOBJ  "ics.plt.log_recvobj"
                    
#define ICS_PLT_LOG_MONIP  "ics.plt.log_mon_ip"
                  
#define ICS_PLT_LOG_MONPORT  "ics.plt.log_mon_port"
          
#define ICS_PLT_LOGLEVEL  "ics.plt.loglevel"

                        
                                                              
#define STS_ISSUE_ITV   "ics.plt.status_issue_interval"
                                                
#define STS_CHECK_ITV   "ics.plt.status_check_interval"
                                                                                             
#define STS_SYNC_COND_ITV  "ics.plt.status_sync_condition_interval"
                                                                                           
#define STS_SYNC_AUTO_ITV  "ics.plt.status_sync_auto_interval"
                                                                                             
#define STS_ISSUE_COND_ITV  "ics.plt.status_issue_condition_interval"
                                                                                           
#define STS_ISSUE_AUTO_ITV  "ics.plt.status_issue_auto_interval"
                                               
#define STS_SYNC_WAIT_TIME  "ics.plt.status_sync_wait_time"
#define STS_REGISTER_WAIT_TIME "ics.plt.server_register_wait_time"

                                  
#define STS_HEART_THROB_ITV  "ics.plt.status_heart_throb_interval"

#define PUBBATINF_NAME   "ics.plt.pubbatinf_tablename"
#define ICS_PLT_SERVERNAME  "ics.plt.servername"
#define ICS_PLT_APPNAME   "ics.plt.appname"

#define GET_PATH_WORKDIR 1                        
#define GET_PATH_APPDIR  2                        
#define GET_PATH_X   3                                                 

#define LOG_MESSAGE_INIT_SIZE "ics.plt.log_msg_init_size"
#define DEFAULT_LOG_MESSAGE_SIZE 10240

                       
#define ICS_SYSDB_PRANAM    "ics.plt.sysdb"

                
#define ICS_8583_CFG "ics.app.8583_cfg_file"

  
               
             
             
   
#define ICS_STATISTIC_SWITCH "ics.plt.statistic_switch"

  
                    
   
#define ICS_TXN_TRACE_DIR "ics.app.txn_trace_dir"

  
                       
   
#define ICS_COMM_DATA_DIR "ics.app.comm_data_dir"

  
                       
                        
   
#define ICS_IF_SAVE_COMM_DATA "ics.app.if_save_comm_data"

  
                     
   
#define ICS_PLT_TRA_LOG_SWITCH "ics.plt.tra.logswitch"
              
#define ICS_PLT_TRA_DEFAULT_INTERVAL "ics.plt.tra.default_interval"
                      
#define ICS_PLT_TRA_DEFAULT_TRANTMOUT "ics.plt.tra.default_tran_timout"
                      
#define ICS_PLT_TRA_DEFAULT_EXPTRANTMOUT "ics.plt.tra.default_exp_tran_timout"
                  
#define ICS_PLT_TRA_DEFAULT_MAXFALTMS "ics.plt.tra.default_max_fault_times"
                      
#define ICS_PLT_COREDUMP_PATH "ics.plt.coredump_path"
  
#define ICS_PLT_SYSLOGGER "ics.plt.syslogger"

          
#define ICS_SEND_MSG_TIMEOUT_CTL "ics.plt.send_msg_timeout_control"

                                      
#define ICS_PLT_MMG_TURNING_SWITCH "ics.plt.mmg.turning_switch"
                           
#define ICS_PLT_MMG_LOW_LOAD_LEVEL "ics.plt.mmg.low_load_level"
                      
#define ICS_PLT_MMG_LOW_LOAD_POINT "ics.plt.mmg.low_load_point"


                                        
                     
#define DEVELOP_PLTFORM "DP"
#define MON_PLTFORM  "MP"

              
#define ICS_PLT_CTL_DEBUG_SWITCH      "ics.app.debug_switch"
#define ICS_PLT_CTL_DEBUG_IP          "ics.app.trace_ip"
#define ICS_PLT_CTL_DEBUG_PORT                "ics.app.trace_port"

                      
#define ICS_PLT_SEND_TIMEOUT  "ics.plt.send_timeout"

#endif                      

#ifndef _HIPUBPRA_H_
#define _HIPUBPRA_H_







#ifdef _LIB_PUBPRA
#define EXTERN
#else
#define EXTERN extern
#endif

            
EXTERN char * usfGetPubPara(char *name);

               
                                               
   
EXTERN char * usfGetPathPara(char *name);

  
           
   
EXTERN int usfSetPubPara(char *name, char *value);

  
           
                                 
   
EXTERN int usfLoadPubPara(char *para_file);

  
                   
                 
                                    
                                    
                                                                             
   
EXTERN int usfGetFullPath(int flag, char *filename, char *fullpath);

  
                 
   
EXTERN char * usfGetLocalID();

  
                   
   
EXTERN long usfGetNodeIP(char *id, char *ip);

  
                 
   
EXTERN long usfGetLocalIP(char *ip);

#undef EXTERN
#endif


#ifndef TRUE
#define TRUE           1
#endif
#ifndef FALSE
#define FALSE          0
#endif

#define TRACE_OFF    0                          
#define TRACE_ON    1                          

#define NAMES_LEN      60                   
#define PRIORITYS      5                    
#define RQST_ID_LEN    20                   
#define MSG_TYPE_LEN   6                    
#define FLD_NAME_LEN   3                              
#define SVR_ADDR_LEN   15                       
#define SVR_NAME_LEN   8                        
#define SVR_ID_LEN     6                      
#define SVR_TYPE_LEN   3                        
#define POS_ID_LEN     4                              
#define MSG_ID_LEN     4                    
#define MAX_QPAIR_NUM  5                                          

#ifndef _HI_DBDSC_H_
#define _HI_DBDSC_H_

#ifndef _HI_DBDS_H_
#define _HI_DBDS_H_

#ifndef _HI_DBCONN_HANDLE_H_
#define _HI_DBCONN_HANDLE_H_
#include <stdio.h>
#ifndef _HI_DB_DRIVER_
#define _HI_DB_DRIVER_

#ifndef _LIB_DBALOG_H_
#define _LIB_DBALOG_H_






#ifndef _LIB_DBA_LOG_
#define EXTERN extern
#else
#define EXTERN
#endif
#undef EXTERN

#endif                   

                                                                               

                                                          

                         
                                
                     
                            
                                    
                    
                 

                                            
                                                                              
                                    

                                                                               
#ifndef _HIETF_H_
#define _HIETF_H_

typedef void ETF;

                    
#define MSG_SEP_CHR  '.'

#ifdef _HIETF_LIB_
#define EXTERN
#else
#define EXTERN extern
#endif

                                                                          
                                                                          

                                                                         
                             
                         
             
                                  
                            
                            
               
                                       
                                                                         
EXTERN ETF * etfNewNode(char * name, char * data, int dataLen);

                                                                         
                                  
                             
            
                                            
               
                         
                                                                         
EXTERN char * etfGetNodeName(ETF * node);

                                                                          
                                  
                                                                
                                                             
             
                            
                            
             
             
                      
                         
                                                                         
EXTERN ETF * etfAppendNode(ETF * parent, ETF * child);

                                                                         
                                  
                               
             
                          
                                           
                            
             
             
                      
                         
                                                                         
EXTERN ETF * etfGetChildNode(ETF * parent, ETF * ref_child, char * name);

                                                                          
                             
                                     
             
                          
                                 
                            
             
             
                      
                         
                                                                         
EXTERN ETF * etfGetNode(ETF * parent, ETF * ref_child, char * name);

                                                                          
                                 
                                 
             
                           
             
             
                      
                         
                                                                         
EXTERN ETF * etfGetRootNode(ETF * node);

                                                                         
                            
                                                    
             
                       
               
             
                
                 
                                                                         
EXTERN int  etfFreeNode(ETF * node);

                                                                         
                           
                                                     
             
                          
                            
                            
                            
               
             
                
                 
                                                                         
EXTERN int  etfAddNode(ETF * parent, char * name, char * data, int dataLen);

                                                                         
                                
                                                                             
             
                          
                            
                            
                            
               
             
                
                 
                                                                         
EXTERN int  etfAddOrRepNode(ETF * parent, char * name, char * data, int dataLen);

                                                                         
                            
                               
             
                             
                                              
                            
                            
               
             
                
                 
                                                                         
EXTERN int  etfSetValue(ETF * root, char * name, char * data, int dataLen);

                                                                         
                                 
                                 
             
                             
                                              
                            
                            
               
             
                
                 
                                                                         
EXTERN int  etfSetChildValue(ETF * root, char * name, char * data, int dataLen);

                                                                         
                            
                               
             
                                  
                                     
                                        
             
                                     
             
                           
                 
                                                                         
int etfGetValue(ETF * root, char * name, char * data, int maxlen);

                                                                         
                                  
                               
             
                                  
                                     
             
                                   
             
                                  
                     
                                                                         
char * etfReturnValue(ETF * root, char * name, int * datalen);

                                                                         
                                 
                                 
             
                                  
                                     
                                        
             
                                     
             
                           
                 
                                                                         
EXTERN int etfGetChildValue(ETF * root, char * name, char * data, int maxlen);

                                                                         
                                       
                                 
             
                                  
                                     
             
                                   
             
                                  
                     
                                                                         
char * etfReturnChildValue(ETF * root, char * name, int * datalen);

                                                                         
                                      
                               
             
                                    
             
                                   
             
                                  
                     
                                                                         
char * etfReturnNodeValue(ETF * root, int * datalen);

                                                                         
                              
                                                                  
             
                         
               
             
                
                                                                         
EXTERN int  etfDelAllNode(ETF * root);

                                                                         
                           
                                                                          
             
                       
                                                         
               
             
                
                                                                         
EXTERN int  etfDelNode(ETF * node, char * name);

                                                                         
                               
                                 
             
                         
               
             
                               
                  
                                                                         
EXTERN ETF * etfCloneNode(ETF * root);

                                                                      

                                                                         
                                  
                                             
             
                           
             
                          
             
                               
                  
                                                                         
EXTERN char * etfTree2Stream(ETF * root, int * len);

                                                                         
                               
                                             
             
                                 
                                
             
                                             
             
                
                 
                                                                         
EXTERN int etfStream2Tree(char * stream, int strlen, ETF ** root);

                                                                         
                                    
                                                                     
             
                                         
                                       
             
                      
             
                
                 
                                                                         
EXTERN int etfCombineNoReplace(ETF * d_root, ETF * s_root);

                                                                         
                                  
                                                                   
             
                                         
                                       
             
                      
             
                
                 
                                                                         
EXTERN int etfCombineReplace(ETF * d_root, ETF * s_root);

                                                                         
                              
                         
             
                                          
                                     
             
                      
             
                
                 
                                                                         
EXTERN int etfNodeRename(ETF * node, char * name);

                                                                         
                                   
                           
                                          
             
                                          
                                    
                           
                                                                         
EXTERN ETF * etfGetFirstChild(ETF * parent);

                                                                         
                                 
                             
                                              
             
                                              
                                    
                           
                                                                         
EXTERN ETF * etfGetNextNode(ETF * node);

                                                                         
                                
                             
                                              
                                
                                      
                               
                                    
                           
                                                                         
EXTERN int etfGetNodeValue(ETF * node, char * data, int maxlen);

                                                                         
                                
                                 
                                              
               
                                 
                                    
                           
                                                                         
EXTERN ETF * etfRemoveNode(ETF * node);

                                                                         
                                  
                           
                                              
                                            
                                            
               
                                 
                                    
                           
                                                                         
int etfSetAttrValue(ETF * node, char *name, char *value);

#undef EXTERN

#endif                






#define DRIVER_DB_SPECDATA_FILE "etc/DBSPECSQL_PUB.XML"

typedef void * conn_context;

struct _db_driver {
                   
 char * db_type;
                 
 char * driver_file;  
                 
 void * driver_handle;
                 
 void * driver_data;
                       
 hash_t * db_specdatas;
                           
 int (*dbtsqlquery)(ETF *, char *, int *, conn_context, long *sqlcode);
                                        
 int (*dbtsqlquery_limit)(ETF *, char *, int, int *, conn_context, long *sqlcode);
                                      
 int (*dbtsqlqueryrec)(ETF *, char *, conn_context, long *sqlcode);
                                  
 int (*dbtsqlinsrec)(ETF *, char *, conn_context, long *sqlcode);
                                  
 int (*dbtsqlrdrec)(ETF *, char *, char *, char *, int, conn_context, long *sqlcode);
                                
 int (*dbtsqlupdrec)(ETF *, char *, char *, char *, int, conn_context, long *sqlcode);
                        
 int (*dbtsqlqueryxml)(ETF *, char *, int *, conn_context, long *sqlcode);
                                                            
 int (*dbtsqlinsrecxml)(ETF *, XmlNode *, char *, conn_context, long *sqlcode);
                                  
 int (*dbtsqlrdrecxml)(ETF *, char *, char *, char *, int, conn_context, long *sqlcode);
                                                          
 int (*dbtsqlupdrecxml)(ETF *, XmlNode *, char *, char *, char *, int, conn_context, long *sqlcode);
                                                          
 int (*dbtsqldelrecdaxml)(ETF *, XmlNode *, char *, char *, conn_context, long *sqlcode);
                    
 int (*dbtsqlcursor)(ETF *, char *, void **, unsigned char, conn_context, long *sqlcode);
                                                  
 int (*dbtextquery)(ETF *, char *, char *, int *, conn_context, long *sqlcode);
                                                                  
 int (*dbtextquery_limit)(ETF *, char *, char *, int, int *, conn_context, long *sqlcode);
                                      
 int (*dbtextinsrec)(ETF *, char *, conn_context, long *sqlcode);
                                                                
 int (*dbtextinsrecxml)(ETF *, XmlNode *, char *, conn_context, long *sqlcode);
                                                  
 int (*dbtextrdreccon)(ETF *, char *, char *, conn_context, long *sqlcode);
                                     
 int (*dbtextdelreccon)(char *, char *, conn_context, long *sqlcode);
                                              
 int (*dbtextupdreccon)(ETF *, char *, char *, conn_context, long *sqlcode);
                                                                        
 int (*dbtextupdrecconxml)(ETF *, XmlNode *, char *, char *, conn_context, long *sqlcode);
                                
 int (*dbtextcursor)(ETF *, char *, char *, void **, unsigned char, conn_context, long *sqlcode);
                                                         
 int (*dbtsqlupdrecdaxml)( ETF *, XmlNode *, char *, char *, conn_context, long *);
                                          
 int (*dbtsqlcursor_x)(ETF *, char *, void **, unsigned char, char *, conn_context, long *);
 int (*dbtextcursor_x)(ETF *, char *, char *, void **, char, char *, conn_context, long *);
                              
                              
                         
                        
                        
                             
    
 int (*dbttestdbconn)(void * driver_data, conn_context ctx, long *sqlcode);
 
               
 int (*dbtconndb)(void * driver_data, conn_context * ctx, long *sqlcode);
                   
 int (*dbtclosedbconn)(void * driver_data, conn_context  ctx, long *sqlcode);
               
 int (*dbtsetctx)(void * driver_data, conn_context ctx, long *sqlcode);
               
 int (*dbtunsetctx)(void * driver_data, conn_context ctx, long *sqlcode);
             
 int (*dbtrollback)(conn_context, long *sqlcode);
             
 int (*dbtcommit)(conn_context, long *sqlcode);
                      
 int (*dbtexecsql)(char * sql_cmd, conn_context, long *sqlcode);
               
 void * (*dbtinitdriver)(XmlNode * init_info);
                                                              
     void (*dbtenddriver)(void * driver_data);
};

typedef struct _db_driver DBDriver;

#ifndef _LIB_HI_DRIVER_
#define EXTERN extern
#else
#define EXTERN 
#endif
EXTERN DBDriver * loadDBDriver(char * driver_name, char * db_type, XmlNode * db_info);
EXTERN void deleteDBDriver(DBDriver * driver);
EXTERN char * dbdGetSpecData(DBDriver * driver, char * name);
#undef EXTERN

#endif                   


struct _db_con_handle {
 short         ds_id;                
 short         con_id;                    
 conn_context  ctx;               
 DBDriver      * driver;                  
};
typedef struct _db_con_handle DBConHandle;

struct _db_conn_rec {
 char                  * ds_name;                 
 short                 ds_id;                   
 DBConHandle          * handle;                  
 struct _db_conn_rec   * next;
};
typedef struct _db_conn_rec DBConnRec;

#ifndef _LIB_DBCONN_HANDLE_
#define EXTERN extern
#else
#define EXTERN
#endif

EXTERN DBConnRec * hdlAddConnRec(DBConnRec ** head, char * ds_name, short ds_id, DBConHandle * handle);
EXTERN int hdlDelConnRec(DBConnRec ** head, DBConHandle * handle);
EXTERN int hdlDelAllConnRec(DBConnRec ** head);
EXTERN DBConnRec * hdlQryConnRec(const DBConnRec * head, const char * ds_name);

#undef EXTERN

#endif                         





#ifndef _HI_DBPOOL_H_
#define _HI_DBPOOL_H_










struct _context_entry{
 short   id;                
 conn_context ctx;              
 short   rpt;                    
 struct _context_entry  * next;
};
typedef struct _context_entry ContextEntry;

struct _db_conn_pool {
 short          conn_num;                   
 short          busy_num;                     
 short          ill_num;                      
 short          idle_num;                     
 ContextEntry   * space;                                
 ContextEntry   * idle_head;                    
 ContextEntry   * ill_head;                     
 ContextEntry   ** busy_conn;                     
 XmlNode     * conn_info;                      
 pthread_mutex_t con_lock;                
 pthread_cond_t  con_cond;                  
};
typedef struct _db_conn_pool DBConnPool;

#ifndef _LIB_DB_POOL_
#define EXTERN extern
#else
#define EXTERN
#endif
  
                    
EXTERN DBConnPool * dbcpCreate(int num, DBDriver * driver, XmlNode * info);
                    
EXTERN void dbcpDestroy(DBConnPool * dbpool, DBDriver * driver);
                  
EXTERN int dbcpBackConn(DBConnPool * dbpool, DBConHandle * handle);
                  
EXTERN int dbcpGetConn(DBConnPool * dbpool, 
         DBConHandle * handle, 
         long timeout);
                        
EXTERN int dbcpIsUseable(DBConnPool * dbpool);
                      
EXTERN  XmlNode * dbcpPrintState(DBConnPool * dbpool);
                              
EXTERN  int dbcpCheckAndRepair(DBConnPool * dbpool, 
          DBDriver * driver, 
          short max_times,
          int * ill_count,
          int  * repaied_count);
#undef EXTERN

#endif                  

#include <pthread.h>

struct _db_datasource {
 short        id;                            
 char         * name;                          
 DBDriver     * driver;                        
 DBConnPool   * pool;                            
 pthread_t    test_thread;                             
 unsigned int test_interval;                     
 short int    max_reconn_times;                    
};
typedef struct _db_datasource DBDataSource;

#ifndef _LIB_DBDS_
#define EXTERN extern
#else
#define EXTERN
#endif

              
EXTERN DBDataSource * dbdsCreate(   short id, \
         char * ds_name, \
         char * ds_type, \
         char * driver_name, \
         int pool_size, \
         unsigned int test_interval, \
         short max_reconn_times, \
         XmlNode * conn_info);
              
EXTERN void dbdsDestroy(DBDataSource * dbds);

                          
EXTERN int dbdsGetConn(DBDataSource * dbds, DBConHandle * handle, long timeout);

                          
EXTERN int dbdsBackConn(DBDataSource *dbds, DBConHandle * handle);

                  
EXTERN const char * dbdsGetName(DBDataSource *dbds);

EXTERN XmlNode * dbdsPrintState(DBDataSource *ds);
#undef EXTERN

#endif                






struct _datasource_leaf {
 DBDataSource  * ds;
 unsigned int  radix;
 unsigned int  remain;
 struct _datasource_leaf * next;
};
typedef struct _datasource_leaf DataSourceLeaf;

struct _datasource_trunk {
 char     * name;
 unsigned int   ds_leaf_num;
 DataSourceLeaf   * leaf_head;
 pthread_mutex_t   lock;
 DataSourceLeaf   * curr;
 struct _datasource_trunk * next;
};
typedef struct _datasource_trunk DataSourceTrunk;

struct _datasource_container {
  short            ds_num;                      
  DBDataSource     **dbds;                        
  DataSourceLeaf   * dslf;
  DataSourceTrunk  * dstk;
};
typedef struct _datasource_container DataSourceContainer;

#ifndef _LIB_DBDSC_
#define EXTERN extern
#else
#define EXTERN
#endif
                  
EXTERN DataSourceContainer * dbdscCreate(XmlNode * server_node, int * retcod);
                  
EXTERN void dbdscDestroy(DataSourceContainer * dsc);
                              
EXTERN int dbdscGetConn(DataSourceContainer *dsc, 
      char     *ds_name, 
      DBConHandle   * handle,
      long    timeout);
                              
EXTERN int dbdscBackConn(DataSourceContainer *dsc, DBConHandle * handle);

EXTERN XmlNode * dbdscPrintContainerState(DataSourceContainer *dsc);
EXTERN const char * dbdscGetDefaultDS(DataSourceContainer *c);
EXTERN const char * dbdscGetDSNameFromId(DataSourceContainer * dsc, short dsid);
#undef EXTERN

#endif                 

#ifndef _HI_USF_DB_API_H_
#define _HI_USF_DB_API_H_




#ifndef _LIB_USF_DB_API_
#define EXTERN extern
#else
#define EXTERN
#endif                     

EXTERN int usfSetDBAccessEnv(void * lib_handle);
EXTERN int initDBConnectionPool(void);
EXTERN void freeDBConnectionPool(void);
EXTERN int setDBEnvForTaskModule(void);
EXTERN int usfOpenDBConnection(const char * ds_name, DBConHandle * handle, long timeout);
EXTERN int usfCloseDBConnection(DBConHandle * handle);
EXTERN int usfCloseAllDBConnection(void);
EXTERN int usfDBIsConnected(const char * ds_name);
EXTERN int usfSetDBContext(DBConHandle *handle);
EXTERN DBConHandle * usfGetCurrConnHandle(void);
EXTERN int usfSwitchDataSource(DBConHandle * handle, const char * ds_name, long timeout);
EXTERN short usfSwitchToSysDS(DBConHandle * handle, long timeout);
EXTERN int usfSwitchToDsOfID(DBConHandle * handle, short ds_id, long timeout);
#undef EXTERN
#endif                     

#ifndef _HI_DADABASE_
#define _HI_DADABASE_

#define DB_USERNAME_MAX_LEN 128                             
#define DB_PASSWORD_MAX_LEN 128                           

                                           
                                                       
                                                     
                                                               
                                                            
  
                                             
                                                  
                                                 
                                                    
                                                  
                                                      
                                                
                                                                
                                                              
                                                  
                                                     
                                             
                                                      
                                                      
                                                     
                     
  
                                                 
                                                     
                                                          
                                                            
  
                                             
                                                  
                                                 
                                                    
                                                  
                                                   
                                                
                                                            
                                                           
                                                 
                                                  
                                             
                                                  
                                                     
                                                     
                  

   
                                             
    
#define SQL_SUCCESS  (atol(dbdGetSpecData(DBHandle->driver, "SQL_SUCCESS")))
#define SQL_NOTFOUND (atol(dbdGetSpecData(DBHandle->driver, "SQL_NOTFOUND")))
#define SQL_ERRSYN (atol(dbdGetSpecData(DBHandle->driver, "SQL_ERRSYN")))
#define SQL_IVDCOL (atol(dbdGetSpecData(DBHandle->driver, "SQL_IVDCOL")))
#define SQL_IVDCNN (atol(dbdGetSpecData(DBHandle->driver, "SQL_IVDCNN")))
#define SQL_IVDCSR (atol(dbdGetSpecData(DBHandle->driver, "SQL_IVDCSR")))
#define SQL_NOTDCL (atol(dbdGetSpecData(DBHandle->driver, "SQL_NOTDCL")))
#define SQL_ERRPRM (atol(dbdGetSpecData(DBHandle->driver, "SQL_ERRPRM")))
#define SQL_NULVAL (atol(dbdGetSpecData(DBHandle->driver, "SQL_NULVAL")))
#define SQL_REINSERT (atol(dbdGetSpecData(DBHandle->driver, "SQL_REINSERT")))
#define SQL_DELRKERR (atol(dbdGetSpecData(DBHandle->driver, "SQL_DELRKERR")))
#define SQLERRMSG "sqlcode"

#endif                    


                      
struct _thread_id_node {
    short     cancel_flg;                               
    pthread_t tid;                              
    struct _thread_id_node * next;                          
};
typedef struct _thread_id_node ThreadIdNode;

                      
struct _thread_id_rec {
    short total;                            
    ThreadIdNode * head;                      
    ThreadIdNode * tail;                      
    pthread_mutex_t id_lock;                    
};
typedef struct _thread_id_rec ThreadIdRec;

                
struct _msg_head_node {
    char   fld_name[FLD_NAME_LEN+1];              
    short  fld_id;                                  
    short  fld_len;                                 
    char * fld_val;                                 
    struct _msg_head_node * next;                             
};
typedef struct _msg_head_node MsgHeadNode;

          
struct _message {
    char   request_id[RQST_ID_LEN+1];                
    char   msg_type[MSG_TYPE_LEN+1];                 
    short  msg_priority;                                 
    short  msg_splited;                                  
    long   msg_id;                                  
    long   msg_size;                                 
    MsgHeadNode * msg_head;                        
    char * msg_text;                                 
};
typedef struct _message Message;

                      
struct _syn_request_node {
    short           qpair_id;                                          
    short           slot_id;                                 
    char            request_id[RQST_ID_LEN+1];               
    long            bgn_exist_time;                                
    Message *       response_msg;                                        
    pthread_mutex_t notify_lock;                                              
    pthread_cond_t  notify_cond;                                   
};
typedef struct _syn_request_node SynRequestNode;

                  
struct _msg_cache_node {
    Message * q_msg;                            
    struct _msg_cache_node * next;                              
};
typedef struct _msg_cache_node MsgCacheNode;

                    
struct _big_msg_node {
    char            msg_type[MSG_TYPE_LEN+1];                 
    char            request_id[RQST_ID_LEN+1];                
    MsgCacheNode *  msg_link_head;                                  
    pthread_mutex_t msg_link_lock;                                      
    pthread_cond_t  notify_cond;                                    
    long            bgn_exist_time;                                 
};
typedef struct _big_msg_node BigMsgNode;

                             
struct _msg_task_node {
    char msg_type[MSG_TYPE_LEN+1];                
    char p_module[NAMES_LEN+1];                       
    int (* p_task)(Message *);                              
    struct _msg_task_node * next;                           
};
typedef struct _msg_task_node MsgTaskNode;

           
struct _queue {
    pthread_t       deliver_tid;                                              
    short           q_high_water;                           
    short           q_low_water;                            
    short           q_max_length;                                 
    short           max_serv_worker;                                            
    short           serving_worker;                                           
    Message **      msg_q[PRIORITYS];                         
    short           q_queue_head[PRIORITYS];                
    short           q_queue_tail[PRIORITYS];                
    short           q_curr_length[PRIORITYS];                     
    short           q_water_flag[PRIORITYS];                      
    short           q_de_priority[PRIORITYS];                                  
    pthread_mutex_t en_de_lock;                                 
    pthread_cond_t  en_notify_cond[PRIORITYS];                        
    pthread_cond_t  de_notify_cond;                                   
    MemoryPool *    big_msg_list;                                   
    pthread_mutex_t big_msg_lock;                                       
    MsgTaskNode *   msg_tasks;                                              
    pthread_mutex_t msg_tasks_lock;                                   
    char            default_module[NAMES_LEN+1];                      
    int (* default_task)(Message *);                              
    pthread_mutex_t xxx_lock;                                   
    pthread_cond_t  xxx_cond;                                         
};
typedef struct _queue Queue;

            
struct _queue_pair {
    short           qpair_id;                                 
    char            qpair_name[NAMES_LEN+1];                  
    Queue           request_q;                              
    Queue           response_q;                             
    MemoryPool *    syn_request_list;                           
    pthread_mutex_t syn_list_lock;                                        
};
typedef struct _queue_pair QueuePair;

              
struct _queue_alias {
    short qpair_id;                                 
    char  qpair_name[NAMES_LEN+1];                  
    short queue_type;                             
};
typedef struct _queue_alias QueueAlias;

                  
struct _dll_node {
    char   lib_name[NAMES_LEN+1];              
    void * lib_handle;                             
    void (* donefunc)();                                   
    struct _dll_node * next;                               
};
typedef struct _dll_node DllNode;

                    
struct _worker_thread_rec {
    pthread_t       worker_tid;                                    
    Message *       processed_msg;                                     
    QueueAlias *    calling_qpair;                                     
    long            bgn_exec_time;                             
    char *          executing_module;                                  
    DBConnRec       * using_db_conn;                                
    DBConnRec       * curr_db_conn;                                           
    short           cleaner_num;                                       
    pthread_mutex_t notify_lock;                                       
    pthread_cond_t  notify_cond;                                             
};
typedef struct _worker_thread_rec  WorkerThreadRec;

                    
struct _thread_pool_rec {
    pthread_t manager_tid;                                 
    short     min_thread_num;                                
    short     max_thread_num;                                    
    short     curr_thread_num;                       
    short     busy_thread_num;                   
    short     allot_policy;                        
    short     polling_time;                              
    short     tuning_or_not;                                 
    short     high_load_level;                   
    short     high_load_point;               
    short     high_load_times;                                   
    short     low_load_level;                    
    short     low_load_point;                
    short     low_load_times;                                    
    short     start_thread_step;                         
    short     stop_thread_step;                          
    short     be_tuned_num;                    
};
typedef struct _thread_pool_rec ThreadPoolRec;

                        
struct _idler_thread_rec {
    short           first_idler;                                        
    short           last_idler;                                           
    short *         idler_list;                             
    pthread_mutex_t idler_lock;               
    pthread_cond_t  idler_cond;                                  
};
typedef struct _idler_thread_rec IdlerThreadRec;

                  
struct _empty_pos_rec {
        short    first_pos;                    
        short    last_pos;                       
        short *  pos_list;                     
};
typedef struct _empty_pos_rec EmptyPosRec;

                  
struct _thread_spec_data {
        short worker_id;
        short qpair_id;
        short queue_type;
};
typedef struct _thread_spec_data ThreadSpecData;

struct _pub_runtime_env_rec {
        char               svr_addr[SVR_ADDR_LEN+1];                  
        char               svr_name[SVR_NAME_LEN+1];                  
        char               svr_type[SVR_TYPE_LEN+1];                  
        short              svr_id;                                  
        QueuePair **       qarray;                                    
        short              q_num;                                   
        long               seq_no;                                          
        pthread_mutex_t    seq_lock;                                  
        long               clock;                                   
        pthread_mutex_t    clock_lock;                            
        pthread_cond_t     clock_cond;                                  
        long               tr_count;                                      
        short *            cancel_flags;                            
        short *            busy_flags;                            
        pthread_mutex_t    cancel_lock;                                   
        long               max_timeout;                                     
        ThreadPoolRec      tpool;                                     
        WorkerThreadRec ** tworkers;                                
        IdlerThreadRec     tidlers;                                     
        long               portal;                                      
        short              is_closing;                                  
  char *             workdir;                                         
  int                log_flag;                                    
  char      syslog_file[NAMES_LEN+1];                          
  char      errlog_file[NAMES_LEN+1];                          
  XmlNode *          region_node;                                 
     
                  
                                   
     
  char      ap_name[SVR_NAME_LEN+1];               
  LoggerMessage *  logger_msg;                    
  Logger    *  sys_logger;                      
  Logger    *  trc_logger;                      
  Logger    *  err_logger;                      
};
typedef struct _pub_runtime_env_rec PubRuntimeEnvRec;

  
            
                                 
   
typedef struct _QueueInformation{
 long ServingNum;
 long QueueNum[PRIORITYS];
}QueueInformation;

  
                
                                 
   
typedef struct _QPairInformation{
 QueueInformation Request;
 QueueInformation Response; 
}QPairInformation;

  
               
                                 
   
typedef struct _ServerInformation{
 char     * Name; 
 long     Status;
 long    StartTime;
 long    ServerID;
 long    ProcessID;
 char    IPAddr[15+1];
 long    Portal;
 long    TraceSwitch;
 long    MaxWorkerNum;
 long    BusyWorkerNum;
 long    QPairNum;
 QPairInformation QPair[MAX_QPAIR_NUM];
}ServerInformation;

  
                   
                                 
   
typedef struct _InterfaceDefine{
 char      * Name; 
 struct _InterfaceDefine * Next;
}InterfaceDefine;


  
                   
                                       
   
struct _comp_ctx_info
{
 char   comp_name[64];
 struct timeval total_time;
 long   total_count;
};
typedef struct _comp_ctx_info CompCtxInfo;

  
           
                                 
   
typedef struct _ServiceInformation{
 char    * Name; 
 char   * ServerName;
 long    Status;
 long            Monitor;
 InterfaceDefine * MustInput;
 InterfaceDefine * OptionInput;
 InterfaceDefine * Output;
 InterfaceDefine * Fault;
 double   CurrTime;
 double   TotalTime;
 long   InvokeCount;
 long   FaultCount;
 long   UnsuccessfulCount;
 long   SuccessfulCount;
   
                                       
               
    
 hash_t   * comps_ctx_info;
}ServiceInformation;

  
           
                                 
   
typedef struct {
 pthread_rwlock_t ServersLock;
 DataSource   * Servers;
 int     ServersFlag;
 
 pthread_rwlock_t LocalServicesLock;
 int     UpdateLocalService;
 DataSource   * LocalServices;
 DataSource   * BakLocalServices;
 
 pthread_rwlock_t RemoteServicesLock;
 DataSource   * RemoteServices;
}GlobalInformation;

              
#ifndef SERVER_EXTERN
#define SERVER_EXTERN
#define EXTERN
#else
#define EXTERN extern
#endif
EXTERN PubRuntimeEnvRec * _PubRuntimeEnv;                        
EXTERN EmptyPosRec        _EmptyPosReg;                      
EXTERN pthread_key_t *    _CallingQPair;                             
EXTERN pthread_attr_t     _ThreadAttr;
EXTERN XmlDocument *      _DomTreeRootNode;                             
EXTERN XmlNode *          _RegionNode;                   
EXTERN XmlNode *          _ServerNode;                       
EXTERN DllNode *          _DllOpenRegList;                             
EXTERN ThreadIdRec        _ThreadIdList;                       
EXTERN DataSourceContainer *   _DBConnectionPool;                   
  
           
                                 
   
EXTERN GlobalInformation * _GlobalInf;                        
#undef EXTERN

#ifdef _LIB_SOME_CLEANER
#define EXTERN
#else
#define EXTERN extern
#endif
EXTERN void parserCleaner(void *);
EXTERN void documentCleaner(void *);
EXTERN void nodeCleaner(void *);
EXTERN void builderCleaner(void *);
EXTERN void charCleaner(void *);
EXTERN void clockCleaner(void *);
#undef EXTERN

#ifdef _LIB_MSG_OP1
#define EXTERN
#else
#define EXTERN extern
#endif
EXTERN int  usfGetMsgHeadValue(Message *, char *, char *);
EXTERN int  usfAddMsgHeadValue(Message *, char *, char *, short);
EXTERN int  usfSetMsgHeadValue(Message *, char *, char *, short);
EXTERN int  usfSetMsgData(Message *, char *, long);
EXTERN void usfFreeMsgData(Message *);
EXTERN void usfDelMsgHeadValue(Message *, char *);
EXTERN void usfDestroyMsg(Message *);
EXTERN Message * usfDupMsgFrame(Message * msg);
EXTERN Message * usfCreateMsg(char * msg_type);
EXTERN XmlNode * usfGetRegionNode();
EXTERN char * usfGetRegionName();
EXTERN int usfGetRequestID(char *);
#undef EXTERN

#ifdef _LIB_MSG_OP2
#define EXTERN
#else
#define EXTERN extern
#endif
EXTERN Message * usfCreateMsgByString(char *, long);
EXTERN Message * usfCreateMsgByHeadString(char *, long);
EXTERN int usfMsgToString(Message *, char **, long *);
EXTERN int usfMsgToHeadString(Message *, char **, long *);
#undef EXTERN

#ifdef _LIB_QPAIR_OP1
#define EXTERN
#else
#define EXTERN extern
#endif
EXTERN int usfAddNodeInBigmsgRegLink(Queue *, char *, char *);
EXTERN int usfAddNodeInMsgLink(Queue *, Message *);
EXTERN int usfMsgEnQueue(Queue *, Message *);
EXTERN int usfGetNextMsgFromQueue(Queue * , Message *, long, Message **, short *);
EXTERN int usfPutMsgInQueueAsyn(Queue *, Message *);
EXTERN int usfPutMsgInQueueSyn(QueuePair *, Message *, long, Message **);
EXTERN int usfReceiveResponseFromQPair(QueuePair *, SynRequestNode *, long, Message **);
EXTERN int usfSendRequest(Message *);
EXTERN int usfSendRequestToLeft(Message *);
EXTERN int usfSendRequestToRight(Message *);
EXTERN int usfSendResponse(Message *);
EXTERN int usfSendResponseToLeft(Message *);
EXTERN int usfSendResponseToRight(Message *);
EXTERN int usfReceiveResponse(SynRequestNode *, long, Message **);
EXTERN int usfRetrieveNextRequestMsg(Message *, long, Message **, short *);
EXTERN int usfRetrieveNextResponseMsg(Message *, long, Message **, short *);
EXTERN int usfSendRequestAndWaitResponse(Message *, long, Message **);
EXTERN int usfSendRequestToRightAndWaitResponse(Message *, long, Message **);
EXTERN int usfSetPubRuntimeEnv(void *);
EXTERN int usfSendResponseWhenError(Message *, char *, char *);
EXTERN int usfIsNotify(Message *);
EXTERN int usfIsRequest(Message *);
EXTERN int usfSetNotify(Message *);
EXTERN int usfSetTrace(Message *);
#undef EXTERN

#ifdef _LIB_QPAIR_OP2
#define EXTERN
#else
#define EXTERN extern
#endif
EXTERN int usfCall(Message *, char *, void *, char *, long, long, void **, char *, long *, Message **);
EXTERN int usfGetReply(SynRequestNode * synd, long timeout, void ** out_data, char * out_type, long * out_len, Message ** rpmsg);
EXTERN int usfForward(Message *, char *, void *, char *, long);
EXTERN int usfReturn(Message *, void *, char *, long);
EXTERN int usfNotify(Message *);
EXTERN int usfNotifyToLeft(Message *);
EXTERN int usfNotifyToRight(Message *);
EXTERN int usfParsing(Message *, void **);
EXTERN void usfRemoveAllSubMsg(Message *);
EXTERN SynRequestNode * usfCallAsyn(Message *, char *, void *, char *, long);
#undef EXTERN

#ifdef _LIB_THREAD_BASE
#define EXTERN
#else
#define EXTERN extern
#endif
EXTERN int createThread(pthread_t *, const pthread_attr_t *, void * (*)(void *), void *);
EXTERN int cancelThread(pthread_t);
EXTERN void waitNSecond(int);
EXTERN void waitNMilliSecond(long);
#undef EXTERN

#ifdef _LIB_INF_MNG
#define EXTERN
#else
#define EXTERN extern
#endif
EXTERN int initGlobalInformation();
EXTERN void freeGlobalInformation();
EXTERN int  lockWriteLocalServices();
EXTERN int  lockReadLocalServices();
EXTERN int  unlockLocalServices();
EXTERN int  lockWriteRemoteServices();
EXTERN int  lockReadRemoteServices();
EXTERN int  unlockRemoteServices();
EXTERN void freeInterfaceDefine(InterfaceDefine *);
EXTERN void freeServers(DataSource *);
EXTERN void freeServerInformation(ServerInformation *);
EXTERN InterfaceDefine * createInterfaceDefine(char *);
EXTERN ServerInformation * newServerInformation(char *, long);
EXTERN ServerInformation * addServerInformation(char *, long);
EXTERN ServerInformation * getServerInformation(char *, long);
EXTERN void deleteServerInformation(char *, long);
EXTERN ServiceInformation * newServiceInformation(char *);
EXTERN ServiceInformation * addServiceInformation(DataSource *, char *);
EXTERN ServiceInformation * addLocalService(char *);
EXTERN ServiceInformation * addRemoteService(char *);
EXTERN ServiceInformation * getServiceInformation(DataSource *, char *);
EXTERN ServiceInformation * getLocalService(char *);
EXTERN ServiceInformation * getRemoteService(char *);
EXTERN void deleteServiceInformation(DataSource *, char *);
EXTERN void deleteLocalService(char *);
EXTERN void deleteRemoteService(char *);
EXTERN void freeServiceInformation(ServiceInformation *);
EXTERN void freeServices(DataSource *);
#undef EXTERN

#ifdef _LIB_XML_OP
#define EXTERN
#else
#define EXTERN extern
#endif
EXTERN int xmlchg(XmlDocument *, char *, int, char *);
EXTERN int xmladd(XmlDocument *, char *, char *);
EXTERN int xmldel(XmlDocument *, char *, int);
EXTERN int xmldelall(XmlDocument *, char *);
EXTERN int xmlget(XmlDocument *, char *, int, char *);
EXTERN int xmlnum(XmlDocument *, char *);
EXTERN XmlDocument * xmlalloc();
#undef EXTERN

                                                            
#ifdef _LIB_ERRLOG
#define EXTERN
#else
#define EXTERN extern
#endif
EXTERN int usfTrace(char *, ...);
EXTERN int usfTraceX(char *, ...);
EXTERN int usfErrlog(char *, ...);
#undef EXTERN

#ifdef _LIB_USF_DB_API_
#define EXTERN
#else
#define EXTERN extern
#endif
EXTERN void * openDll(char * lib_name, DllNode ** d_node);
#undef EXTERN

                
#ifndef HIGH_WATER
#define HIGH_WATER        1                    
#endif
#ifndef NORMAL_WATER
#define NORMAL_WATER        0                      
#endif
#ifndef EMPTY_QUEUE
#define EMPTY_QUEUE        -1                    
#endif

#ifndef SPLITED
#define SPLITED                1                      
#endif
#ifndef UN_SPLITED
#define UN_SPLITED        0                        
#endif

#ifndef END_FLAG
#define END_FLAG        0x7ffffffe                      
#endif

#ifndef ERR_FLAG
#define ERR_FLAG        0x7fffffff                      
#endif

#define ERRLOG(errno, errmsg) {\
 xmlSetErrno(errno); \
 errlog("#%d-%s", errno, errmsg); }

#define usfSetMsgType(msg, type) {\
 strncpy(msg->msg_type, type, MSG_TYPE_LEN); }
#define usfSetMsgID(msg, id) {\
 msg->msg_id = id; }
#define usfSetMsgSplited(msg, sp_flg) {\
 msg->msg_splited = sp_flg; }
#define usfSetMsgPriority(msg, priority) {\
 msg->msg_priority = priority; }
#define usfSetMsgEndFlag(msg, end_flag) {\
 msg->msg_id = end_flag; }
#define usfSetMsgErrFlag(msg, err_flag) {\
 msg->msg_id = err_flag; }

#endif                    

  
                                                             
                                                                               
                                                             
                                                                                

#ifndef _HIDLL_H_
#define _HIDLL_H_

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <dlfcn.h>
#include <errno.h>
#include <pthread.h>



#define DLL_NAME_LEN  60
#define DLL_PATH_LEN 180
#define FUN_NAME_LEN  60

                         
struct _x_func {
    char   func_name[FUN_NAME_LEN+1];               
    void * func_hndl;                               
    struct _x_func * next;                         
};
typedef struct _x_func XFunc;

                         
struct _x_dllib {
    char   dll_name[DLL_NAME_LEN+1];                 
    void * dll_hndl;                                 
    struct _x_func * dll_func;                       
    struct _x_dllib * next;                          
};
typedef struct _x_dllib XDLLib;

                  
struct _x_dll_reg {
 pthread_mutex_t upd_lock;
 struct _x_dllib * head_node;
};
typedef struct _x_dll_reg XDllReg;

                        
#define DLL_REGIST_INITIALIZER \
{\
 PTHREAD_MUTEX_INITIALIZER, \
 NULL      \
}

#ifdef _HIDLL_LIB_
   #define EXTERN
#else
   #define EXTERN extern
#endif
EXTERN int      dllInit(XDllReg *);
EXTERN XDLLib * dllOpenLib(XDllReg *, char *, int (*)(void *));
EXTERN void *  dllLoadFunc(XDllReg *, char *, char *, int (*)(void *));
EXTERN void *   dllFindFunc(XDLLib *, char *);
EXTERN XDLLib * dllFindLib(XDllReg *, char *);
EXTERN void *   dllGetFuncHandle(XDllReg *, char *, char *);
EXTERN int      dllCloseLib(XDllReg *);
EXTERN void     dllDestroy(XDllReg *);
EXTERN void     dllMove(XDllReg *, XDllReg *);
#undef EXTERN

#endif                

   
                                                                    
                                                                               
                                                                    
                                                                    
                                                                          
                                                                                

#ifndef  _PUB_DEF_H
#define  _PUB_DEF_H

  
                                         
                                                             
                       
  
                                   
                                   
  
#define  PUB_DLL    "PUB"
#define  EXT_DLL    "EXT"
                

#define  EXP_DLL    "dll/hipex.so"
#define  MON_DLL    "dll/model.so"
#define  PUB_ERROR_PROC   "DefaultErrorProc"
#define  BATCH_CONFIG           "BatConfig"
#define  GRANT_FLAG             0
#define  FORBID_FLAG            1
#define  CLSTRC_FLAG            0
#define  OPNTRC_FLAG            1
#define  STATISTIC_ON    1
#define  STATISTIC_OFF    0

#define  SYSDIVIDEBASE          256
#define  SYS_NOTEXIST         127

#define  LOADTRANMAXTIME  10
#define  RECOVERY_MSGTYPE  "ONLRCV"
#define  PLT_OUT_MSGTYP         "PLTOUT"                                  

#define  AUTH_TXNCOD            "033311"                          

#define  PUBDLLDEF_NAME         "PUB"
#define  EXTDLLDEF_NAME         "EXT"
#define  SYSTEMDEF_NAME         "SYS"
#define  EXPDLLDEF_NAME         "EXP"
#define  TXNFLGDEF_NAME         "TXN"
#define  MONSERV_NAME          "MON"

#define  ERR_MSG_TYPE          "E"
#define  SUCC_MSG_TYPE          "N"
#define  AUTH_MSG_TYPE          "A"
#define  WARN_MSG_TYPE          "W"

                    
#define DS_MSG_TYP    1
#define DS_ETF_TYP    2
#define DS_XML_TYP    3
#define DS_STRUCT_TYP   4
#define DS_BUFFER_TYP   5

                    
#define  DLLFILE_NOTEXIST       -1000
#define INVALID_CONFIG   -1001
#define BREAK_VAL    100
#define CONTINUE_VAL   101
#define GOTO_VAL    102
#define RETURN_VAL    103
                                                
#define EXIT_VAL    104

                      
#define ARGS_NODE  "Args"
#define ARG_NODE  "Arg"
#define EXEC_NODE  "Exec"
#define SET_NODE  "Set"
#define DELETE_NODE  "Delete"
#define GOTO_NODE  "Goto"
#define RETURN_NODE  "Return"
                                                
#define EXIT_NODE  "Exit"
#define BREAK_NODE  "Break"
#define CONTINUE_NODE "Continue"
#define SWITCH_NODE  "Switch"
#define WHILE_NODE  "While"
#define IF_NODE   "If"
#define ELSEIF_NODE  "ElseIf"
#define ELSE_NODE  "Else"
#define SYSTEM_NODE  "System"
#define CALL_NODE  "Call"
#define LABEL_NODE  "Label"
#define CASE_NODE  "Case"
#define DEFAULT_NODE "Default"
#define INCLUDE_NODE "Include"
#define MACRO_NODE  "Macro"
#define QUOTE_NODE  "Quote"

#define EXPRESSION_ATTR "expression"
#define CONDITION_ATTR "condition"
#define FUNC_ATTR  "func"
#define VALUE_ATTR  "value"
#define COMMAND_ATTR "command"
#define PATH_ATTR  "path"
#define NAME_ATTR  "name"
#define FILE_ATTR  "file"

#define BAS_TYPE  '~'
#define ETF_TYPE  '$'
#define BCFG_TYPE  '#'
#define DS_TYPE   '@'
#define MHED_TYPE  '%'
#define PARA_TYPE  '#'
#define ESC_CHAR  '\\'
#define SEP_CHAR  '.'

#define  PUBTXNJNL_BASE_NUM  37                                   

#define  APPLICATION_MAX_NUM    10                                  
#define  TRAN_MAX_NUM           300                                 
#define  TRAN_STEP_MAX_NUM      50                                  
#define  STEP_ATR_MAX_NUM       20                                  
#define  LOG_NAME_LEN           50                            
#define  PRI_ITEM_NUM   32                         
#define  PRI_ITEM_NAME_LEN  32                                 

#define  MAX_COND_NUM   15                         

#define  SQLCOD_LEN           10 
#define  SQLCOD_PRE           999999                           

#define  LABEL_LEN           10

#define  SERV_CODE_LEN          3 
#define  CONDITION_TYPE_LEN     4 
#define  CONDITION_VAR_LEN      128 
#define  CONDITION_CMP_SYM_LEN  3 
#define  CONDITION_VAL_LEN      15 
#define  DONE_FUNC_TYPE_LEN     30
#define  DONE_FUNC_ARG_LEN      60 
#define  STEP_SEQ_LEN           20 
#define  ATTRIBUTE_LEN          32 
#define  PRIV_SPACE_LEN         1024 
#define  FILE_NAME_LEN       255 
#define  DLL_FILE_NAME_LEN      30 
#define  CON_FILE_NAME_LEN      50 
#define  CON_FILE_NUM_LEN       3 
#define  FUNC_NAME_LEN          30 
#define  TMP_BUF_LEN            1024 
#define  TTXNCD_LEN             10 
#define  TXNCOD_LEN             6 
#define  MAX_SERVICE_NAME_LEN   64 

#define  APLCLS_LEN             3 
#define  BUSSUB_LEN             15 

#define  LOGNO_LEN              14 
#define  FRSPCD_LEN             6 
#define  RESULT_MSG_LEN         60
#define  SVRTYP_LEN             6
#define  CRPCOD_LEN             10
#define  CRPSUB_LEN             20
#define  CRDNO_LEN              30
#define  ORGNO_LEN              6
#define  NODNO_LEN              6
#define  TLRID_LEN              10
#define  CNTRID_LEN             10
#define  NODTRC_LEN             20
#define  TXNCNL_LEN             3
#define  CNLSUB_LEN             10
#define  HLOGNO_LEN             9
#define  HRSPCD_LEN    6
#define  TCUSID_LEN             30
#define  TLOGNO_LEN             20
#define  TRSPCD_LEN    6
#define  BUSTYP_LEN             6
#define  AGTNOD_LEN             6
#define  SVRCNL_LEN             128
#define  CUSID_LEN              13
#define  ACTTYP_LEN             2
#define  ACTSQN_LEN             2
#define  CNLSTS_LEN             128
#define  SYSID_LEN              6
#define  BLOGNO_LEN             12
#define  DATEND_LEN             2
#define  TRMNO_LEN              10
#define  MCKEY1_LEN             40
#define  MCKEY2_LEN             40
#define  PROCOD_LEN             10
#define  IPADR_LEN              16
#define  IPPORT_LEN    6
#define  ADDR_LEN    60
#define  TELNO_LEN              20
#define  CRPINF_LEN             128
#define  IDTYP_LEN              2
#define  IDCRD_LEN              30
#define  POSTNO_LEN             6
#define  FIXTEL_LEN             20
#define  MOBTEL_LEN             15
#define  LCHKTM_LEN             10
#define  BKNO_LEN    6
#define  CCYCOD_LEN    3
#define  DSKNO_LEN    12                  

                  
#define  DATE_LEN    8
#define  TIME_LEN    6
#define  DATETIME_LEN   14

                
#define  HOSTRECVDIR   "dat/host/recv"
#define  HOSTSENDDIR   "dat/host/send"
#define  TERMRECVDIR   "dat/term/recv"
#define  TERMSENDDIR   "dat/term/send"
#define  LOCALDATDIR   "dat/local"
#define  THRDFILEDIR   "dat"
#define  RPTDATDIR    "rpt"
#define  MULTIDATDIR   "tmp"
#define  DIR_LEN     80

           
#define  USERNAME_LEN   30
#define  USERPASSWD_LEN   30 

              
#define  MSGBUSTYP_LEN   2
#define  MSGAPLCOD_LEN   6
#define  MSGFILNAM_LEN   50
#define  MSGHLOGNO_LEN   9
#define  MSGORGNO_LEN   6
#define  MSGTLRID_LEN   7
#define  MSGBLKNO_LEN   2
#define  MSGDATA_LEN   500

#define  BLKSTARTNO    1
#define  FILESTARTFLG   'S'
#define  FILEMIDFLG    'C'
#define  FILEENDFLG    'E'

#define  TXNSTSPRED    "U"                         
#define  TXNSTSSERR    "X"                         
#define  TXNSTSTOUT    "T"                         
#define  TXNSTSSUCC    "S"                         
#define  TXNSTSFAIL    "F"                         
#define  TXNSTSCRCD    "C"                         
#define  TXNSTSCCLD    "D"                         
#define  TXNSTSERRD    "E"                         

              
#define  FLAG_LEN    1
#define  ACTNO_LEN              21
#define  AMOUNT_LEN    15
#define  INTERVAL_LEN   3
#define  TIMEOUT_LEN   3
#define  MAXTIMES_LEN   4
#define  SQLST_LEN    4096                       
#define  COLVAL_LEN    384                        

            
#define  CUSNAM_LEN             60                  
#define  COMMAN_LEN             60  
#define  BUSNAM_LEN             60      
#define  TCUSNM_LEN             60                        
#define  NODNAM_LEN             60                  
#define  CRPNAM_LEN             60                          
#define  TBLNAM_LEN             30                          
#define  SVRNAM_LEN    8                          
#define  COLUMN_NAME_LEN  32                          
#define  ATTRNAME_LEN   20                          
#define  SERV_NAME_LEN          3                          
#define  FILNAM_LEN           128                             

                              
#define  RECKEY_LEN    100 
#define  USRDAT_LEN             3072
#define  PAGNUM_LEN             4

                          
#define OPCCOD_LEN    4    
#define SETBK_LEN    12
#define SBKNO_LEN    12

                               
#define RECIDX_LEN    2
#define ETFREC_LEN    3072

                
#define  CCSCOD_LEN    4
#define  TIATYP_LEN    1
#define  ATHLVL_LEN    2
#define  SUPID_LEN    7
#define  PIN_LEN    6
#define  SUPDEV_LEN    1
#define  ATHTBL_LEN    60
#define  OPRLVL_LEN    1
#define  TRMVER_LEN    8
#define  MSGTYP_LEN    1
#define  RSPCOD_LEN    6
#define  RSPMSG_LEN    60
#define  ERRFLD_LEN    4
#define  TRMSQN_LEN    6
#define  STXNCD_LEN    4
#define  SAPLCD_LEN    2
#define  TXNSYM_LEN    3
#define  TCKNO_LEN    11
#define  PAGID_LEN    1
#define  DATlEN_LEN    4
#define  TXNSRC_LEN    5
#define  FIL_LEN    2
#define  FIL1_LEN    3
#define  FIL2_LEN    5

                        
#define  ATHREC_NUM    10
#define  ATHCOD_LEN    2
#define  ATHMSG_LEN    2
#define  ATHDAT_LEN    60

#define  INTERVAL    "10"                                
#define  TIMEOUT    "60"                            
#define  MAXTIMES    "10"                            
#define  MAXTIMEOUT    300                       

                
#define CONCOD_LEN    20
#define SELECT_LEN    800
#define FROM_LEN    64
#define WHERE_LEN    512
#define FIELD_LEN    256

#ifdef MULTIQUERY
#define MAXRECORD    1000                                                   
#define MAX_LINE_PER_PAGE     19                              
#define FILE_LINE_LEN   3072                       
#define FIRST_PAGE_CODE   "6401"                           
#define END_PAGE_CODE   "6402"                           
#endif

                
#define TXNTYP_NORMAL  "N" 
#define TXNTYP_CRCT     "C" 
#define TXNTYP_RSND     "R" 
#define TXNTYP_CCLD     "D" 

#define RSND_CCLD  "9"

                
#define ATTR_INTEGRITY "integrity" 
#define ATTR_INTEGRITY_POS 1
#define ATTR_NO_INTEGRITY '0'                    
#define ATTR_SYS_CRCT  '1'                      
#define ATTR_CND_CRCT  '2'                                      
#define ATTR_SYS_RSND  '6'                      
#define ATTR_CND_RSND  '7'                                      


#define ATTR_NOCHK "nochk" 
#define ATTR_NOCHK_POS 2 
#define ATTR_NEED_CHK '0'                  
#define ATTR_NO_CHK  '1'                    


#define ATTR_SIGNON "signon" 
#define ATTR_SIGNON_POS 3 

#define ATTR_PROTOCAL "protocal" 
#define ATTR_PROTOCAL_POS 4 

#define ATTR_NORESPONSE "noresponse" 
#define ATTR_NORESPONSE_POS 5 
#define ATTR_NEED_RESP '0'          
#define ATTR_NO_RESP '1'            

#define ATTR_NODB  "nodatabase" 
#define ATTR_NODB_POS  6 
#define ATTR_NEED_DB  '0'                          
#define ATTR_NO_DB   '1'                        
#define ATTR_OPEN_DB  '2'                          

#define ATTR_INTGTYPE "integtype" 
#define ATTR_INTGTYPE_POS 7 
#define ATTR_INTGTYPE_NO  '0'                       
#define ATTR_INTGTYPE_HAND  '1'                    
#define ATTR_INTGTYPE_SYS  '2'                    
#define ATTR_INTGTYPE_RDR  '6'                
#define ATTR_INTGTYPE_CCL  '9'                

#define ATTR_MONITOR "monitor" 
#define ATTR_MONITOR_POS 8 
#define ATTR_MONITOR_NO  '0'                 
#define ATTR_MONITOR_YES  '1'                



                
#define RUN_STATUS_LEN 16
#define RUN_STS_CRCT run_status[0]                                                      
#define RUN_STS_SCRC run_status[1]                                           
#define RUN_STS_HOST run_status[2]                  
#define RUN_STS_THRD run_status[3]                    
#define RUN_STS_RSND run_status[4]                                               
#define RUN_STS_RESP run_status[5]                                         
#define RUN_STS_DB   run_status[6]                      

#define RUN_STS_INIT_VAL '0'
#define RUN_STS_CRCT_REG '1'
#define RUN_STS_RSND_REG '1'
#define RUN_STS_RSND_PRE '2'
#define RUN_STS_RESP_NORSP '1'
#define RUN_STS_RESP_RSPED '2'
#define RUN_STS_DB_ONL  '1'
#define RUN_STS_SCRC_START '1'

                      
#define ERRPRO_SUCCESS  0                  
#define ERRPRO_CONTINUE  1                                
#define ERRPRO_ERROR  -1                  
#define TXNFAILED      3                    
#define TXNAUTHED      -9                    

                      
#define BP_SUCCESS  0              
#define BP_APPERR  -1              
#define BP_SYSERR  -2              
#define BP_NOPROC  -10            

                                      
              
   
#define MAX_OPEN_CURSOR 10
#define MAX_OPEN_CONN   10

                  
#define MSG_INFORM  "1"
#define MSG_BROADCAST "2"
#define MSG_FILE  "3"
#define MSG_PRINTFILE "4"

#define SSCNETTIMEOUT "100502"
#define SSCNETSENDERR "100501"

                      
#define Bus_Def_num    bus_def.item_num 

#define Bus_Nam1   args.item_name[0 ] 
#define Bus_Nam2    args.item_name[1 ] 
#define Bus_Nam3   args.item_name[2 ] 
#define Bus_Nam4    args.item_name[3 ] 
#define Bus_Nam5    args.item_name[4 ] 
#define Bus_Nam6    args.item_name[5 ] 
#define Bus_Nam7   args.item_name[6 ] 
#define Bus_Nam8   args.item_name[7 ] 
#define Bus_Nam9   args.item_name[8 ] 
#define Bus_Nam10  args.item_name[9 ] 
#define Bus_Nam11  args.item_name[10] 
#define Bus_Nam12  args.item_name[11] 
#define Bus_Nam13  args.item_name[12] 
#define Bus_Nam14  args.item_name[13] 
#define Bus_Nam15  args.item_name[14] 

#define Bus_Val1   args.data[0 ] 
#define Bus_Val2    args.data[1 ] 
#define Bus_Val3   args.data[2 ] 
#define Bus_Val4    args.data[3 ] 
#define Bus_Val5    args.data[4 ] 
#define Bus_Val6    args.data[5 ] 
#define Bus_Val7   args.data[6 ] 
#define Bus_Val8   args.data[7 ] 
#define Bus_Val9   args.data[8 ] 
#define Bus_Val10  args.data[9 ] 
#define Bus_Val11  args.data[10] 
#define Bus_Val12  args.data[11] 
#define Bus_Val13  args.data[12] 
#define Bus_Val14  args.data[13] 
#define Bus_Val15  args.data[14] 

                
#define Step_Args_Num   args.item_num 

#define Step_Arg1_Nam   args.item_name[0 ] 
#define Step_Arg2_Nam   args.item_name[1 ] 
#define Step_Arg3_Nam   args.item_name[2 ] 
#define Step_Arg4_Nam   args.item_name[3 ] 
#define Step_Arg5_Nam   args.item_name[4 ] 
#define Step_Arg6_Nam   args.item_name[5 ] 
#define Step_Arg7_Nam   args.item_name[6 ] 
#define Step_Arg8_Nam   args.item_name[7 ] 
#define Step_Arg9_Nam   args.item_name[8 ] 
#define Step_Arg10_Nam  args.item_name[9 ] 
#define Step_Arg11_Nam  args.item_name[10] 
#define Step_Arg12_Nam  args.item_name[11] 
#define Step_Arg13_Nam  args.item_name[12] 
#define Step_Arg14_Nam  args.item_name[13] 
#define Step_Arg15_Nam  args.item_name[14] 

#define Step_Arg1     args.data[0 ] 
#define Step_Arg2    args.data[1 ] 
#define Step_Arg3    args.data[2 ] 
#define Step_Arg4    args.data[3 ] 
#define Step_Arg5    args.data[4 ] 
#define Step_Arg6    args.data[5 ] 
#define Step_Arg7    args.data[6 ] 
#define Step_Arg8    args.data[7 ] 
#define Step_Arg9     args.data[8 ] 
#define Step_Arg10     args.data[9 ] 
#define Step_Arg11     args.data[10] 
#define Step_Arg12     args.data[11] 
#define Step_Arg13     args.data[12] 
#define Step_Arg14    args.data[13] 
#define Step_Arg15    args.data[14] 

                
#define PubTr_ColNum   txn_jnl.item_num 
#define PubTr_LogNo    txn_jnl.data[0 ] 
#define PubTr_TTxnCd   txn_jnl.data[1 ] 
#define PubTr_TxnCod   txn_jnl.data[2 ] 
#define PubTr_TxnTyp   txn_jnl.data[3 ] 
#define PubTr_BusTyp   txn_jnl.data[4 ] 
#define PubTr_CrpCod   txn_jnl.data[5 ] 
#define PubTr_ActDat   txn_jnl.data[6 ] 
#define PubTr_CcyTyp   txn_jnl.data[7 ] 
#define PubTr_TxnAmt   txn_jnl.data[8 ] 
#define PubTr_Fee      txn_jnl.data[9 ] 
#define PubTr_ActNo    txn_jnl.data[10] 
#define PubTr_CrdNo    txn_jnl.data[11] 
#define PubTr_OrgNo    txn_jnl.data[12] 
#define PubTr_NodNo    txn_jnl.data[13] 
#define PubTr_TlrId    txn_jnl.data[14] 
#define PubTr_CntrId   txn_jnl.data[15] 
#define PubTr_NodTrc   txn_jnl.data[16] 
#define PubTr_TxnCnl   txn_jnl.data[17] 
#define PubTr_ItgTyp   txn_jnl.data[18] 
#define PubTr_FTxnTm   txn_jnl.data[19] 
#define PubTr_FRspCd   txn_jnl.data[20] 
#define PubTr_HLogNo   txn_jnl.data[21] 
#define PubTr_HRspCd   txn_jnl.data[22] 
#define PubTr_HTxnSt   txn_jnl.data[23] 
#define PubTr_HPrChk   txn_jnl.data[24] 
#define PubTr_HLsChk   txn_jnl.data[25] 
#define PubTr_TCusId   txn_jnl.data[26] 
#define PubTr_TCusNm   txn_jnl.data[27] 
#define PubTr_TActDt   txn_jnl.data[28] 
#define PubTr_TLogNo   txn_jnl.data[29] 
#define PubTr_TRspCd   txn_jnl.data[30] 
#define PubTr_TTxnSt   txn_jnl.data[31] 
#define PubTr_ThdChk   txn_jnl.data[32] 
#define PubTr_TxnSts   txn_jnl.data[33]
#define PubTr_TxnAtr   txn_jnl.data[34]
#define PubTr_MstChk   txn_jnl.data[35]
#define PubTr_LChkTm   txn_jnl.data[36]

#endif                 




                                                                               

                                          
 
                     
                   
               
                    
                               
              
            
                      
                  
                   
       
                                                                               
#ifndef _PUB_EXP_H_
#define _PUB_EXP_H_






#define FLOAT_EQUAL         1E-5                                  
#define NUM_LEN    30                
#define LIBNAM_LEN   128                      
#define FUNNAM_LEN   128                  
                                           
                            
                                                               
#define DEF_DLLNAM   "PEX"
#define DEF_DLLFIL   "dll/hipex.so"                         
#define MAX_PARA_LEN  3072                             
#define MAX_PARA   20                                        
#define TYPE_STRING   0                          
#define TYPE_VARIABLE  1                    
#define TYPE_FUNCTION  2                    
#define ERR_EXPINVALID  -1                            
#define ERR_LENLESS   -2                                  
#define ERR_DLLNULL   -3                            
#define ERR_LOADFUNC  -4                               
#define ERR_CHILDFUNC  -5                            
#define ERR_NOETFFIELD  -6                           
#define ERR_DLLALIAS  -7                        
#define ERR_MALLOC   -9                    
#define BUFFER_SIZE   1024                 
#define PUB_DEF_NAME_LEN 128                      
#define PUB_DEF_VALUE_LEN 128                    

#define ISNULLNODEFUNC     "ISNULLNODE"                   

                              
struct _pub_define_rec {
    char     define_name[PUB_DEF_NAME_LEN+1];
    char     define_value[PUB_DEF_VALUE_LEN+1];
    struct   _pub_define_rec * next;
};
typedef struct _pub_define_rec PubDefineRec;


  
                                           
                                
   
struct _lib_define_rec {
 char alias[16+1];
 int  file_num;
 char  **filename;
 struct _lib_define_rec *next;
};
typedef struct _lib_define_rec LibDefineRec;

                  
struct   _exp_dll_handle{
 XDllReg   * pDllReg;                      
                                            
                                                          
 LibDefineRec * pDefRec;                                
 int    (* pFunc )(void *);              
};
typedef struct _exp_dll_handle ExpDllHandle;


#ifdef PUB_EXP_EXTERN
  
                           
                                                                                   
          
                              
              
  
int    pexParserExtend(ETF *, char *, ExpDllHandle*, char *, int);

  
                     
                                                             
                                                                    
  
char * pexParser(ETF *, char *, ExpDllHandle*, int *);
#else
extern  int    pexParserExtend(ETF *, char *, ExpDllHandle*, char *, int);
extern  char * pexParser(ETF *, char *, ExpDllHandle*, int *);
#endif
#endif                 



#ifndef _LIBHIPRA_H_
#define _LIBHIPRA_H_
#include <stdio.h>
#include <stdlib.h>
#include <string.h>





#define PARA_TRAN_PARAS_SIZE 100
#define PARA_TRAN_SIZE       100
#define PARA_APP_PARAS_SIZE  50
#define PARA_APP_SIZE        10
#define PARA_SERVER_PARAS_SIZE  25
#define PARA_SYSTEM_PARAS_SIZE  20

struct _SystemLevel;
struct _ServerLevel;
struct _ApplicationLevel;
struct _TransactionLevel;

typedef struct _SystemLevel SystemParaSpace;
typedef struct _ServerLevel ServerParaSpace;
typedef struct _ApplicationLevel AppParaSpace;
typedef struct _TransactionLevel TranParaSpace;

struct _SystemLevel
{
  char            * name;
  NamedDataSource * paras;
  struct _ServerLevel  * curr_server;
};
SystemParaSpace * createSystemParaSpace(char * name);
void   destroySystemParaSpace(SystemParaSpace * space); 
int    setServerParaSpace(SystemParaSpace * sys_space, ServerParaSpace *server_space);
int    addSystemPara(SystemParaSpace * sys_space, char *name, char *value);
char * getSystemPara(SystemParaSpace * sys_space, char * name);
TranParaSpace * getTranParaSpaceFromSystemParaSpace(SystemParaSpace * sys_space, char * app_name, char * tran_name);


struct _ServerLevel
{
  char            * name;
  NamedDataSource * paras;
  DataSource * apps;
  SystemParaSpace * system;
};
ServerParaSpace * createServerParaSpace(char * name);
void   destroyServerParaSpace(ServerParaSpace * space); 
int    addAppParaSpace(ServerParaSpace * server_space, AppParaSpace *app_space);
AppParaSpace * getAppParaSpace(ServerParaSpace * app_space, char * app_name);
int    addServerPara(ServerParaSpace  *server_space, char * paraname, char *value);
char * getServerPara(ServerParaSpace  *server_space, char * paraname);


struct _ApplicationLevel
{
  char            * name;
  NamedDataSource * paras;
  DataSource * trans;
  ServerParaSpace * server;
};
AppParaSpace * createAppParaSpace(char * name);
void   destroyAppParaSpace(AppParaSpace * space);      
int    addTranParaSpace(AppParaSpace * app_space, TranParaSpace *tran_space);
TranParaSpace * getTranParaSpace(AppParaSpace * app_space, char * tran_name);
int    addAppPara(AppParaSpace  *app_space, char * paraname, char *value);
char * getAppPara(AppParaSpace  *app_space, char * paraname);

struct _TransactionLevel
{
  char            * name;
  NamedDataSource * paras;
  AppParaSpace    * app;
};
TranParaSpace * createTranParaSpace(char * name);
void   destroyTranParaSpace( TranParaSpace * space);
char * getTranPara(TranParaSpace * paras, char * paraname);
int    addTranPara(TranParaSpace * paras, char * paraname, char *value);


                                                                               
                    
                                                                               
   
                               
   
SystemParaSpace * constructSystemParaModule(char * syscfg_file, char * server_name);

   
                                     
   
AppParaSpace * constructAppParaModuleFromFile(char * appcfg_file, char *appname);
AppParaSpace * constructAppParaModuleFromXmlNode(XmlNode * app_node, char *appname);
TranParaSpace * constructTranParaSpaceFromXmlNode(XmlNode * tran_node);

   
                                     
   
char * getParaValueFromParaSpace(TranParaSpace * space, char * name);

#endif                 








                    
struct _txn_condition {
 char  txn_cod[MAX_SERVICE_NAME_LEN + 1];
 char  con_cod[CONCOD_LEN + 1];
 char * query;
 char * fields;
 struct  _txn_condition * next;
};
typedef struct _txn_condition TxnCondition;

                    
struct _pb_item_data {
 char  **  data;
 char  **  item_name;
 int   * size;
 int   item_num;
};

typedef struct _pb_item_data  PbItemData;

                          
struct _cfg_define_rec {
                       
                                  
 char    *  name;
 XmlNode * node;
   
                    
                                  
    
 int   type;
 void * pointer;
 void (* done_func)(void *);
};
typedef struct _cfg_define_rec CfgDefineRec;

  
           
                                 
                                                
   
struct _function_node {
 char    * name;                
 InterfaceDefine * input;                 
 InterfaceDefine * output;                 
 TxnCondition * sentence_head;                 
 XmlNode   * process;                 
                                           
                  
                                                   
};
typedef struct _function_node FunctionNode;
 
  
             
                                 
   
struct _package_node {
   
                                            
                    
                                 
                              
                                         
                                
                                               
                                                
   
 
 int     free_flag;                         
 char          * filename;                           
 XmlNode    * pkg_root;                     

                                         
 short     cfgdef_num;
 short   busdef_num;
 short   pkgdef_num;
 PubDefineRec  * cfgdefmsg;                                 
 LibDefineRec  * librarymsg;                                 
 PubDefineRec  * busdefmsg;         
 PubDefineRec  * pkgdefmsg;                         
 hash_t   * func_container;                      
};
typedef struct _package_node PackageNode;

                      
struct _serv_config_msg {
 char       serv_name[SERV_NAME_LEN+1];
 char       serv_code[SERV_CODE_LEN+1];
 char       list_tbl[TBLNAM_LEN+1];
 char    errlog_nam [LOG_NAME_LEN+1];                  
 char    trclog_nam [LOG_NAME_LEN+1];                  
 short      serv_permit_flag;
 short    trace_flag;
 short    cfgdef_num;
 short    busdef_num;
                                                          
 char   trace_ip[IPADR_LEN+1];                        
 int    trace_port;                         
                                            
              
                             
 PubDefineRec  * cfgdefmsg;                                 
 LibDefineRec  * librarymsg;
 PubDefineRec  * busdefmsg;
    
                    
                                   
    
 short   pkgdef_num;
 PubDefineRec  * pkgdefmsg;
};
typedef struct _serv_config_msg ServConfigMsg;

                  
struct _reltran_atr {
 char    txn_cod[MAX_SERVICE_NAME_LEN+1];             
 char interval[INTERVAL_LEN + 1];                  
 char time_out[TIMEOUT_LEN + 1];              
 char max_times[MAXTIMES_LEN + 1];             
 char obj_svr[SVRNAM_LEN + 1];                 
};
typedef struct _reltran_atr RelTranAtr;

                  
struct _tran_config_rec {
 ServConfigMsg *  serv_msg;
 char        txn_cod[MAX_SERVICE_NAME_LEN+1];
 RelTranAtr    integrity_atr;
 short       tran_permit_flag;
 char        attribute[ATTRIBUTE_LEN+1];
 short     trace_flag;
 int         tran_step_num;
                                                              
 int     trace_sockfd;
 TxnCondition  * txn_cond;
 XmlNode   * tran_step;
   
                  
                                   
    
                                            
                             
 PackageNode  * tran_pkg;
};
typedef struct _tran_config_rec TranConfigRec;

                
struct _tranattrpos {
   char  attr_name[ATTRNAME_LEN + 1];
   char  pos[FLAG_LEN + 1];
   struct  _tranattrpos * next;
};
typedef struct _tranattrpos TranAttrPos;

                        
struct _tran_pub_env {
 int               serv_num;
 int               tran_num;
 char     act_dat [DATE_LEN  + 1];
 char     sys_id [SYSID_LEN  + 1];
 char    sys_err_log[LOG_NAME_LEN+1];
 char    sys_trc_log[LOG_NAME_LEN+1];
 short    sys_trc_flag;
 XmlDocument    ** con_root_node;
 XmlNode      * sys_cfg;
 XmlNode      * bus_cfg;
 ServConfigMsg  * aps_con_msg;
 TranConfigRec  * tran_con_rec;
 TranAttrPos  *  tran_attr_pos;
 XmlNode    * trlst_cols_nods;
 XmlNode    * table_cols_nods;
 XDllReg    PartDLLs;
                                   
                                             
                             
                          
   
 hash_t   * external_pkg;
 hash_t   * inner_pkg;
 hash_t   * cfg_container;               
 
 SystemParaSpace * para_space;
 
                                         
 short    statistics_switch;                 
 pthread_rwlock_t switch_lock;            
 
                                         
 LoggerMessage *  logger_msg;                     
};

typedef struct _tran_pub_env TranPubEnv;

struct _serv_env {
 TranPubEnv   * _PubEnvCurr;
 TranPubEnv   * _PubEnvBak;
};

typedef struct _serv_env ServEnv;

struct _pri_item {
 void    * data;
 char     name[PRI_ITEM_NAME_LEN +1];
 int      size;
 struct _pri_item * next_item;
};

typedef struct _pri_item PriItemNode;

struct _pri_item_data {
 PriItemNode  * item;
 PriItemNode  * last_item;
 int     item_num;
};

typedef struct _pri_item_data  PriItemData;

  
                                       
                           
   
struct _connection_cursor_index {
 short ds_id;                   
 char cursor_seq[MAX_OPEN_CURSOR];                     
};
typedef struct _connection_cursor_index ConnectionCursorIndex;

                
struct _tran_data {
 int      ret_cod;                          
 char     sys_id [SYSID_LEN + 1];                       
 char     req_id [RQST_ID_LEN + 1];                      
 char     svr_name [SVRNAM_LEN +1];                      
 char      * bus_name;                          
 char     log_no[LOGNO_LEN+1];                       
 char     act_dat[DATE_LEN+1];                       
 char      errlog_nam[LOG_NAME_LEN+1];                      
 char      trclog_nam[LOG_NAME_LEN+1];                      
 char      * txn_cod;                          
 char      * list_tbl;                          
 char      * attribute;                          
 char       run_status[RUN_STATUS_LEN+1];                     
 short     trace_flag;                          
 Message      * in_msg;                           
 XmlNode       * trlst_cols_nods;                        
 XmlNode       * table_cols_nods;                        
 RelTranAtr     * integrity_atr;                         
 ServConfigMsg     * serv_msg;                          
 TranPubEnv       * pub_env;                          
 struct _pb_item_data bus_def;                          
 struct _pb_item_data txn_jnl;                          
 DataSource    *data_source;                         
 TranParaSpace    * para_space;                          
 ETF       * input_etf;                              
 ETF       * output_etf;                             
 char      output_area[20+1];                        
 int       sys_err_flag;                        
 int       add_msg_flag;                        
                                          
 hash_t      * comp_ctx_info;                      
                                         
 short      statistics_switch;                     
 
 struct timeval    start_time;                       
 struct timeval    dead_time;                       
 ConnectionCursorIndex conn_cursor[MAX_OPEN_CONN];                      
 
                                         
 Logger    * logger;                       
 int       log_level;                    
};

typedef struct _tran_data TranData;

                  
struct _tran_inf_rec {
 TranConfigRec * txn_config;
 ETF    * in_node;
 TranData  * trdata;
 DBConHandle  * db_hndl;
 XmlNode   * head_node;
 XmlNode   * curr_node;
 char   * goto_label;
 char       default_errdll_file[DLL_FILE_NAME_LEN+1];
 char       default_errfunc_name[FUNC_NAME_LEN+1];
 char       errdll_file[DLL_FILE_NAME_LEN+1];
 char       errfunc_name[FUNC_NAME_LEN+1];
 int    break_flag;
 int    ret_cod;
   
                   
                                   
    
                                            
                      
 PackageNode  * curr_pkg;                
 
                                         
              
 PubDefineRec  * curr_cfgdefmsg;                                     
 LibDefineRec  * curr_librarymsg;                                    
 PubDefineRec  * curr_busdefmsg;             
 PubDefineRec  * curr_pkgdefmsg;                             
};
typedef struct _tran_inf_rec TranInfRec;

struct _obj_msg
{
 char NodNo[NODNO_LEN+1];
 char TlrNo[MSGTLRID_LEN+1];
 struct  _obj_msg * next;
};
typedef struct _obj_msg ObjMsg;

                 
  
                       
                                 
   
typedef struct
{
 char  MsgTyp[FLAG_LEN  + 1];                                       
 char  BusTyp[MSGBUSTYP_LEN  + 1];                                      
 char  AplCod[MSGAPLCOD_LEN  + 1];                                    
 char  FilNam[MSGFILNAM_LEN  + 1];                                      
 char  LclFil[MSGFILNAM_LEN  + 1];                                      
 char  MsgSmr[MSGFILNAM_LEN  + 1];                                      
 char  HLogNo[MSGHLOGNO_LEN  + 1];                                      
 char  OrgNo[MSGORGNO_LEN  + 1];                                       
 char  TlrId[MSGTLRID_LEN  + 1];                                       
 char  BgnDat[DATE_LEN  + 1];                                       
 char  BgnTm[TIME_LEN  + 1];                                        
 char  EprDat[DATE_LEN  + 1];                                     
 char  EprTm[TIME_LEN  + 1];                                        
 char  ProFlg[FLAG_LEN  + 1];                                       
 char  Data[MSGDATA_LEN  + 1];                                       
 int   RecNum;                                           
 ObjMsg * obj_msg;                                         
} InformMessage;

#ifdef BPNOEXTERN

ServEnv     * _ServEnv;

   
                                  
                               
   
int     _Argc;
char    ** _Argv;
pthread_rwlock_t _UpdateRWLock;

#else                  

extern ServEnv     * _ServEnv;
extern XmlNode *  _TrTabCfg;                   

                                    
extern int   _Argc;
extern char   ** _Argv;
extern pthread_rwlock_t _UpdateRWLock;

#endif                 


#endif                   

void * get_dll_handle( TranPubEnv *, char * );
void * get_dll_handle_all( TranPubEnv *, char * );

#ifdef _LIB_BPONLBS_
#define EXTERN
#else
#define EXTERN extern
#endif                    

EXTERN void free_pointer_array(char **, int);
EXTERN char **names_parser(char *, char, int *);
EXTERN char **separate_names(char *, char);
EXTERN char *findRealNameByAlias(ETF *, TranData *, char *);
EXTERN int bpGetRealValue(char *, char *, TranData *, ETF *);
EXTERN int bpGetArgument(PbItemData, char *, char *, int);
   
                         
                               
   
EXTERN char * bpReturnArgument(PbItemData, char *, int *);
EXTERN char * bpReturnChildValue(ETF *, char *, int *);
   
                         
                                 
                                   
   
                                                                              
                                                                 
EXTERN PackageNode * findPackageNode(TranPubEnv * env, TranInfRec * ctx, char *pkg_name);
EXTERN FunctionNode * findFunctionNode(PackageNode * pkg, char * name);
#undef EXTERN

#ifdef _LIB_BPTRANDATA_
#define EXTERN
#else
#define EXTERN extern
#endif                         

EXTERN void bpFreeMem(void *);
EXTERN void bpFreeMsg(void *);
EXTERN void bpFreeEtf(void *);
EXTERN void bpFreeXml(void *);

EXTERN int bpAddNamedData(TranData *, char *, char *, char *, int, int);
EXTERN int bpGetNamedData(TranData *, char *, char *, char *, int);
EXTERN void bpDelNamedData(TranData *, char *, char *);

EXTERN int bpAddBasData(TranData *, char *, char *, int, int);
EXTERN int bpGetBasData(TranData *, char *, char *, int);
EXTERN void bpDelBasData(TranData *, char *);

EXTERN int bpAddEtfData(TranData *, char *, char *, int);
EXTERN int bpGetEtfData(TranData *, char *, char *, int);
EXTERN void bpDelEtfData(TranData *, char *);

EXTERN int bpAddMsgHead(TranData *, char *, char *, int);
EXTERN int bpGetMsgHead(TranData *, char *, char *, int);
EXTERN void bpDelMsgHead(TranData *, char *);

EXTERN int bpAddAliasData(TranData *, char *, char *, int, int);
EXTERN int bpGetAliasData(TranData *, char *, char *, int);
EXTERN int bpDelAliasData(TranData *, char *);

EXTERN int bpAddDataSource(TranData *, char *, int, void **, int, void (*)(void *));
EXTERN int bpSetDataSource(TranData *, char *, int, void **, int, void (*)(void *));
EXTERN int bpGetDataSource(TranData *, char *, void **);
EXTERN void bpDelDataSource(TranData *, char *);

EXTERN int bpAddData(TranData *, char *, char *, char *, int, int);
EXTERN int bpGetData(TranData *, char *, char *, char *, int);
EXTERN int bpDelData(TranData *, char *, char *);

EXTERN XmlNode * bpGetConfigRootNode(TranData *, char *, char *);
EXTERN XmlNode * bpGetConfigNodeByAttr(TranData *, char *, char *, char *, char *);
EXTERN int bpDump(TranData *);

                                       
EXTERN int bpQueryRec(DBConHandle *handle, \
      char * aSqlCmd,  \
      int  pairs,   \
      char * name,   \
      char * value,   \
      long maxlen,  \
      ...);
#undef EXTERN

                    
int bpSetDBContext(DBConHandle *);
                                                
int bpGetChildValue( ETF *, char *, char *, int );
                          
int bpAddResult(ETF *, char *, char * );
                
int bpTraceLog( TranData *, char *, ...);
                
int bpErrorLog( TranData *, char *, ...);
                              
int bpReadCondition( ETF *, TranData *, char *, char *, int);
int CreateStatement( ETF *, TranData *, char *, char *, char *, int );
int SetAccPub( void * );
int SetAccPubAll( void * );

  
                                       
                  
   
char * bpCloneEtfData(TranData *trdata, char *name, int * datalen);
char * bpCloneNamedData(TranData *trdata, char *src_name, char *dat_name, int *datalen);
char * bpCloneBasData(TranData *trdata, char *name, int *datalen);
char * usfCloneMsgHeadValue(Message * msg, char * fld_name, int * datalen);
char * bpCloneMsgHead(TranData *trdata, char *name, int *datalen);
char * bpCloneData(TranData *trdata, char *src_name, char *dat_name, int *datalen);
char * bpClonePara(TranData *trdata, char *name, int *datalen);
char * bpCloneAliasData(TranData *trdata, char *alias, int * datalen);
                                  



                                                                               

                                              
 
                       
                   
                 
                    
                                                                                     
      
            
            
              

                                
                                                                        

                                                                               

#define  _SUCCEED               "000000"                 

#define  _INVA_LOGON            "301400"                       
#define  _INVA_LOGOUT           "301401"                       
#define  _FULL_LOGTAB           "301402"                    
#define  _PROC_ALRE_LOGON       "301403"                         
#define  _APP_ALRE_LOGON        "301404"                            
#define  _PROC_APP_CLASH        "301405"                            
#define  _NOT_FOUND_APP         "301406"                         
#define  _INVA_SOUR_LOGON       "301407"                          
#define  _INVA_TRAG_LOGON       "301408"                            
#define  _RE_START              "301409"                       
#define  _RE_START_ERR          "301410"                          
#define  _LOST_INSIDE_DATA      "301411"                       
#define  _GRAV_PROC_ERR         "301412"                       
#define  _START_APP_ERR         "301415"                             
#define  _SYS_EXIT              "301416"                             
#define  _TOO_MANY_APP          "301417"                       
#define  _INVA_APP              "301418"                       
#define  _APP_CHAN_ERR          "301419"                          
#define  _TOO_MANY_ROU          "301420"                             
#define  _INEXIST_ROU_TAB       "301421"                             
#define  _RE_START_PROC         "301422"                        
#define  _FOUND_DIE_PROC        "301424"                       
#define  _LOST_INS_DATA         "301425"                       
#define  _NOT_ENV_VARI          "301440"                          
#define  _PARA_NO_ASCII         "301450"                         
#define  _PARA_LEN_ERR          "301451"                         
#define  _PARA_NO_NUM           "301452"                         
#define  _GET_PARA_ERR          "301453"                       
                                                                          

#define  _PROCESSING            "320001"                      
#define  _ASK_AUTH              "320002"                    
#define  _ACCT_NULL             "320003"                       
#define  _INVALID_ACCT          "320004"                    
#define  _FREEZE_ACCT           "320005"                          
#define  _NAME_ACCT_UNCONF      "320006"                             
#define  _ERR_TRAN_STAT         "320007"                      
#define  _INVALID_CARD          "320008"                    
#define  _INVALID_AMOUNT        "320009"                    
#define  _VIP_TRAN              "320010"                    
#define  _PASSWD_ERR            "320011"                             
#define  _INVALID_TRAN          "320012"                    
#define  _IRREGU_TRAN           "320013"                    
#define  _PACK_ERR              "320014"                         
#define  _INEXIST_ORA_RECORD    "320015"                      
#define  _NOT_ENOUGH_INTEG      "320020"                    
#define  _CLEAN_INTEG_ERR       "320021"                       
#define  _INVA_CARD_KIND        "320022"                   
#define  _PRINT_CLASH           "320023"                    
#define  _DATA_ERR              "320024"                      
#define  _REQU_STAT_ERR         "320026"                       
#define  _INVA_SEQU             "320027"                          
#define  _INVA_PAGE_REQU        "320028"                          
#define  _INVA_PAGE_APPLY       "320029"                         
#define  _CREAT_PRETRACE_ERR    "320031"                          
#define  _GET_PRETRACE_ERR      "320032"                         
#define  _NOT_ISSUE_CARD        "320033"                   
#define  _INVA_PRINT_REQU       "320034"                         
#define  _INEXIST_AUTH_AMOUNT   "320036"                       
#define  _ASK_PRINT             "320037"                            
#define  _ENTER_LOGNO_ERR       "320038"                       
#define  _VOUDATE_LIMIT         "320039"                             
#define  _OUTBANK_ERR           "320040"                             
#define  _INBANK_ERR            "320041"                             
#define  _INEXIST_RECORD        "320042"                       
#define  _NOT_APPLY_SERV        "320043"                      
#define  _REPEAT_PACK           "320044"                 
#define  _INEXIST_HOST_RECORD   "320045"                         
#define  _INVA_FIELD            "320046"                             
#define  _NULL_FIELD_ERR        "320047"                          
#define  _ERR_AMOUNT            "320048"                         
#define  _AMOUNT_LIMIT          "320049"                             
#define  _TRUST_DATE_ERR        "320050"                         
#define  _OUT_SAME_IN           "320051"                            
#define  _BANKNO_ERR            "320052"                   
#define  _REQU_AREA_ERR         "320053"                         
#define  _INVA_MSG_CONT         "320054"                               
#define  _INEXIST_COLLATE       "320055"                         
#define  _INVALID_MCHANT        "320056"                          
#define  _INVA_FUNCTYPE         "320057"                             
#define  _NOT_OBLIGATE_PIN      "320058"                            
#define  _ACCT_NOT_SET          "320059"                      
#define  _ACCT_ALRE_SET         "320060"                      
#define  _CALL_ISSUE            "320061"                      
#define  _SPEC_CALL             "320062"                    
#define  _INVA_DATE             "320063"                    
#define  _INVA_FEE_KIND         "320064"                          
#define  _INVA_OPER             "320065"                       
#define  _CHECK_PIN_ERR         "320066"                         
#define  _REPA_STOCK_SEQU       "320067"                          
#define  _SHORTAG_STOCK_BALA    "320068"                          
#define  _STOCKACC_ERRSTAT      "320069"                         
#define  _SEQU_ERR              "320070"                            
#define  _CROSS_ACCT_CLOSE      "320071"                         
#define  _INVA_STOCK_ACCT       "320072"                         
#define  _PRINT_BANKBOOK        "320073"                          
#define  _AMOUNT_OVER_LIMIT     "320074"                          
#define  _INVA_FUNC             "320080"                       
#define  _INEXIST_STOCK         "320081"                    
#define  _CHECK_PASSERR         "320082"                         
#define  _SHORTAG_BALAN         "320083"                             
#define  _OVER_SUMLIMIT         "320084"                       
#define  _REPEAT_SEQU           "320085"                          
#define  _INEXIST_REVE_RECORD   "320086"                          
#define  _ALREAD_REVE           "320087"                       
#define  _UNCONFOR_REVETRAN     "320088"                       
#define  _BALA_REFU_REVE        "320089"                             
#define  _INVA_BANKNO           "320090"                      
#define  _FUNDACC_ERRSTAT       "320091"                         
#define  _INEXIST_FUNDACC       "320092"                         
#define  _ACCT_ALRE_CLOSED      "320093"                       
#define  _NOT_BASED_PARA        "320094"                               
#define  _BASED_PARA            "320095"                               
#define  _DISALLOW_TRANSFER     "320096"                             
#define  _CLOSE_TRANSFER        "320097"                             
#define  _ASSET_OVER_LIMIT      "320098"                               
#define  _SERIAL_UNCON          "320099"                          
#define  _DISALLOW_FUNC         "320100"                       
#define  _STOCK_NO_SIGN         "320101"                         
#define  _STOCK_LOGOUT          "320102"                         
#define  _NO_TRANSFER_FUNC      "320103"                         
#define  _STOCK_SERV_ERR        "320104"                               
#define  _POSSIB_OPERERR        "320105"                      
#define  _AGAIN_ENTRY           "320106"                      
#define  _PART_HONOR            "320107"                    
#define  _REFUSE_BUSIN          "320108"                    
#define  _INFRACT_SECU          "320109"                       
#define  _NO_VOID_RECORD        "320110"                          
#define  _ALRE_VOID             "320111"                          
#define  _UNCONFOR_TRAN         "320112"                         
#define  _NO_RECORD             "320113"                          
#define  _REFU_REVERSAL         "320114"                    
#define  _AVALID_TERMNO         "320115"                    
#define  _REFU_HONOR            "320116"                   
#define  _ERROR                 "320117"                 
#define  _LABLE_HONOR           "320118"                    
#define  _INQU_RESP             "320119"                      
#define  _PART_AUTH             "320120"                    
#define  _LEAD_AUTH             "320121"                    
#define  _INVALID_ISSU          "320122"                      
#define  _UPDATE_TRACK3         "320123"                     
#define  _CLIENT_VOID           "320124"                    
#define  _CLIENT_DISPUTED       "320125"                      
#define  _REPEAT_TRAN           "320126"                    
#define  _AVALID_RET            "320127"                    
#define  _NO_ACTION             "320128"                      
#define  _SUSP_FAIL             "320129"                    
#define  _ERR_FEE               "320130"                      
#define  _REFU_UPDATE           "320131"                      
#define  _REPEAT_UPDATE         "320132"                    
#define  _UPDATE_FIELD_ERR      "320133"                      
#define  _TARNSACT              "320134"                    
#define  _UPDATE_ERR            "320135"                    
#define  _NOJOIN_BANK           "320136"                      
#define  _PARTIAL               "320137"                    
#define  _OVER_EXPIRE           "320138"                     
#define  _CHEAT_CARD            "320139"                     
#define  _CALL_BANK             "320140"                     
#define  _LIMIT_CARD            "320141"                     
#define  _PICKUP_CARD           "320142"                     
#define  _LOCK_RECORD           "320143"                    
#define  _ERR_ACCOUNT           "320144"                      
#define  _LOSE_CARD             "320145"                      
#define  _ERR_CURR_ACC          "320146"                      
#define  _ERR_INVEST_ACC        "320147"                      
#define  _LACK_BALANCE          "320148"                    
#define  _ERR_CHEQUE_ACC        "320149"                      
#define  _ERR_SAVING_ACC        "320150"                      
#define  _OVER_EXPI_CARD        "320151"                   
#define  _PIN_ERR               "320152"                      
#define  _NO_CARD_RECORD        "320153"                    
#define  _DISALLOW_TRAN         "320154"                      
#define  _DISALLOW_DEAL         "320155"                      
#define  _POSSIB_CHEAT          "320156"                    
#define  _CALL_SUPPLY           "320157"                      
#define  _OVER_DRAW             "320158"                      
#define  _OVER_FEE              "320159"                       
#define  _IMP_SECU              "320160"                    
#define  _ORI_AMOUNT_ERR        "320161"                      
#define  _OVER_TIMES            "320162"                      
#define  _CALL_SECU             "320163"                    
#define  _SEIZURE_CARD          "320164"                    
#define  _BELATE_ANSW           "320165"                    
#define  _OVER_PIN_TIMES        "320166"                      
#define  _END_PROC              "320167"                      
#define  _NOT_FOUND_NET         "320168"                      
#define  _REPT_ENTRY            "320169"                    
#define  _ID_ERR                "320170"                   
#define  _MCHANT_NO_HONOR       "320171"                      
#define  _NO_HONOR_ORIG         "320172"                       
#define  _ASK_FAILURE           "320173"                       
#define  _ISSU_FAILURE          "320174"                      
#define  _REPEAT_ANSWER         "320175"                    
#define  _NO_CENTER_ANSWER      "320176"                      
#define  _NO_ISSU_ANSWER        "320177"                       
#define  _ACQU_TIMEOUT          "320178"                         
#define  _ACQU_FAILURE          "320179"                      
#define  _COUNT_ERR             "320180"                    
#define  _ORIG_CHANGE           "320181"                      
#define  _BOOKIN_LIMIT_ERR      "320182"                    
#define  _NO_OBTAIN             "320183"                    
#define  _DONOT_OPER            "320184"                    
#define  _CHANGE_DATE           "320185"                    
#define  _END_REQU              "320186"                       
#define  _HOST_TRACE_NULL       "320187"                             
#define  _ABSENT_FIT_CARD       "320188"                             
#define  _CASHBOX_STAT_ERR      "320189"                             
#define  _REVE_ERR              "320190"                             
#define  _INVA_MSG              "320191"                       
#define  _FOUND_TIMEOUT         "320192"                       
#define  _TOO_MANY_REVE         "320193"                       
#define  _INVA_TIME             "320194"                    
#define  _TOO_LARGE_VALUE       "320195"                     
#define  _INVA_REVE_MAKE        "320196"                               
#define  _INVA_SIGN             "320197"                            
#define  _INVA_OFFSET           "320200"                             
#define  _BM_OPEN_ERR           "320201"                            
#define  _BM_FILE_ERR           "320202"                            
#define  _8583_DATA_LEN         "320203"                       
#define  _8583_HEAD_ERR         "320204"                        
#define  _INVA_BUSS_TYPE        "320300"                          
#define  _INVA_UNIT_CODE        "320301"                          
#define  _INVA_TRAN_TYPE        "320302"                          
#define  _INQU_RECV_FAIL        "320303"                          
#define  _INQU_LEN_ERR          "320304"                                
#define  _INQU_FORM_ERR         "320305"                                
#define  _SEND_RETU_FAIL        "320306"                           
#define  _DATA_OVER_RANGE       "320307"                        
#define  _GET_ACDAT_ERR        "320308"                           
#define  _GET_SYSDAT_ERR        "320309"                           
#define  _BAT_STATUS_ERR        "320310"                          
#define  _BAT_PROC_NOW        "320311"                          
#define  _ELE_NOT_ENOUGH        "320312"                        
#define  _AUTH_CHECK_ERR        "320313"                       
#define  _REPLY_NODE_ERR        "320314"                             
#define  _REPLY_ALRE_ERR        "320315"                   
#define  _CANCEL_ALRE_ERR    "320316"                   
#define  _ALRE_PUR_ERR        "320317"                                
#define  _NO_PUR_ERR         "320318"                                
#define  _ALRE_ORG_PUR        "320319"                              
#define  _ALRE_TLR_PUR        "320320"                              
#define  _ALRE_TXN_AUTH        "320321"                                
#define  _NO_TXN_AUTH        "320322"                                
#define  _REPLY_NO_ERR        "320323"                   
#define  _RETU_NO_ERR        "320324"                       
#define  _INACCT_SQN_ERR        "320325"                       
#define  _WAIT_PROC_NOW        "320326"                                  

#define  _RCV_RTCBK_ERR        "320400"                                
#define  _RCV_BANK_ERR        "320401"                                
#define  _RCV_SETTBK_ERR        "320402"                                
#define  _RPC_CODE_ERR        "320403"                                
#define  _NO_CTL_NODE        "320404"                                
#define  _SYS_STAT_ERR1        "320405"                                
#define  _SYS_STAT_ERR2        "320406"                                  
#define  _AMT_LESS_LIMIT        "320407"                                      
#define  _SND_NM_EMPTY        "320408"                                
#define  _RCV_NM_EMPTY        "320409"                                
#define  _SUMMARY_EMPTY        "320410"                                
#define  _BUS_UNEXHAUST        "320411"                                
#define  _NO_RTC_NODE        "320412"                             
#define  _LOG_NO_ERR            "320413"                            
#define  _TRACE_NO_ERR        "320414"                            
#define  _TRAN_NODE_ERR        "320415"                             
#define  _ALLOW_FUND_REMIT    "320416"                               
#define  _SBK_EQUAL_RBK        "320417"                                  
#define  _STCBK_EQUAL_RTCBK    "320418"                               
#define  _NODE_INFO_ERR        "320419"                             
#define  _UNGRAT_PRINT_CONDI    "320420"                               
#define  _DATE_ERR              "320421"                             
#define  _SND_RTCBK_ERR        "320422"                                
#define  _SND_OBANK_ERR        "320423"                                
#define  _FEE_TYPE_ERR        "320424"                                
                                                                          
#define  _PRE_ERR_CODE          "320900"                         
#define  _NO_EXPECT_MSG         "320901"                            
#define  _NEED_ONLY_CONFIG      "320902"                         
#define  _QUERY_END             "320903"                    
                                                                          
#define  _MSG_FMTNAME_ERR       "320905"                          
#define  _MSG_LABEL_ERR         "320906"                          
#define  _MSG_SEQU_ERR          "320907"                         
#define  _INVA_ORAMSG_SEQU      "320908"                            
#define  _INVA_MSG_SEQU         "320909"                          
#define  _FIELD_NUM_ERR         "320910"                            
#define  _FIELD_LEN_ERR         "320911"                          
#define  _MAX_FIELD_SEQU        "320913"                            
#define  _OVER_ERR_NUM          "320914"                         
#define  _INVA_VOID_MSG         "320915"                               
#define  _WAIT_TIME_OUT         "320916"                       
                                                                          
#define  _DB_OPER_ERR           "331000"                         
#define  _DB_FEAR_ERR           "331001"                       
#define  _DB_CONN_ERR           "331002"                         
#define  _DB_INIT_ERR           "331003"                            
#define  _DB_LOGIN_ERR          "331004"                         
#define  _DB_OPEN_ERR           "331005"                            
#define  _DB_EXEC_ERR           "331006"                             
#define  _DB_RESULT_ERR         "331007"                             
#define  _DB_INS_ERR            "331008"                        
#define  _DB_PROC_ERR           "331009"                       
#define  _DB_REPT_REC           "331010"                          
#define  _DB_UPDATE_ERR         "331011"                       
#define  _DB_NO_RECORD          "331012"                          
#define  _DB_QUERY_ERR          "331013"                         
                                                                          
#define  _SYS_BUSY_DELAY        "341200"                          
#define  _INSIDE_PROBLEM        "341201"                               
#define  _PIGEONHOLE_MSG        "341202"                             
#define  _SYS_BUSY_REFU         "341203"                               
#define  _ABSE_LOGON_HOST       "341204"                       
#define  _ABSE_LOGON_APP        "341205"                          
#define  _REFU_ACCE             "341206"                               
#define  _ID_PASS_ERR           "341207"                             
#define  _ALRE_LOGON            "341208"                   
#define  _ALRE_LOGOUT           "341209"                   
#define  _PASS_EXPIRE           "341210"                             
#define  _LOGON_SEQU_ERR        "341211"                       
#define  _DISALLOW_LOGON        "341212"                       
#define  _LOGON_TYPE_ERR        "341213"                       
#define  _INVA_USEID            "341214"                               
#define  _PRE_ABSE_LOGON        "341215"                       
#define  _SYS_CUT_OFF           "341218"                    
#define  _START_TIME_LIMIT      "341219"                             
#define  _NODE_NO_CLOSE         "341220"                      
#define  _SYS_NO_CLOSE          "341221"                      
#define  _PMS_NO_CLOSE          "341222"                            
                                                                          
#define  _FILE_OPEN_ERR         "341500"                      
#define  _FILE_INEX_CONF        "341501"                      
#define  _FILE_ERR_UPDA         "341502"                      
#define  _FILE_ERR_FIELD        "341503"                       
#define  _FILE_AGAIN_UPDA       "341504"                       
#define  _FILE_NO_RECORD        "341505"                      
#define  _FILE_REFU_UPDA        "341506"                       
#define  _FILE_LOCK             "341507"                    
#define  _FILE_NAME_NULL        "341508"                               
#define  _FILE_INEXIST          "341509"                                
#define  _FILE_REPEAT           "341510"                                
#define  _FILE_INVA_FORM        "341511"                               
#define  _FILE_PARSE_ERR        "341512"                             
#define  _FILE_SUCC_RETU        "341513"                                
#define  _FILE_SERIAL_FAIL      "341514"                                
#define  _FILE_PARSE_FAIL       "341515"                       
#define  _FILE_CREAT_FAIL       "341516"                       
#define  _FILE_INEXI_FRETU      "341517"                            
#define  _FILE_INEXI_HRETU      "341518"                            
#define  _FILE_SUM_FINQ         "341519"                               
#define  _FILE_COUNT_FINQ       "341520"                               
#define  _FILE_SUM_HRETU        "341521"                               
#define  _FILE_COUNT_HRETU      "341522"                               
#define  _FILE_ERR_HRETU        "341523"                          
#define  _FILE_PARSE_HRETU      "341524"                             
#define  _FILE_AMT_ERR          "341525"                          
#define  _FILE_SEQU_ERR         "341526"                            
#define  _FILE_SUCC_REPEAT      "341527"                                    
#define  _FILE_PROC_REPEAT      "341528"                               
#define  _FILE_ALRE_AFFIRM      "341529"                                
#define  _FILE_ACTDAT_ERR       "341530"                                    
#define  _FILE_NO_DATA          "341531"                                
                                                                          
#define  _BRAN_INEXIST          "341600"                                
#define  _BRAN_NET_ERR          "341601"                      
#define  _BRAN_AREA_ERR         "341602"                       
#define  _BRAN_AUTH_CON         "341603"                          
#define  _OPER_LEVEL_LIMIT      "341650"                       
#define  _OPER_ERR              "341651"                      
#define  _OPER_INEXIST          "341652"                    
#define  _OPER_NEED_DIFF        "341653"                       
#define  _OPER_PUR_ERR          "341654"                       
#define  _OPER_ORA_ERR          "341655"                       
#define  _OPER_PASS_ERR         "341656"                      
                                                                          
#define  _HOST_TIMEOUT          "341702"                    
#define  _NET_ERR               "341703"                    
#define  _NEED_REQU             "341704"                               
#define  _BANK_OTHER_ERR        "341705"                          
#define  _SEND_HOST_ERR         "341707"                       
#define  _PRE_OTHER_ERR         "341708"                         
#define  _COMM_TIMEOUT          "341795"                    
#define  _SYSTEM_ERR            "341796"                    
#define  _ERR_CORTROL           "341797"                   
#define  _NET_VER_ERR           "341798"                         
                                                                          
#define  _QPAIR_OPER_ERR        "311800"                             
#define  _INVA_COMM_MODE        "311801"                          
#define  _CREAT_MSG_FAIL        "311803"                             
#define  _SAVE_MSGH_FAIL        "311804"                             
#define  _SEND_ERR_FAIL         "311805"                             
#define  _XML_OPER_ERR          "311806"                           
#define  _HICALL_TIMEOUT        "311807"                           
#define  _HICALL_FAIL           "311808"                           
#define  _GET_ENV_FAIL          "311809"                             
#define  _MALLOC_ERR            "311810"                       
#define  _INVALID_LEN           "311811"                            
#define  _READ_TIMEOUT          "311812"                          
#define  _FINGER_NULL           "311813"                       
#define  _OPER_MSG_ERR          "311814"                       
#define  _CLONE_MSG_ERR         "311815"                       
#define  _DLL_OPER_ERR          "311816"                           
#define  _APP_RET_ERR           "311817"                           
#define  _MUTEX_OPER_ERR        "311818"                           
#define  _MODE_ERR              "311819"                            
#define  _SET_PIPE_ERR          "311820"                             
#define  _READ_PIPE_ERR         "311821"                        
#define  _MSG_INIT_ERR          "311830"                            
#define  _MSG_PUR_ERR           "311831"                          
#define  _MSG_EXIST             "311832"                         
#define  _MSG_INEXIST           "311833"                         
#define  _MSG_OPER_ERR          "311834"                          
#define  _MSG_INVA_ID           "311835"                          
#define  _MSG_FULL              "311836"                             
#define  _MSG_GET_ERR           "311837"                             
#define  _MSG_SEND_ERR          "311838"                             
#define  _MSG_RECV_ERR          "311839"                          
#define  _SHM_INIT_ERR          "311850"                            
#define  _SHM_PUR_ERR           "311851"                          
#define  _SHM_EXT_ERR           "311852"                         
#define  _SHM_SIZE_ERR          "311853"                          
#define  _SHM_NOEXT             "311854"                         
#define  _SHM_NOMEM             "311855"                          
#define  _SHM_OPER_ERR          "311856"                           
#define  _SHM_GET_ERR           "311857"                          
#define  _SEM_INIT_ERR          "311870"                          
#define  _SEM_GET_ERR           "311871"                         
#define  _SEM_P_ERR             "311872"                            
#define  _SEM_V_ERR             "311873"                           
#define  _SEM_RM_ERR            "311874"                       
#define  _IP_ADDR_ERR           "311880"                      
#define  _IP_INVA_ADDR          "311881"                       
#define  _IP_REPE_ADDR          "311882"                      
#define  _NET_TIME_OUT          "311883"                       
#define  _NET_ACCE_RET          "311884"                          
#define  _NET_INVA_HAND         "311885"                          
#define  _NET_INVA_TRSP         "311886"                          
#define  _SOCK_OPEN_ERR         "311890"                         
#define  _SOCK_READ_ERR         "311891"                       
#define  _SOCK_WRIT_ERR         "311892"                       
#define  _SOCK_CONN_ERR         "311893"                           
#define  _SOCK_BIND_ERR         "311894"                         
#define  _SOCK_ACCE_ERR         "311895"                          
#define  _SOCK_OPER_ERR         "311896"                         
#define  _NODE_OPER_ERR         "311910"                       
#define  _NODE_GET_ERR          "311911"                       
#define  _NODE_ROOT_NULL        "311912"                      
#define  _SYNC_OUT_FAIL         "311930"                       
#define  _SYNC_CYCLE            "311931"                       
#define  _SYNC_NEED_SEND        "311932"                       
#define  _SYNC_NOT_SIGN         "311933"                         
#define  _SYNC_NOT_SEQU         "311934"                          
#define  _CSER_INIT_FAIL        "311950"                                     
#define  _APPC_SESS_FAIL        "311951"                               
#define  _SNA_SEND_FAIL         "311952"                          
#define  _SNA_RECV_FAIL         "311953"                          
#define  _SNA_TIME_OUT          "311954"                             
#define  _SNA_CONFIRM_FAIL      "311955"                          
#define  _SNA_INIT_ERR        "311956"                        
#define  _SNA_ALLOCATE_FAIL     "311957"                            
#define  _SNA_FREE_FAIL         "311958"                                         
#define  _SNA_FINDLU_ERR     "311959"                        
#define  _ETF_GET_ERR        "311970"                          
                                                                           
#define  _MAC_ERR               "352000"                    
#define  _DECRY_ERR             "352001"                    
#define  _ENCRY_CHECK_ERR       "352002"                       
#define  _AUTH_CODE_ERR         "352003"                         
#define  _PAY_CODE_ERR          "352004"                    
#define  _CODESEAL_ERR          "352005"                      
#define  _CHECKSUM_ERR          "352006"                         
#define  _KEY_UPDATE_ERR        "352007"                       
#define  _KEY_UPDATE_FAIL       "352008"                       
#define  _SYS_UPDATE_KEY        "352009"                          
#define  _OUT_UPDATE_KEY        "352010"                          
#define  _KEY_ERR               "352011"                    
#define  _NEED_INIT_KEY         "352012"                       
#define  _PIN_FAILURE           "352013"                     
#define  _CENTER_SECU_ERR       "352014"                      
#define  _ENMACH_STAT_ERR       "352015"                             
                                                                          
#define  _IN_LEDGER_UNCONF      "363000"                       
#define  _OUT_LEDGER_UNCONF     "363001"                       
#define  _SUM_LEDGER_UNCONF     "363002"                         
#define  _INEXIST_LEDGER_LIST   "363003"                         
#define  _SUM_AMOUNT_UNCONF     "363004"                      
#define  _SUM_COUNT_UNCONF      "363005"                      
#define  _DEBIT_CNT_ERR         "363006"                       
#define  _CREDIT_CNT_ERR        "363007"                       
#define  _DEBIT_AMT_ERR         "363008"                       
#define  _CREDIT_AMT_ERR        "363009"                       
#define  _CAN_NOT_SETT          "363010"                          
#define  _TODAY_ALRE_SETT       "363011"                      
#define  _INVA_SETT_DATE        "363012"                       
#define  _BUSS_NOT_SETT         "363013"                            
#define  _PMS_NOT_SETT          "363014"                            

#define  _AGR_NOT_FOUND         "400001"                    
#define  _AGR_NOT_EFFECT        "400002"                    
#define  _AGR_INVALID           "400003"                    
#define  _AGR_ERROR             "400004"                  
#define  _AGR_EXISTS            "400005"                    
#define  _AGT_NOT_EXISTS        "400006"                        
#define  _AGT_CLOSED            "400007"                        
#define  _AGT_EXISTS            "400008"                        
                                                                          
#define  _CIM_OVR_TLRLVL        "450101"                                    
#define     _CIM_OVR_ORGPRV        "450102"                                    

#define  _AUTH_CLOSE_CHECK      "FA0001"                          
#define  _AUTH_VOID         "FA0002"                          
#define  _AUTH_TABLE_MAIN       "FA0003"                          
#define  _AUTH_TEMP_ACCT        "FA0004"                       
#define  _AUTH_PRINT_AGAIN      "FA0005"                          
#define  _AUTH_HAND_FEE     "FA0006"                               
#define  _AUTH_EXIGENCY_MSG     "FA0007"                          
#define  _AUTH_VOID_APPLY    "FA0008"                             
#define  _AUTH_BACK_APPLY    "FA0009"                             
#define  _AUTH_MODI_STATUS    "FA0010"                             
#define  _AUTH_REPT_DIFF     "FA0011"                          

#define  _UNKNOW_ERR            "999999"                    





#define ClearStr(str) memset(str,'\0',sizeof(str))
                                                                               
                                  
                          
                                            
                                           
                               
                         
                                          
                                                   
                                        
                                                          
                                             
                                            
                                           
                                                                               
int HawGetFmpVal(ETF *TrNode, TranData *trdata, PbItemData args,  DBConHandle *DBHandle)
{
  EXEC SQL INCLUDE SQLCA;
  EXEC SQL BEGIN DECLARE SECTION;
EXEC SQL END DECLARE SECTION;


    char   sFmpSrc[FmpSrcLen+1];
    char   sFmpVal[FmpValLen+1];
  
                
  
  bpTraceLog( trdata, "Begin HawGetFmpVal.\n" );
  
                    
  
  if( Step_Args_Num != 1 ) {
    bpAddResult( TrNode, "HAW999", "" );
    bpErrorLog( trdata, "HawGetFmpVal: !" );
    return( -1 );
  }
  ClearStr( sFmpSrc );
  ClearStr( sFmpVal );
 strcpy( sFmpSrc, Step_Arg1 );
  MD5X(sFmpSrc,sFmpVal);
  etfAddOrRepNode( TrNode, "FmpVal", sFmpVal, FmpValLen );
  bpAddResult( TrNode, "000000", "" );
  bpTraceLog( trdata, "End HawGetFmpVal.\n" );
  return (0);
}
                                                                               
                              
                                                  
                                            
                                           
                      
                         
                                          
                                                   
                                        
                                                          
                                             
                                            
                                           
                                                                               
int HawToHex(ETF *TrNode, TranData *trdata, PbItemData args,  DBConHandle *DBHandle)
{
  EXEC SQL INCLUDE SQLCA;
  EXEC SQL BEGIN DECLARE SECTION;
EXEC SQL END DECLARE SECTION;


    char  sSrcDat[MaxLen+1];
    char  sHexDat[MaxLen+1];
    long  i,len;
  
                    
  
  if( Step_Args_Num != 1 ) {
    bpAddResult( TrNode, "HAW999", "" );
    bpErrorLog( trdata, "HawToHex: !" );
    return( -1 );
  }
  ClearStr( sSrcDat );
  ClearStr( sHexDat );

  
                          

                                        
                 

                                        
                 
  
  strcpy( sSrcDat, Step_Arg1 );
  i=atol( sSrcDat );
  sprintf( sHexDat,"%X",i );
  etfAddOrRepNode( TrNode, "HexDat", sHexDat, MaxLen );
  return(0);
}
                                                                               
                               
                                              
                                             
                                            
                                           
                      
                         
                                          
                                                   
                                        
                                                          
                                             
                                            
                                           
                                                                               
int HawRevOrd(ETF *TrNode, TranData *trdata, PbItemData args,  DBConHandle *DBHandle)
{
  EXEC SQL INCLUDE SQLCA;
  EXEC SQL BEGIN DECLARE SECTION;
EXEC SQL END DECLARE SECTION;


  char  sSrcDat[MaxLen+1];
  char  sRevDat[MaxLen+1];
  char  sTmpDat[3];
  long  i,len;

  
                
  
  bpTraceLog( trdata, "Begin HawRevOrd.\n" );
  
                    
  
  if( Step_Args_Num != 1 ) {
    bpAddResult( TrNode, "HAW999", "" );
    bpErrorLog( trdata, "HawRevOrd: !" );
    return( -1 );
  }
  
                          
                                        
                 
                                        
                 
  
  ClearStr( sSrcDat );
  ClearStr( sRevDat );
  ClearStr( sTmpDat );

  strcpy( sSrcDat, Step_Arg1 );

  for ( i=MaxLen-2;i>=0;i=i-2 )  {
    memcpy( sTmpDat, sSrcDat+i, 2 );
    strcat( sRevDat, sTmpDat );
  }
  etfAddOrRepNode( TrNode, "RevDat", sRevDat, MaxLen );
  
                
                
  
  return(0);
}
