<?xml version='1.0' encoding='ISO-8859-1'?>
<FrontTab>
  <Macro name="EfeSqlLst" desc="数据操作宏清单">
    <DynSentence name="UpdJobLst" desc="更新待处理信息">
      <Sentence>
        update pfajoblst set JobSts='1' where pfasub='%s' and pfadat='%s' and SPfaCd='%s'
      </Sentence>
      <Fields>PfaSub|PfaDat|SPfaCd|</Fields>
    </DynSentence>
  </Macro>
<!--以下是应用操作的宏清单-->
<!--以下是应用操作的宏清单-->
<!--以下是应用操作的宏清单-->
<!--以下是应用操作的宏清单-->
<!--以下是应用操作的宏清单-->
<!--以下是应用操作的宏清单-->
  <Macro name="Chk_TxnSrc">  <!--检查交易来源-->
    <If condition="INTCMP(STRLEN(DELBOTHSPACE($TxnSrc)),3,0)">
      <Set>TxnCnl=TRM</Set>
      <Set>CnlTyp=0</Set>
    </If>
    <Else>
      <Set>TxnSrc=DELBOTHSPACE($TxnSrc)</Set>
      <Exec func="PUB:CodeSwitching">
        <Arg name="DatSrc"  value="OPFCSW"/>
        <Arg name="SourNam" value="TxnSrc"/>
        <Arg name="DestNam" value="CnlTyp"/>
        <Arg name="TblNam"  value="TxnSrc2CnlTyp"/>
      </Exec>
    </Else>
  </Macro>

  <Macro name="GetEfeId">
    <Set>EfeId=STRCAT(SUBSTR($NodNo,1,3),999)</Set>
  </Macro>

  <Macro name="TxnSrc_TxnCnl">
    <Set>TxnSrc=DELBOTHSPACE($TxnSrc)</Set>
    <Exec func="PUB:CodeSwitching">
      <Arg name="DatSrc"  value="OPFCSW"/>
      <Arg name="SourNam" value="TxnSrc"/>
      <Arg name="DestNam" value="TxnCnl"/>
      <Arg name="TblNam"  value="TxnSrc2TxnCnl"/>
    </Exec>
  </Macro>

  <Macro name="InitTran" desc="交易初始化">
    <Exec func="PUB:IsExistNode" error="IGNORE">
      <Arg name="FieldName" value="TlrId"/>
    </Exec>
    <If condition="INTCMP(~RetCod,3,0)" desc="存在">
      <Exec func="PUB:GetBranchNoByTeller" error="IGNORE"/>
    </If>
    <Else>
      <Exec func="PUB:GetBranchNoByNodeNo"/>
    </Else>
<!--
    <Exec func="PUB:IsExistNode" error="IGNORE">
      <Arg name="FieldName" value="BrNo"/>
    </Exec>
    <If condition="INTCMP(~RetCod,3,-1)" desc="不存在">
      <Set>MsgTyp=E</Set>
      <Set>RspCod=EFE999</Set>
      <Set>RspMsg=缺少分行号配置信息</Set>
      <Return/>
    </If>
-->
    <Exec func="PUB:InitTransaction"/>
    <Set>JYRQ=GETDATETIME(YYYYMMDD)</Set>
    <Set>JYSJ=GETDATETIME(HHMISS)</Set>
    <Set>OBrNo=$BrNo</Set>
    <Set>BrNo=999999</Set>
    <Exec func="PUB:nGetPubSeqNo">
      <Arg name="SeqNam" value="EFE:JYLSH"/>
      <Arg name="SeqCnt" value="1"/>
      <Arg name="Len"    value="12"/>
      <Arg name="CycCnd" value="Y"/>
    </Exec>
    <Set>JYBSH=STRCAT($JYRQ,$SelVal)</Set>
    <Set>JYLSH=STRCAT($JYRQ,0301,$SelVal)</Set>
    <Set>BrNo=$OBrNo</Set>
    <Delete>OBrNo</Delete>
  </Macro>

  <Macro name="SendThirdOther" desc="发送第三方流程【查询类】">
    <Quote name="InitTran"/>
    <Set>WDMC=@BCFG.BrNam</Set>
    <Exec func="PUB:CallThirdOther" error="IGNORE">
      <Arg name="TxnCod" value="$SvrCod"/>
      <Arg name="ObjSvr" value="STHDEFEK"/>
    </Exec>
    <Switch expression="~RetCod">
      <Case value="0" desc="成功">
        <Set>MsgTyp=N</Set>
        <Set>RspCod=000000</Set>
        <Break/>
      </Case>
      <Case value="3" desc="交易失败">
        <Set>MsgTyp=E</Set>
        <Set>RspCod=$TRspCd</Set>
        <Break/>
      </Case>
      <Case value="-1" desc="超时">
        <Set>MsgTyp=E</Set>
        <Set>RspCod=EFE999</Set>
        <Set>RspMsg=交易超时</Set>
        <Break/>
      </Case>
      <Case value="-2" desc="系统故障">
        <Set>MsgTyp=E</Set>
        <Set>RspCod=EFE999</Set>
        <Set>RspMsg=系统故障</Set>
        <Break/>
      </Case>
      <Case value="-10" desc="交易发送失败">
        <Set>MsgTyp=E</Set>
        <Set>RspCod=EFE999</Set>
        <Set>RspMsg=交易发送失败</Set>
        <Break/>
      </Case>
      <Default>
        <Set>MsgTyp=E</Set>
        <Set>RspCod=EFE999</Set>
        <Set>RspMsg=交易失败，其他未知情况</Set>
        <Break/>
      </Default>
    </Switch>
  </Macro>
<!--以上是应用操作的宏清单-->
<!--以上是应用操作的宏清单-->
<!--以上是应用操作的宏清单-->
<!--以上是应用操作的宏清单-->
<!--以上是应用操作的宏清单-->
<!--以上是应用操作的宏清单-->
</FrontTab>
