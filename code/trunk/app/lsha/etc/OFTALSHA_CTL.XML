<?xml version='1.0' encoding='ISO-8859-1'?>
<Application name="LSH" code="421">
<!--add by yangliwen for 车船税 20090206 begin-->
	<LibDeclare>
    <Library name="MQ"  value="dll/mq.so" />
    <Library name="YDCZ"  value="dll/ydcz.so" />
  </LibDeclare>
<!--add by yangliwen 20090206 end-->
	<!--广州电信代扣主控-->
	<GlobalFunction>
		<Include file="etc/ActJudge_IIT.XML"/>  <!--区别对公对私帐号-->
  	 <Function name="_after">
       <Process>
          <If condition="ISNULL($MsgTyp)">
             <If condition="ISNULL(DELBOTHSPACE($RspCod))"> <!--若RspCod为空，则认为成功-->
                <Set>MsgTyp=N</Set>
                <Set>RspCod=000000</Set>
             </If>
             <Else>
                <If condition="IS_NOEQUAL_STRING($RspCod,000000)"> <!--返回码不为000000-->
                   <Set>MsgTyp=E</Set>
                </If>
                <Else>
                   <Set>MsgTyp=N</Set>
                </Else>
             </Else>
          </If>
       </Process>
   	</Function>
	</GlobalFunction>
	<ConfigDeclare>
	  <Config name="BatFormat"   value="etc/LSH_FMT_441999.XML"/>
	  <Config name="ParaFile"    value="etc/CFG_LSH_441999.XML"/>
		<Config name="OPFCSW"      value="etc/LSH_CSW_441999.XML"/>
	</ConfigDeclare>
	<PackageDeclare>
		<Package name="AFE"      value="etc/DAFE_PKG.XML"/>
	</PackageDeclare>
	<TableDeclare>
		<Table name="afetxnjnl"      value="afetxnjnl"/>  <!--业务流水表-->
		<Table name="srftxnjnl441"   value="srftxnjnl441"/>  <!--学费缴费业务流水表-->
		<Table name="savthdinf"      value="savthdinf"/>  <!--第三方信息表-->
		<Table name="savcusagt"      value="savcusagt"/>  <!--协议信息表-->
	</TableDeclare>
	<BusDefDeclare>
		<Busdef name="BrNo"  value="441999"/>
		<Busdef name="AplCls"   value="421"/>    <!--Added by ylw 20101124-->
	</BusDefDeclare>
	<Define>
		<Macro name="Chk_TxnSrc">  <!--检查交易来源-->
			<If condition="INTCMP(STRLEN(DELBOTHSPACE($TxnSrc)),3,0)">
				<Set>TxnCnl=TRM</Set>   
				<Set>CnlTyp=0</Set>
			</If>
			<Else>
				<Set>TxnSrc=DELBOTHSPACE($TxnSrc)</Set>
				<Exec func="PUB:CodeSwitching">
					<Arg name="DatSrc"  value="OPFCSW"/>
					<Arg name="SourNam" value="TxnSrc"/>
					<Arg name="DestNam" value="CnlTyp"/>
					<Arg name="TblNam"  value="TxnSrc2CnlTyp"/>
				</Exec>
			</Else>
		</Macro>
		<!--20090615 begin-->
		<Macro name="TxnSrc_TxnCnl">
			<Set>TxnSrc=DELBOTHSPACE($TxnSrc)</Set>
			<Exec func="PUB:CodeSwitching">
				<Arg name="DatSrc"  value="OPFCSW"/>
				<Arg name="SourNam" value="TxnSrc"/>
				<Arg name="DestNam" value="TxnCnl"/>
				<Arg name="TblNam"  value="TxnSrc2TxnCnl"/>
			</Exec>
		</Macro>
		<!--20090615 end-->
		<!--20120903 begin-->
		<Macro name="AntiMoneylaudry">
       <!--反洗钱需要增加主机接口调用BEGIN-->
       <Set>LogNo= </Set>
       <Set>TxnDat=$ActDat</Set> <!--交易日期-->
       <Set>HstTrc=$HLogNo</Set> <!--日志号-->
       <Set>HLogNo= </Set>
       <Set>OTckNo=$TckNo</Set>  <!--流水号-->
       <Set>TxnMod=000151</Set>  <!--交易方式:人民币非现金其他-->
       <Set>TCommNm=交通银行</Set>      <!--对方金融机构名称-->
       <Set>TCusNm= </Set>       <!--对方客户名称-->
       <Set>TIdTyp= </Set>       <!--对方证件种类-->
       <Set>TIdNo= </Set>        <!--对方证件号码-->
       <Set>StlActNo=$TActNo</Set> <!--交易对手账号-->
       
       <Exec func="PUB:CallHostOther" error="IGNORE">
          <Arg name="TxnCod" value="472600"></Arg>
          <Arg name="ObjSvr" value="SHSTPUB2"></Arg>
       </Exec>
       <!--反洗钱需要增加主机接口调用END-->
		</Macro>
		<!--20120903 end-->
	</Define>

 <Transaction code="482101" desc="第三方查询交易">
		<FlowCtrl>
			<Exec func="PUB:GetLogNo"/>
			<If condition="INTCMP($RsFld2,3,0071)">
			<Set>Len=0166</Set>
			</If>
			<Else>
			<Set>Len=0160</Set>
			</Else>
			
			<Exec func="PUB:CallThirdOther" error="IGNORE">   <!--第三方查询-->
				<Arg name="HTxnCd" value="$TTxnCd"/>
				<Arg name="ObjSvr" value="STDALSHA"/>
			</Exec>
      <!-- add by xuan begin 20140306 -->
      <If condition="INTCMP(~RetCod,1,0)">
        <Set>MsgTyp=E</Set>
        <Set>RspCod=LSH999</Set>
        <Set>RspMsg=调用第三方时:系统错误或超时或未发送,请检查后重做 </Set>
        <Return/>
      </If>
      <!-- add by xuan end 20140306 -->
			<Set>RspCod=$RspCod</Set>
		</FlowCtrl>
	</Transaction>


	<Transaction code="482102" desc="电信缴费">
		<Attributes>
			<Attribute name="integrity" value="2" code="482107" interval="5" timeout="30" maxtimes="15"/> <!--自动冲正-->
		</Attributes>
		<Attributes>
      <Attribute name="nodatabase" value="2"/>
    </Attributes>
		<DynSentence name="QryCrpAgr"><!--查询单位信息 -->
			<Sentence>
				SELECT TActNo, BBusTyp FROM savcrpagr WHERE CAgtNo='%s' AND SvrSts='1'
			</Sentence>
			<Fields>CAgtNo|</Fields>
		</DynSentence>
		<FlowCtrl>
			<Exec func="PUB:InitTransaction"/>            <!--交易初始化,预留-->
			<Exec func="PUB:ReadRecord">
				<Arg name="SqlCmd" value="QryCrpAgr"/>
			</Exec>
		
		  <!--add by xuan for sfb 20120315-->
      <If condition="OR(IS_EQUAL_STRING($TxnSrc,MB441),IS_EQUAL_STRING($TxnSrc,WE441),IS_EQUAL_STRING($TxnSrc,SF441))"><!--网上银行或者收富宝-->
        <Set>PayMod=1</Set>
      </If>
      <Else>                                                  <!--自助终端-->
        <Set>PayMod=0</Set>
      </Else>
	
			<Set>NodNo=441800</Set>
			<Set>RcvAmt=$TxnAmt</Set>
      <Set>CntrId=01</Set>
			<Set>RsFld3=$TCusNm</Set>
			<If condition="OR(INTCMP($ActTyp,3,0),INTCMP($ActTyp,3,2),INTCMP($ActTyp,3,4))"><!--对私-->
				<Set>HTxnCd=471140</Set>
				<Set>VchChk=0</Set>
				<!--Set>PayMod=0</Set-->
				<Set>ActFlg=$ActTyp</Set>
				<Set>VchCod=00000000</Set>
			</If>
			<ElseIf condition="INTCMP($ActTyp,3,1)"><!--对公-->
				<Set>HTxnCd=451610</Set>
				<Set>ActNod=SUBSTR($TActNo,1,6)</Set>
				<Set>ActSqn=SUBSTR($TActNo,14,5)</Set>
				<Delete>TActNo</Delete>
				<Set>BusTyp=CRP51</Set>
				<Set>BusSub=01</Set>   <!--应用子码，对应业务类型CRP51-->
				<Set>ActFlg=2</Set>
			</ElseIf>
			<Else>    <!--第三方-->
				<!--
				<Set>TTxnCd=STRCAT($TTxnCd,_T)</Set>
				<Set>ThdSvr=STDDOPFP</Set>-->
				<!--他行卡暂时不做-->
				<Return/>
			</Else>
			
			<If condition="INTCMP($RsFld2,3,0071)">
			<Set>Len=0166</Set>
			</If>
			<Else>
			<Set>Len=0160</Set>
			</Else>
			
			<Set>FTxnTm=GETDATETIME()</Set>
			<Quote name="Chk_TxnSrc"/>
			<!--20090615 begin-->
			<Quote name="TxnSrc_TxnCnl"/>
      <!--20090615 end-->
      
			<Exec func="PUB:ReadModuleCfg">
				<Arg name="Application" value="$AppNm"/>
				<Arg name="Transaction" value="482102"/>
			</Exec>

			<Call package="AFE" function="AFE_SglBkPay"/>

			<If condition="$RspCod=000000">
				<Set>MsgTyp=N</Set>
			</If>
		</FlowCtrl>
	</Transaction>

<Transaction code="482107" desc="系统冲正">
    <DynSentence name="QueJnlInf">
			<Sentence>
				select RSFLD2 from afetxnjnl where LogNo='%s' AND HTxnSt IN ('S','T','U') AND RSFLD2 IN ('0001','0010','0013','3002','0049','0100','0112','0114','0241')
			</Sentence>
			<Fields>LogNO|</Fields>
		</DynSentence>
		<FlowCtrl>
			<Exec func="PUB:InitTransaction"/>
			
			<Exec func="PUB:ReadRecord">
				<Arg name="SqlCmd" value="QueJnlInf"/>
			</Exec>
			
			<Quote name="Chk_TxnSrc"/>
			<!--Set>RsFld1=P003</Set-->
				<Set>Len=0178</Set>
				<Set>FTxnTm=GETDATETIME()</Set>
			<Exec func="PUB:ReadModuleCfg">
				<Arg name="Application" value="GZ_TELE"/>
				<Arg name="Transaction" value="482107"/>
			</Exec>
			<Call package="AFE" function="AFE_BkCancel"/>
			<If condition="$RspCod=000000">
				<Set>MsgTyp=N</Set>
			</If>
		</FlowCtrl>
	</Transaction>

	

	<Transaction code="482103" desc="对帐">
		<DynSentence name="GetTxnJnl">  <!--生成文件-->
			<Sentence>
				SELECT * FROM afetxnjnl WHERE ActDat='%s' AND HTxnSt='S' AND CAgtNo in ('4410000539','4410002654','4410002655','4410002656') order by CAgtNo
			</Sentence>
			<Fields>TxnDat|</Fields>
		</DynSentence>
		<DynSentence name="Cnt">  <!--生成文件-->
			<Sentence>
				SELECT Count(*) OrnCnt, SUM(CAST(TxnAmt As BIGINT)) OrnAmt FROM afetxnjnl WHERE ActDat='%s' AND HTxnSt='S' AND CAgtNo in ('4410000539','4410002654','4410002655','4410002656')
			</Sentence>
			<Fields>TxnDat|</Fields>
		</DynSentence>
		<FlowCtrl>
			<Exec func="PUB:InitTransaction"/>
			<Set>TxnDat=CALCDATE($ActDat,-,d,1)</Set>
			<Set>LclFil=STRCAT(64_,$TxnDat,_jhpos,.441999)</Set>
			<Set>ObjFil=STRCAT(64_,$TxnDat,_jhpos,.txt)</Set>
			<Set>SendFil=STRCAT(GETENV(WORKDIR),/dat/opf/,$LclFil)</Set>
			<Set>AppNm=GZ_TELE</Set>
			<Exec func="PUB:CodeSwitching">
				<Arg name="DatSrc"  value="OPFCSW"/>
				<Arg name="SourNam" value="AppNm"/>
				<Arg name="DestNam" value="CAgtNo"/>
				<Arg name="TblNam"  value="GZ_AppNm"/>
			</Exec>
			<Exec func="PUB:ReadRecord">
				<Arg name="SqlCmd" value="Cnt"/>
			</Exec>
			<Exec func="PUB:ExportFromDB">   <!--产生上送主机的文件-->
				<Arg name="SqlName" value="GetTxnJnl"/>
				<Arg name="FormatName" value="GZ_TELE"/>
				<Arg name="FileName" value="$SendFil"/>
				<Arg name="TableName" value="afetxnjnl"/>
			</Exec>
			
			<Exec func="PUB:FtpPut">
				<Arg name="FtpId" value="GZ_TELE1"/>
			</Exec>
			
		<!--终端地址表-->
		<Set>FmtFil=etc/LSHA2_RPT_441999.XML</Set>
	  <Set>FilNam=STRCAT(jhpos_id_,$TxnDat,.prn)</Set>	
		<Exec func="EXT:GenerateReport">
		    <Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/opf/,$FilNam)"/>
				<Arg name="FmtFil" value="$FmtFil"/>
				<Arg name="CAgtNo" value="$CAgtNo"/>
				<Arg name="TxnDat" value="$TxnDat"/>
				<Arg name="PNodNo"  value="$NodNo"/>
		    <Arg name="PTlrId"  value="$TlrId"/>
		</Exec>
	
	  <Set>LclFil=$FilNam</Set>
		<Set>ObjFil=$FilNam</Set>		
		<Exec func="PUB:FtpPut">
				<Arg name="FtpId" value="GZ_TELE2"/>
		</Exec>
			
			<!--汇总表-->
		<Set>FmtFil=etc/LSHA3_RPT_441999.XML</Set>
	  <Set>FilNam=STRCAT(jhpos_64_,$TxnDat,.prn)</Set>	
		<Exec func="EXT:GenerateReport">
		    <Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/opf/,$FilNam)"/>
				<Arg name="FmtFil" value="$FmtFil"/>
				<Arg name="CAgtNo" value="$CAgtNo"/>
				<Arg name="TxnDat" value="$TxnDat"/>
				<Arg name="PNodNo"  value="$NodNo"/>
		    <Arg name="PTlrId"  value="$TlrId"/>
			</Exec>
		<Set>LclFil=$FilNam</Set>
		<Set>ObjFil=$FilNam</Set>		
		<Exec func="PUB:FtpPut">
				<Arg name="FtpId" value="GZ_TELE3"/>
		</Exec>
		
		<!--明细表-->	
		<Set>FmtFil=etc/LSHA4_RPT_441999.XML</Set>
	  <Set>FilNam=STRCAT(jhpos_,$TxnDat,.prn)</Set>	
		<Exec func="EXT:GenerateReport">
		    <Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/opf/,$FilNam)"/>
				<Arg name="FmtFil" value="$FmtFil"/>
				<Arg name="CAgtNo" value="$CAgtNo"/>
				<Arg name="TxnDat" value="$TxnDat"/>
				<Arg name="PNodNo"  value="$NodNo"/>
		    <Arg name="PTlrId"  value="$TlrId"/>
			</Exec>
		
	  <Set>LclFil=$FilNam</Set>
		<Set>ObjFil=$FilNam</Set>			
		<Exec func="PUB:FtpPut">
				<Arg name="FtpId" value="GZ_TELE4"/>
		</Exec>
		</FlowCtrl>
	</Transaction>

	<Transaction code="482104" desc="手工对帐">
		<DynSentence name="GetTxnJnl">  <!--生成文件-->
			<Sentence>
				SELECT * FROM afetxnjnl WHERE ActDat='%s' AND HTxnSt='S' AND CAgtNo in ('4410000539','4410002654','4410002655','4410002656') order by CAgtNo
			</Sentence>
			<Fields>TxnDat|</Fields>
		</DynSentence>
		<DynSentence name="Cnt">  <!--生成文件-->
			<Sentence>
				SELECT Count(*) OrnCnt, SUM(CAST(TxnAmt As BIGINT)) OrnAmt FROM afetxnjnl WHERE ActDat='%s' AND HTxnSt='S' AND CAgtNo in ('4410000539','4410002654','4410002655','4410002656')
			</Sentence>
			<Fields>TxnDat|</Fields>
		</DynSentence>
		<FlowCtrl>
			<Exec func="PUB:InitTransaction"/>
			<!--Set>TxnDat=CALCDATE($ActDat,-,d,1)</Set-->
			<Set>LclFil=STRCAT(64_,$TxnDat,_jhpos,.441999)</Set>
			<Set>ObjFil=STRCAT(64_,$TxnDat,_jhpos,.txt)</Set>
			<Set>SendFil=STRCAT(GETENV(WORKDIR),/dat/opf/,$LclFil)</Set>
			<Set>AppNm=GZ_TELE</Set>
			<Exec func="PUB:CodeSwitching">
				<Arg name="DatSrc"  value="OPFCSW"/>
				<Arg name="SourNam" value="AppNm"/>
				<Arg name="DestNam" value="CAgtNo"/>
				<Arg name="TblNam"  value="GZ_AppNm"/>
			</Exec>
			<Exec func="PUB:ReadRecord">
				<Arg name="SqlCmd" value="Cnt"/>
			</Exec>
			<Exec func="PUB:ExportFromDB">   <!--产生上送主机的文件-->
				<Arg name="SqlName" value="GetTxnJnl"/>
				<Arg name="FormatName" value="GZ_TELE"/>
				<Arg name="FileName" value="$SendFil"/>
				<Arg name="TableName" value="afetxnjnl"/>
			</Exec>
			
			<Exec func="PUB:FtpPut">
				<Arg name="FtpId" value="GZ_TELE1"/>
			</Exec>
			
		<!--终端地址表-->
		<Set>FmtFil=etc/LSHA2_RPT_441999.XML</Set>
	  <Set>FilNam=STRCAT(jhpos_id_,$TxnDat,.prn)</Set>	
		<Exec func="EXT:GenerateReport">
		    <Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/opf/,$FilNam)"/>
				<Arg name="FmtFil" value="$FmtFil"/>
				<Arg name="CAgtNo" value="$CAgtNo"/>
				<Arg name="TxnDat" value="$TxnDat"/>
				<Arg name="PNodNo"  value="$NodNo"/>
		    <Arg name="PTlrId"  value="$TlrId"/>
		</Exec>
	
	  <Set>LclFil=$FilNam</Set>
		<Set>ObjFil=$FilNam</Set>		
		<Exec func="PUB:FtpPut">
				<Arg name="FtpId" value="GZ_TELE2"/>
		</Exec>
			
			<!--汇总表-->
		<Set>FmtFil=etc/LSHA3_RPT_441999.XML</Set>
	  <Set>FilNam=STRCAT(jhpos_64_,$TxnDat,.prn)</Set>	
		<Exec func="EXT:GenerateReport">
		    <Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/opf/,$FilNam)"/>
				<Arg name="FmtFil" value="$FmtFil"/>
				<Arg name="CAgtNo" value="$CAgtNo"/>
				<Arg name="TxnDat" value="$TxnDat"/>
				<Arg name="PNodNo"  value="$NodNo"/>
		    <Arg name="PTlrId"  value="$TlrId"/>
			</Exec>
		<Set>LclFil=$FilNam</Set>
		<Set>ObjFil=$FilNam</Set>		
		<Exec func="PUB:FtpPut">
				<Arg name="FtpId" value="GZ_TELE3"/>
		</Exec>
		
		<!--明细表-->	
		<Set>FmtFil=etc/LSHA4_RPT_441999.XML</Set>
	  <Set>FilNam=STRCAT(jhpos_,$TxnDat,.prn)</Set>	
		<Exec func="EXT:GenerateReport">
		    <Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/opf/,$FilNam)"/>
				<Arg name="FmtFil" value="$FmtFil"/>
				<Arg name="CAgtNo" value="$CAgtNo"/>
				<Arg name="TxnDat" value="$TxnDat"/>
				<Arg name="PNodNo"  value="$NodNo"/>
		    <Arg name="PTlrId"  value="$TlrId"/>
			</Exec>
		
	  <Set>LclFil=$FilNam</Set>
		<Set>ObjFil=$FilNam</Set>			
		<Exec func="PUB:FtpPut">
				<Arg name="FtpId" value="GZ_TELE4"/>
		</Exec>
		</FlowCtrl>
	</Transaction>

	<Transaction code="482105" desc="银信通帐号查询">
	  <DynSentence name="QryJnlInfo"><!--查询短信签约信息 -->
			<Sentence>
				SELECT IdNo TCusId FROM sfmcusagra WHERE BrNo='%s' AND MobTel='%s' AND Status='0'
			</Sentence>
			<Fields>BrNo|MobTel|</Fields>
		</DynSentence>
	  <FlowCtrl>
		<Exec func="PUB:InitTransaction"/>
		
		<Exec func="PUB:ReadRecord">  <!--查询 -->
				<Arg name="SqlCmd" value="QryJnlInfo"/>
		</Exec>
		 <Switch expression="~RetCod">
         <Case value="-1">  
						<Set>MsgTyp=E</Set>             
            <Set>RspCod=482199</Set>
            <Set>RspMsg=STRCAT(数据库错误!,$SqlCod)</Set>
            <Return/>
         </Case>
         <Case value="0">               
            <Break/>
         </Case>
	     <Default>
						<Set>MsgTyp=E</Set>
            <Set>RspCod=482199</Set>
            <Set>RspMsg=签约数据不存在</Set>
            <Return/>
         </Default>
	  </Switch>    
			 
		<Set>AcJudFunc=STRCAT(AcJud_,$BrNo)</Set>
		<Call function="$AcJudFunc">
				<Input name="ActNo|NewFlg|"/>
				<Output name="OActNo|ActCls|"/>
		</Call>
		
		<Set>CcyCod=CNY</Set>
	
	  <If condition="INTCMP($ActCls,3,3)">
			 <Set>ActTyp=4</Set>
	  </If>
	  <Else>
				<Set>ActTyp=2</Set>
	  </Else>
	
    <Exec func="PUB:CallHostOther" error="IGNORE">
          <Arg name="HTxnCd" value="476520"/>
          <Arg name="ObjSvr" value="SHSTPUB1"/>
     </Exec>
     <If condition="$MsgTyp!=N">
               <Set>RspCod=481903</Set>
               <Set>RspMsg=帐户不存在</Set>
               <Return/> 
     </If>
     <!--当身份证不等时退出-->
       
       <Set>IDNo=DELBOTHSPACE($IDNo)</Set>
       <Set>RspMsg=$TCusId</Set>
       <Set>RspMsg=$IDNo</Set>
       <If condition="IS_NOEQUAL_STRING($TCusId,$IDNo)">
					<Set>MsgTyp=E</Set>
          <Set>RspCod=481907</Set>
			  	<Set>RspMsg=身份证不符</Set>
			    <Return/>        
        </If>
    
    <If condition="INTCMP($ActTyp,3,4)">   <!--卡要查一下实际余额-->
       <Set>VchTyp=$ActTyp</Set>
       <Set>PwdChk=2</Set>
       <If condition="INTCMP($ActCls,3,3)">
		   	 <Set>CrdNo=$ActNo</Set>
		   	 <Set>ActNo= </Set>
	     </If>
	     <Else>
		   		<Set>CrdNo= </Set>
	     </Else>
       <Set>InqTyp=0</Set>
       <Set>OMaxNum=1</Set>
       <Set>TxnCnl=6</Set>
       
        <Exec func="PUB:CallHostOther" error="IGNORE">
             <Arg name="HTxnCd" value="928410"/>
             <Arg name="ObjSvr" value="SHSTPUB1"/>
        </Exec>
        <If condition="$MsgTyp!=N">
                  <Set>RspCod=481903</Set>
                  <Set>RspMsg=帐户不存在</Set>
                  <Return/> 
        </If>
        <Set>Bal=$ActBal</Set>
     </If>
		</FlowCtrl>
	</Transaction>

	<!-- add by yangliwen 20090206 begin -->
	<Transaction code="482115" desc="车船税查询">
		<FlowCtrl>	  
      <!--电银部暂停该业务 20120619-->
			<Set>MsgTyp=E</Set>
			<Set>RspCod=482199</Set>
		  <Set>RspMsg=该业务暂停</Set>
	    <Return/>

			<Exec func="PUB:GetLogNo"/>
			<If condition="IS_EQUAL_STRING($RsFld2,0065)">
				<Set>Len=0174</Set>
			</If>
			<Else>
				<Set>Len=0160</Set>
			</Else>
			<Set>CTypNo=STRCAT($CarTyp,01,A,$CarNo)</Set>			
			
			<Exec func="PUB:CallThirdOther">   <!--第三方查询-->
				<Arg name="HTxnCd" value="482115"/>
				<Arg name="ObjSvr" value="STDALSHA"/>
			</Exec>

			<If condition="$RspCod=000000">
      	<Set>RsFld3=$TCusNm</Set>
				<Set>TCusNm1=SUBSTR($TCusNm,1,2)</Set>
				<If condition="IS_EQUAL_STRING(STRLEN($TCusNm),4)">
			    <Set> TCusNm =STRCAT($TCusNm1,＊)</Set>
				</If>
				<Else>
					<Set>TCusNm2=SUBSTR($TCusNm,5,SUB(STRLEN($TCusNm),4))</Set>
					<Set>TCusNm=STRCAT($TCusNm1,＊,$TCusNm2)</Set>
				</Else>
			 </If>

			<Set>RspCod=$RspCod</Set>
		</FlowCtrl>
	</Transaction>

	<Transaction code="482116" desc="缴车船税">
		<Attributes>
			<Attribute name="integrity" value="2" code="482107" interval="5" timeout="30" maxtimes="15"/> <!--自动冲正-->
		</Attributes>
		<Attributes>
			<Attribute name="nodatabase" value="2"/>
		</Attributes>
		<DynSentence name="QryCrpAgr"><!--查询单位信息 -->
			<Sentence>
				SELECT TActNo, BBusTyp FROM savcrpagr WHERE CAgtNo='%s' AND SvrSts='1'
			</Sentence>
			<Fields>CAgtNo|</Fields>
		</DynSentence>
		<FlowCtrl>
			<Exec func="PUB:InitTransaction"/>            <!--交易初始化,预留-->
			<Exec func="PUB:ReadRecord">
				<Arg name="SqlCmd" value="QryCrpAgr"/>
			</Exec>
			
			<Set>NodNo=441800</Set>
			<Set>RcvAmt=$TxnAmt</Set>
			<!---->
			<Set>ChkTim=$cartyp</Set><!--车辆类型-->
			<Set>CntrId=05</Set>
			<!---->
      <!--add by xuan for sfb 20120315-->
      <If condition="OR(IS_EQUAL_STRING($TxnSrc,WE441),IS_EQUAL_STRING($TxnSrc,SF441))"><!--网上银行或者收富宝-->
        <Set>PayMod=1</Set>
      </If>
      <Else>                                                  <!--自助终端-->
        <Set>PayMod=0</Set>
      </Else>

			<Set>CTypNo=STRCAT($CarTyp,01,A,$CarNo)</Set>
			<If condition="OR(INTCMP($ActTyp,3,0),INTCMP($ActTyp,3,2),INTCMP($ActTyp,3,4))"><!--对私-->
				<Set>HTxnCd=471140</Set>
				<Set>VchChk=0</Set>
				<!--Set>PayMod=0</Set-->
				<Set>ActFlg=$ActTyp</Set>
				<Set>VchCod=00000000</Set>
			</If>
			<ElseIf condition="INTCMP($ActTyp,3,1)"><!--对公-->
				<Set>HTxnCd=451610</Set>
				<Set>ActNod=SUBSTR($TActNo,1,6)</Set>
				<Set>ActSqn=SUBSTR($TActNo,14,5)</Set>
				<Delete>TActNo</Delete>
				<Set>BusTyp=CRP51</Set>
				<Set>BusSub=01</Set>   <!--应用子码，对应业务类型CRP51-->
				<Set>ActFlg=2</Set>
			</ElseIf>
			<Else>    <!--第三方-->
				<!--
				<Set>TTxnCd=STRCAT($TTxnCd,_T)</Set>
				<Set>ThdSvr=STDDOPFP</Set>-->
				<!--他行卡暂时不做-->
				<Return/>
			</Else>
			
			<If condition="IS_EQUAL_STRING($RsFld2,0065)">
				<Set>Len=0166</Set>
			</If>
			<Else>
				<Set>Len=0160</Set>
			</Else>
			
			<Set>FTxnTm=GETDATETIME()</Set>
			<Quote name="Chk_TxnSrc"/>
			<!--20090615 begin-->
			<Quote name="TxnSrc_TxnCnl"/>
      <!--20090615 end-->

			<Exec func="PUB:ReadModuleCfg">
				<Arg name="Application" value="$AppNm"/>
				<Arg name="Transaction" value="482102"/>
			</Exec>
			<Call package="AFE" function="AFE_SglBkPay"/>
			<If condition="$RspCod=000000">
				<Set>MsgTyp=N</Set>
			</If>
		</FlowCtrl>
	</Transaction>
	
	<Transaction code="482146" desc="判断车牌号码位数">		
	  <FlowCtrl>	  
	     		   
		 <If condition="IS_NOEQUAL_STRING(STRLEN(DELSPACE($TCusID,right)),5)">
				<Set>MsgTyp=E</Set>
			   <Set>RspCod=482199</Set>
		     <Set>RspMsg=请输入5位车牌号码!</Set>
	       <Return/>
		 </If>	 	 
		<Set>MsgTyp=N</Set>
                
	  </FlowCtrl>
  </Transaction>
<!-- add by yangliwen 20090206 end -->

<!-- add by yangliwen 20090105 begin -->
  <Transaction code="482118" desc="有线电视月租费查询(身份证)">
    <FlowCtrl>
      <Exec func="PUB:GetLogNo"/>
      <If condition="OR(IS_EQUAL_STRING($RsFld2,0100),IS_EQUAL_STRING($RsFld2,0112),IS_EQUAL_STRING($RsFld2,0114))">
        <Set>Len=0176</Set>
      </If>
      <Else>
        <Set>Len=0160</Set>
      </Else>

      <Exec func="PUB:CallThirdOther">   <!--第三方查询-->
        <Arg name="HTxnCd" value="482118"/>
        <Arg name="ObjSvr" value="STDALSHA"/>
      </Exec>
      <Set>RspCod=$RspCod</Set>
    </FlowCtrl>
  </Transaction>

  <Transaction code="482119" desc="有线电视月租费查询(手册号)">
    <FlowCtrl>
      <Exec func="PUB:GetLogNo"/>
      <If condition="OR(IS_EQUAL_STRING($RsFld2,0100),IS_EQUAL_STRING($RsFld2,0112),IS_EQUAL_STRING($RsFld2,0114))">
        <Set>Len=0176</Set>
      </If>
      <Else>
        <Set>Len=0160</Set>
      </Else>

      <Exec func="PUB:CallThirdOther">   <!--第三方查询-->
        <Arg name="HTxnCd" value="482119"/>
        <Arg name="ObjSvr" value="STDALSHA"/>
      </Exec>
      <Set>RspCod=$RspCod</Set>
    </FlowCtrl>
  </Transaction>

  <Transaction code="482120" desc="有线电视缴费">
    <Attributes>
      <Attribute name="integrity" value="2" code="482107" interval="5" timeout="30" maxtimes="15"/> <!--自动冲正-->
    </Attributes>
    <Attributes>
      <Attribute name="nodatabase" value="2"/>
    </Attributes>
    <DynSentence name="QryCrpAgr"><!--查询单位信息 -->
      <Sentence>
        SELECT TActNo, BBusTyp FROM savcrpagr WHERE CAgtNo='%s' AND SvrSts='1'
      </Sentence>
      <Fields>CAgtNo|</Fields>
    </DynSentence>
    <FlowCtrl>
      <Exec func="PUB:InitTransaction"/>            <!--交易初始化,预留-->
      <Exec func="PUB:ReadRecord">
        <Arg name="SqlCmd" value="QryCrpAgr"/>
      </Exec>

      <!---->
      <Set>CntrId=04</Set>
      <Set>RsFld3=$TCusNm</Set>
      <If condition="IS_EQUAL_STRING($Jflag,AAA)">
        <Set>RcvAmt=$TxnAmt</Set>
      </If>
      <Else>
        <Set>TxnAmt1=ADDCHAR($Jflag,5,0,0)</Set>
        <Set>TxnAmt=ADDCHAR($TxnAmt1,15,0,1)</Set>
        <Set>RcvAmt=$TxnAmt</Set>
      </Else>
      <!---->
      <Set>NodNo=441800</Set>
      <!--
      <Set>RcvAmt=$TxnAmt</Set>
      -->

      <If condition="OR(INTCMP($ActTyp,3,0),INTCMP($ActTyp,3,2),INTCMP($ActTyp,3,4))"><!--对私-->
        <Set>HTxnCd=471140</Set>
        <Set>VchChk=0</Set>
        <Set>PayMod=0</Set>
        <Set>ActFlg=$ActTyp</Set>
        <Set>VchCod=00000000</Set>
      </If>
      <ElseIf condition="INTCMP($ActTyp,3,1)"><!--对公-->
        <Set>HTxnCd=451610</Set>
        <Set>ActNod=SUBSTR($TActNo,1,6)</Set>
        <Set>ActSqn=SUBSTR($TActNo,14,5)</Set>
        <Delete>TActNo</Delete>
        <Set>BusTyp=CRP51</Set>
        <Set>BusSub=01</Set>   <!--应用子码，对应业务类型CRP51-->
        <Set>ActFlg=2</Set>
      </ElseIf>
      <Else>    <!--第三方-->
        <!--
        <Set>TTxnCd=STRCAT($TTxnCd,_T)</Set>
        <Set>ThdSvr=STDDOPFP</Set>-->
        <!--他行卡暂时不做-->
        <Return/>
      </Else>

      <If condition="OR(IS_EQUAL_STRING($RsFld2,0100),IS_EQUAL_STRING($RsFld2,0112),IS_EQUAL_STRING($RsFld2,0114))">
      <Set>Len=0166</Set>
      </If>
      <Else>
      <Set>Len=0160</Set>
      </Else>

      <Set>FTxnTm=GETDATETIME()</Set>
      <Quote name="Chk_TxnSrc"/>
      <!--20090615 begin-->
			<Quote name="TxnSrc_TxnCnl"/>
      <!--20090615 end-->

      <Exec func="PUB:ReadModuleCfg">
        <Arg name="Application" value="GZ_TELE"/>
        <Arg name="Transaction" value="482102"/>
      </Exec>
      <Call package="AFE" function="AFE_SglBkPay"/>
      <If condition="$RspCod=000000">
        <Set>MsgTyp=N</Set>
      </If>
    </FlowCtrl>
  </Transaction>

	<Transaction code="482145" desc="补打凭条查询">
		<Attributes>
      <Attribute name="nodatabase" value="2"/>
    </Attributes>
    <DynSentence name="MultiQuery">
			<Sentence>
			  SELECT TCusID,RsFld3,TxnAmt,TckNo,CntrId,ChkTim,Rsfld2,FTxnTm from afetxnjnl WHERE ActNo='%s' and CntrId='%s' and BrNo='441999' and HTxnSt='S' order by FTxnTm DESC FETCH FIRST 20 ROWS ONLY			  
			</Sentence>
			<Fields>Actno|Jflx|</Fields>
		</DynSentence>
		<DynSentence name="Cnt">  <!--笔数-->
			<Sentence>
				SELECT Count(*) SumCnt FROM afetxnjnl where ActNo ='%s' and CntrId='%s' and BrNo='441999' and HTxnSt='S'
			</Sentence>
			<Fields>Actno|Jflx|</Fields>
		</DynSentence>
	  <FlowCtrl>	  	  
		   <Exec func="PUB:InitTransaction"/>            <!--交易初始化,预留-->	   
		   <!--Exec func="PUB:ReadRecord">
					<Arg name="SqlCmd" value="Cnt"/>
			 </Exec--> 	
			  					    	    
			<Exec func="PUB:MultiQuery">
				<Args>
					<Arg name="SqlCmd"  value="MultiQuery"/>
					<Arg name="RecKey"  value="DELSPACE($Actno,all)"/>
					<Arg name="RecNumPerPage"  value="20"/>
				</Args>
			</Exec> 
		 <!--If condition="INTCMP($SumCnt,5,20)"-->
			   <Set>SumCnt=$RecNum</Set>
			 <!--/If-->	   	 
	    <Set>Stsxx=我行与地税系统实时联网，您在本机成功缴税后，即可办理年审。如您需要完税凭证可  在“交费易”各自助终端补打缴税凭证，交费易咨询电话：96001。</Set>
	
 	 	<If condition="IS_EQUAL_STRING($SumCnt,0)">
			<Set>MsgTyp=E</Set>
		 <Set>RspCod=482199</Set>
		 <Set>RspMsg=此卡无交易记录!</Set>
	   <Return/>
	    </If>  	                    
	  </FlowCtrl>
 </Transaction>

<Transaction code="482148" desc="补打凭条查询">
    <Attributes>
      <Attribute name="nodatabase" value="2"/>
    </Attributes>
    <DynSentence name="MultiQuery">
      <Sentence>
        SELECT TCusID,RsFld3,TxnAmt,TckNo,CntrId,ChkTim,Rsfld2,FTxnTm from afetxnjnl WHERE ActNo='%s' and CntrId='%s' and Rsfld2='%s' and BrNo='441999' and HTxnSt='S' order by FTxnTm DESC FETCH FIRST 20 ROWS ONLY
      </Sentence>
      <Fields>Actno|Jflx|Rsfld2|</Fields>
    </DynSentence>
    <DynSentence name="Cnt">  <!--笔数-->
      <Sentence>
        SELECT Count(*) SumCnt FROM afetxnjnl where ActNo ='%s' and CntrId='%s' and Rsfld2='%s' and BrNo='441999' and HTxnSt='S'
      </Sentence>
      <Fields>Actno|Jflx|Rsfld2|</Fields>
    </DynSentence>
    <FlowCtrl>     
       <Exec func="PUB:InitTransaction"/>            <!--交易初始化,预留-->
       <!--Exec func="PUB:ReadRecord">
          <Arg name="SqlCmd" value="Cnt"/>
       </Exec--> 
                   
       <Exec func="PUB:MultiQuery">
          <Args>
            <Arg name="SqlCmd"  value="MultiQuery"/>
        <Arg name="RecKey"  value="DELSPACE($Actno,all)"/>
       <Arg name="RecNumPerPage"  value="20"/>
          </Args>
       </Exec>
     <!--If condition="INTCMP($SumCnt,5,20)"-->
         <Set>SumCnt=$RecNum</Set>
 
    <If condition="IS_EQUAL_STRING($SumCnt,0)">
			<Set>MsgTyp=E</Set>
     <Set>RspCod=482199</Set>
     <Set>RspMsg=此卡无交易记录!</Set>
     <Return/>
      </If>
    </FlowCtrl>
  </Transaction>

<!--add by yangliwen 20090105 end -->

<!--modify by yangliwen 20090206 begin -->	
	<Transaction code="482150" desc="报表打印">
		<DynSentence name="QryJnlInfo">            <!--查询天讯、彩票、保险/省电信充值成功流水信息 -->
			<Sentence>
				SELECT LogNo FROM afetxnjnl WHERE BrNo='%s' AND CAgtNo='%s' AND ActDat='%s' and HTxnSt IN ('S','T','U') order by LogNo asc
			</Sentence>
			<Fields>BrNo|CAgtNo|TxnDat|</Fields>
		</DynSentence>
		<DynSentence name="QryJnlInfo2">           <!--查询天讯、彩票、保险可疑流水信息 -->
			<Sentence>
				SELECT LogNo FROM afetxnjnl WHERE BrNo='%s' AND CAgtNo='%s' AND ActDat='%s' and HTxnSt='T' order by LogNo asc
			</Sentence>
			<Fields>BrNo|CAgtNo|TxnDat|</Fields>
		</DynSentence>
		<DynSentence name="QryJnlInfo1">            <!--查询车船税未对帐流水信息 -->
			<Sentence>
				SELECT Count(*) cnt FROM afetxnjnl WHERE BrNo='%s' AND CAgtNo='%s' AND ActDat='%s' and HTxnSt IN ('S','T','U') and HRspcd='SC0000' and ChkFlg='0' 
			</Sentence>
			<Fields>BrNo|CAgtNo|TxnDat|</Fields>
		</DynSentence>
		<DynSentence name="CCSupdatesucess">            <!--更新车船税第三方交易成功状态 -->
			<Sentence>
				UPDATE afetxnjnl SET TTxnst='S' WHERE BrNo='%s' AND CAgtNo='%s' AND ActDat='%s' and ThdChk='1'
			</Sentence>
			<Fields>BrNo|CAgtNo|TxnDat|</Fields>
		</DynSentence>
		<DynSentence name="CCSupdatefail">            <!--更新车船税第三方交易失败状态 -->
			<Sentence>
				UPDATE afetxnjnl SET TTxnst='F',ThdChk='1' WHERE BrNo='%s' AND CAgtNo='%s' AND ActDat='%s' and ThdChk='0'
			</Sentence>
			<Fields>BrNo|CAgtNo|TxnDat|</Fields>
		</DynSentence>
		<DynSentence name="CCSsum">            <!--车船税交易失败记录数 -->
			<Sentence>
				select count(*) as sumcnt from afetxnjnl WHERE BrNo='%s' AND CAgtNo='%s' AND ActDat='%s' and ThdChk='0'
			</Sentence>
			<Fields>BrNo|CAgtNo|TxnDat|</Fields>
		</DynSentence>  
		<!--羊城通自动充值20090615 begin-->
		<DynSentence name="YCTtk">
			<Sentence>
				select logno from afetxnjnl where CAgtNo='%s' AND ActDat='%s' and ChkFlg='0' and TTXNCD='482155'
			</Sentence>
			<Fields>CAgtNo|TxnDat|</Fields>
		</DynSentence>
		<DynSentence name="YCTtkquery"> 
			<Sentence>
				select ActNo,TxnAmt,TCusNm,NodTrc,THDKEY,RsFld3,ActDat,TCUSID from afetxnjnl where CAgtNo='%s' AND ActDat='%s' and logno='%s'
			</Sentence>
			<Fields>CAgtNo|TxnDat|logno|</Fields>
		</DynSentence>
		<DynSentence name="Updatquery"> 
			<Sentence>
				update afetxnjnl set ChkFlg='1' where CAgtNo='%s' AND ActDat='%s' and logno='%s'
			</Sentence>
			<Fields>CAgtNo|TxnDat|logno|</Fields>
		</DynSentence>
		<!--20090615 end-->  
		<!--20091030 begin-->
		<DynSentence name="YTKinsert"><!--粤通卡报表-->
			<Sentence>
			insert into ytk_yct (select FTxnTm,ActDat,CAgtNo,ActNo,TCUSID,LogNo,TckNo,RsFld1,RSFLD2,TxnAmt,RsFld3,ThdChk,
			case when ThdChk='S' then 'A' else 'B' end from afetxnjnl where ActDat ='%s' and CAgtNo='%s' and HTxnSt='S' and 
			ThdChk IN ('G','F','D','E','Y','S') and HRspcd='SC0000') 
			</Sentence>
			<Fields>TxnDat|CAgtNo|</Fields>
		</DynSentence>
		<DynSentence name="YCTinsert"><!--羊城通月卡报表-->
			<Sentence>
			insert into ytk_yct (select FTxnTm,ActDat,CAgtNo,ActNo,TCUSID,LogNo,TckNo,' ',' ',TxnAmt,' ',ThdChk,
			case when ThdChk='Y' then 'A' else 'B' end from afetxnjnl where ActDat ='%s' and CAgtNo='%s' and HTxnSt='S' and 
			ThdChk IN ('Y','B') and HRspcd='SC0000') 
			</Sentence>
			<Fields>TxnDat|CAgtNo|</Fields>
		</DynSentence>
		<DynSentence name="YTK_YCTdelete"><!--粤通卡羊城通月卡报表-->
			<Sentence>
			 delete from ytk_yct where CAgtNo='%s'
			</Sentence>
			<Fields>CAgtNo|</Fields>
		</DynSentence>
		<DynSentence name="Qrysrfajnl"><!--华商学院代收学费-->
			<Sentence>
			 SELECT LogNo from srftxnjnl441 where ACTDAT='%s'
			</Sentence>
			<Fields>TxnDat|</Fields>
		</DynSentence>
		<FlowCtrl> 
		<!--20091030 end-->
		
		<Exec func="PUB:InitTransaction"/>
		
		<If condition="AND(IS_NOEQUAL_STRING($CAgtNo,4410000577),IS_NOEQUAL_STRING($CAgtNo,4410000960),IS_NOEQUAL_STRING($CAgtNo,4410001099),IS_NOEQUAL_STRING($CAgtNo,4410006737),IS_NOEQUAL_STRING($CAgtNo,4410008481))">            <!--彩票/车船税/华商学费业务除外-->
			<Exec func="PUB:ReadRecord">  <!--查询 -->
				<Arg name="SqlCmd" value="QryJnlInfo"/>
			</Exec>
		</If>
		<Switch expression="~RetCod">
			<Case value="-1">               
				<Set>RspCod=360002</Set>
				<Set>RspMsg=STRCAT(数据库错误!,$SqlCod)</Set>
				<Return/>
			</Case>
			<Case value="0">               
				<Break/>
			</Case>
			<Default>
				<Set>RspCod=360002</Set>
				<Set>RspMsg=数据不存在</Set>
				<Return/>
			</Default>
		</Switch>

    <If condition="$PrtFlg=1">  <!--1 成功报表-->

      <If condition="IS_EQUAL_STRING($CAgtNo,4410000577)">            <!--彩票专用报表-->
        <Set>FmtFil=/app/ics/app/lshd/etc/LSHD1_RPT_441999.XML</Set>
	  		<Set>FilNam=STRCAT(LSHD1,$TxnDat,GETDATETIME(HHMISS))</Set>	
				<Exec func="EXT:GenerateReport">
		    	<Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
					<Arg name="FmtFil" value="$FmtFil"/>
					<Arg name="CAgtNo" value="$CAgtNo"/>
					<Arg name="TxnDat" value="$TxnDat"/>
					<Arg name="PNodNo"  value="$NodNo"/>
		    	<Arg name="PTlrId"  value="$TlrId"/>
				</Exec>
				<Exec func="PUB:SendFileMessage">
					<Arg name="MsgTyp"  value="4"/>
					<Arg name="ObjNod"  value="$NodNo"/>
					<Arg name="BusTyp"  value="48"/>
					<Arg name="AplCod"  value="482150"/>
					<Arg name="FilNam"  value="$FilNam"/>
					<Arg name="Summary" value="$Summary"/>
					<Arg name="ObjTlr"  value="$TlrId"/> 
				</Exec>
	  	</If>
      <ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410001871)">            <!--体育彩票专用报表-->
        <Set>FmtFil=/app/ics/app/lshk/etc/LSHK1_RPT_441999.XML</Set>
	  		<Set>FilNam=STRCAT(LSHK01,$TxnDat,GETDATETIME(HHMISS))</Set>	
				<Exec func="EXT:GenerateReport">
		    	<Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
					<Arg name="FmtFil" value="$FmtFil"/>
					<Arg name="CAgtNo" value="$CAgtNo"/>
					<Arg name="TxnDat" value="$TxnDat"/>
					<Arg name="PNodNo"  value="$NodNo"/>
		    	<Arg name="PTlrId"  value="$TlrId"/>
				</Exec>
				<Exec func="PUB:SendFileMessage">
					<Arg name="MsgTyp"  value="4"/>
					<Arg name="ObjNod"  value="$NodNo"/>
					<Arg name="BusTyp"  value="48"/>
					<Arg name="AplCod"  value="482150"/>
					<Arg name="FilNam"  value="$FilNam"/>
					<Arg name="Summary" value="$Summary"/>
					<Arg name="ObjTlr"  value="$TlrId"/> 
				</Exec>
      </ElseIf>
		  <ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410000960)">       <!--车船税专用报表-->
			  <Exec func="PUB:ReadRecord">           <!--查询 -->
		  		<Arg name="SqlCmd" value="QryJnlInfo1"/>
			  </Exec>
			  <If condition="IS_NOEQUAL_STRING($cnt,0)">
				  <Set>DatFil1=STRCAT(ZZT_,$TxnDat,_CCS.TXT)</Set>
				  <Exec func="PUB:FtpGet" error="IGNORE">
					  <Arg name="IpAdr" value="132.97.117.13"/>
					  <Arg name="UsrNam" value="ctbpos"/>
					  <Arg name="UsrPwd" value="ctb0120pos"/>
					  <Arg name="ObjDir" value="dat"/>
					  <Arg name="ObjFil" value="$DatFil1"/>
					  <Arg name="LclDir" value="dat/opf"/>
					  <Arg name="LclFil" value="$DatFil1"/>
				  </Exec>		
				  <If condition="~RetCod!=0">
            <Set>MsgTyp=E</Set>
					  <Set>RspCod=478716</Set>
					  <Set>RspMsg=取第三方文件失败</Set>
					  <Return/>
				  </If>							
				  <Set>sFilename=STRCAT(GETENV(WORKDIR),/dat/opf/,$DatFil1)</Set>
				  <Exec func="MQ:ReadCCSUpdate" error="IGNORE">
				  	<Args>				
				    	<Arg name="sFilename" value="$sFilename"/>
				  	</Args>
			  	</Exec>					
			  	<If condition="IS_NOEQUAL_STRING($MQCODE,000000)">
			  		<Set>MsgTyp=E</Set>
			  	 <Set>RspCod=360002</Set>
			  	 <Set>RspMsg=打开文件，更新状态失败</Set>
			  	 <Return/>
			  	</If>
				<!--Exec func="PUB:ExecSql" error="IGNORE">           
					<Arg name="SqlCmd" value="CCSupdatesucess"/>
				</Exec-->
				<!--20090506 begin-->
			    <Exec func="PUB:ReadRecord" error="IGNORE">           <!--查询 -->
					  <Arg name="SqlCmd" value="CCSsum"/>
				  </Exec>
				  <If condition="IS_NOEQUAL_STRING($sumcnt,0)">
					  <Exec func="PUB:ExecSql">           
						  <Arg name="SqlCmd" value="CCSupdatefail"/>
					  </Exec>
				  </If>
				<!--20090506 end-->	
			  </If>
			  <!--车船税成功报表打印-->
			  <Set>FmtFil=etc/LSHA8_RPT_441999.XML</Set>
			  <Set>FilNam=STRCAT(LSHA08_,$TxnDat,GETDATETIME(HHMISS))</Set>	
			  <Exec func="EXT:GenerateReport">
				  <Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
				  <Arg name="FmtFil" value="$FmtFil"/>
				  <Arg name="CAgtNo" value="$CAgtNo"/>
				  <Arg name="TxnDat" value="$TxnDat"/>
				  <Arg name="PNodNo"  value="$NodNo"/>
				  <Arg name="PTlrId"  value="$TlrId"/>
			  </Exec>
			  <Exec func="PUB:SendFileMessage">
				  <Arg name="MsgTyp"  value="4"/>
				  <Arg name="ObjNod"  value="$NodNo"/>
				  <Arg name="BusTyp"  value="48"/>
				  <Arg name="AplCod"  value="482150"/>
				  <Arg name="FilNam"  value="$FilNam"/>
				  <Arg name="Summary" value="$Summary"/>
				  <Arg name="ObjTlr"  value="$TlrId"/> 
			  </Exec>
		  </ElseIf>
		  <!--银旅通成功报表打印-->	
		  <ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410000971)">       <!--银旅通专用报表-->
			  <Set>FmtFil=/app/ics/app/lshf/etc/LSHF06_RPT_441999.XML</Set>
				<Set>FilNam=STRCAT(LSHF06_,$TxnDat,GETDATETIME(HHMISS))</Set>	
				<Exec func="EXT:GenerateReport">
					<Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
					<Arg name="FmtFil" value="$FmtFil"/>
					<Arg name="CAgtNo" value="$CAgtNo"/>
					<Arg name="TxnDat" value="$TxnDat"/>
					<Arg name="PNodNo"  value="$NodNo"/>
					<Arg name="PTlrId"  value="$TlrId"/>
				</Exec>
				<Exec func="PUB:SendFileMessage">
					<Arg name="MsgTyp"  value="4"/>
					<Arg name="ObjNod"  value="$NodNo"/>
					<Arg name="BusTyp"  value="48"/>
					<Arg name="AplCod"  value="482150"/>
					<Arg name="FilNam"  value="$FilNam"/>
					<Arg name="Summary" value="$Summary"/>
					<Arg name="ObjTlr"  value="$TlrId"/> 
			  </Exec>
		  </ElseIf>
		  <ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410001099)">       <!--羊城通空中充值专用报表-->
			  <Set>FmtFil=/app/ics/app/isf/etc/ISF11_RPT_441999.XML</Set>
				<Set>FilNam=STRCAT(ISF11_,$TxnDat,GETDATETIME(HHMISS))</Set>	
				<Exec func="EXT:GenerateReport">
					<Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
					<Arg name="FmtFil" value="$FmtFil"/>
					<Arg name="CAgtNo" value="$CAgtNo"/>
					<Arg name="TxnDat" value="$TxnDat"/>
					<Arg name="PNodNo"  value="$NodNo"/>
					<Arg name="PTlrId"  value="$TlrId"/>
				</Exec>
				<Exec func="PUB:SendFileMessage">
					<Arg name="MsgTyp"  value="4"/>
					<Arg name="ObjNod"  value="$NodNo"/>
					<Arg name="BusTyp"  value="48"/>
					<Arg name="AplCod"  value="482150"/>
					<Arg name="FilNam"  value="$FilNam"/>
					<Arg name="Summary" value="$Summary"/>
					<Arg name="ObjTlr"  value="$TlrId"/> 
			  </Exec>
			  <Set>AppNm=GZ_YCTTK</Set>
			  <Exec func="PUB:CodeSwitching">
				  <Arg name="DatSrc"  value="OPFCSW"/>
				  <Arg name="SourNam" value="AppNm"/>
				  <Arg name="DestNam" value="CAgtNo"/>
				  <Arg name="TblNam"  value="GZ_AppNm"/>
			  </Exec>
			  <Set>DatFil=STRCAT(dat/fbp/,YCT,$TxnDat,TK.txt.bem)</Set> 
			  <Exec func="PUB:OpenCursor" error="IGNORE">
				  <Arg name="sql"  value="YCTtk"/>
				  <Arg name="CursorName" value="CURSOR_1"/>
			  </Exec>
			  <If condition="~RetCod!=0">
				  <Set>MsgTyp=E</Set>
				  <Set>RspCod=PFA999</Set>
				  <Set>RspMsg=打开游标出错</Set>
				  <Return/>
			  </If>
			  <While>
				  <Exec func="PUB:FetchCursor" error="IGNORE">
				  	<Arg name="CursorName" value="CURSOR_1"/>
				  </Exec>
				  <If condition="~RetCod=100">
				  	<Break/>
				  </If>
		
					<Exec func="PUB:ReadRecord" error="IGNORE">
						<Arg name="SqlCmd" value="YCTtkquery" />
					</Exec>
					<If condition="~RetCod=-1">
						<Exec func="PUB:RollbackWork" error="IGNORE" />
						<Set>MsgTyp=E</Set>
						<Set>RspCod=PFA999</Set>
						<Set>RspMsg=数据库查询失败</Set>
						<Return/>
					</If>		
					<Exec func="PUB:ExecSql" error="IGNORE">
						<Arg name="SqlCmd" value="Updatquery" />
					</Exec>	
					<Exec func="PUB:WriteFile" error="IGNORE">
						<Arg name="FileName" value="$DatFil"/>
						<Arg name="OpenMode" value="a+"/>
						<Arg name="Data"	 value="06"/>
						<Arg name="Data"	 value="$TCUSID"/> <!--羊城通卡号 -->
						<Arg name="Data"	 value="$TxnDat"/>
						<Arg name="Data"	 value="$RsFld3"/><!--交易时间 -->
						<Arg name="Data"	 value="ADDCHAR($ActNo,19, ,0)"/> <!--银行帐号 -->
						<Arg name="Data"	 value="$TxnAmt"/> <!--交易金额 -->
						<Arg name="Data"	 value="ADDCHAR($TCusNm,30, ,0)"/> <!--用户名 -->
						<Arg name="Data"	 value="ADDCHAR($NodTrc,18, ,0)"/> <!--证件号码 -->
						<Arg name="Data"	 value="$THDKEY"/> <!--流水号 -->
						<Arg name="Data"	 value="Z02011"/> <!--交易类型 -->
						<Arg name="ESCFMT"   value="\\n"/>
					</Exec>									
        </While>
			  <Set>SendFil=$DatFil</Set>
			  <Exec func="PUB:CloseCursor" error="IGNORE">
			  	<Arg name="CursorName" value="CURSOR_1"/>
			  </Exec>
		  </ElseIf>
		  <!--20091030 begin-->
		  <ElseIf condition="IS_EQUAL_STRING($CAgtNo,441XXXXXXXX)">       <!--羊城通月卡专用报表-->
			  <Exec func="PUB:ExecSql" error="IGNORE">
						<Arg name="SqlCmd" value="YTK_YCTdelete" />
				</Exec>
			  <Exec func="PUB:ExecSql" error="IGNORE">
						<Arg name="SqlCmd" value="YCTinsert" />
				</Exec>
			  <Set>FmtFil=/app/ics/app/isf/etc/SPC101_RPT_441999.XML</Set>
				<Set>FilNam=STRCAT(SPC101_,$TxnDat,GETDATETIME(HHMISS))</Set>	
				<Exec func="EXT:GenerateReport">
					<Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
					<Arg name="FmtFil" value="$FmtFil"/>
					<Arg name="CAgtNo" value="$CAgtNo"/>
					<Arg name="TxnDat" value="$TxnDat"/>
					<Arg name="PNodNo"  value="$NodNo"/>
					<Arg name="PTlrId"  value="$TlrId"/>
				</Exec>
				<Exec func="PUB:SendFileMessage">
					<Arg name="MsgTyp"  value="4"/>
					<Arg name="ObjNod"  value="$NodNo"/>
					<Arg name="BusTyp"  value="48"/>
					<Arg name="AplCod"  value="482150"/>
					<Arg name="FilNam"  value="$FilNam"/>
					<Arg name="Summary" value="$Summary"/>
					<Arg name="ObjTlr"  value="$TlrId"/> 
			  </Exec>
		  </ElseIf>
		  <ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410001273)">       <!--粤通卡专用报表-->
			  <Exec func="PUB:ExecSql" error="IGNORE">
						<Arg name="SqlCmd" value="YTK_YCTdelete" />
				</Exec>
			  <Exec func="PUB:ExecSql" error="IGNORE">
						<Arg name="SqlCmd" value="YTKinsert" />
				</Exec>
			  <Set>FmtFil=/app/ics/app/lshj/etc/LSHJ01_RPT_441999.XML</Set>
				<Set>FilNam=STRCAT(LSHJ01_,$TxnDat,GETDATETIME(HHMISS))</Set>	
				<Exec func="EXT:GenerateReport">
					<Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
					<Arg name="FmtFil" value="$FmtFil"/>
					<Arg name="CAgtNo" value="$CAgtNo"/>
					<Arg name="TxnDat" value="$TxnDat"/>
					<Arg name="PNodNo"  value="$NodNo"/>
					<Arg name="PTlrId"  value="$TlrId"/>
				</Exec>
				<Exec func="PUB:SendFileMessage">
					<Arg name="MsgTyp"  value="4"/>
					<Arg name="ObjNod"  value="$NodNo"/>
					<Arg name="BusTyp"  value="48"/>
					<Arg name="AplCod"  value="482150"/>
					<Arg name="FilNam"  value="$FilNam"/>
					<Arg name="Summary" value="$Summary"/>
					<Arg name="ObjTlr"  value="$TlrId"/> 
			  </Exec>
		  </ElseIf>
		  <!--20091030 end-->
		  
		  <!--20100605 移动直连 begin-->	  
		  <ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410001540)">       <!--移动充值成功报表打印-->
		    <!--20111121 取移动返回对帐文件-->
				<Set>ClrDat=CALCDATE($TxnDat,-,d,1)</Set>
				<!--Set>DatFil1=STRCAT(AIRJT,$ClrDat,.1.001.BALANCE)</Set-->		
				<Set>DatFil1=STRCAT(AIRJT,$TxnDat,.1.001.RESULT)</Set>
				<Exec func="PUB:FtpGet" error="IGNORE">
					<Arg name="IpAdr" value="130.22.4.56"/>
					<Arg name="UsrNam" value="gdmobile"/>
					<Arg name="UsrPwd" value="gdmobile"/>
					<Arg name="ObjDir" value="recv"/>
					<Arg name="ObjFil" value="$DatFil1"/>
					<Arg name="LclDir" value="dat/opf"/>
					<Arg name="LclFil" value="$DatFil1"/>
				</Exec>		
				<If condition="~RetCod!=0">
					<Set>RspCod=478716</Set>
					<Set>RspMsg=取第三方文件失败</Set>
					<Return/>
				</If>	
				<Set>sFilename=STRCAT(GETENV(WORKDIR),/dat/opf/,$DatFil1)</Set>
				<Exec func="YDCZ:YDCZdz" error="IGNORE">
					<Args>				
					  <Arg name="sFilename" value="$sFilename"/>
					</Args>
				</Exec>					
				<If condition="IS_NOEQUAL_STRING($MQCODE,000000)">
				  <Set>RspCod=360002</Set>
				  <Set>RspMsg=打开文件，更新状态失败</Set>
				  <Return/>
				</If>
			  <Set>FmtFil=/app/ics/app/lshe/etc/LSHE01_RPT_441999.XML</Set>
				<Set>FilNam=STRCAT(LSHE01_,$TxnDat,GETDATETIME(HHMISS))</Set>	
				<Exec func="EXT:GenerateReport">
					<Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
					<Arg name="FmtFil" value="$FmtFil"/>
					<Arg name="CAgtNo" value="$CAgtNo"/>
					<Arg name="TxnDat" value="$TxnDat"/>
					<Arg name="PNodNo"  value="$NodNo"/>
					<Arg name="PTlrId"  value="$TlrId"/>
				</Exec>
				<Exec func="PUB:SendFileMessage">
					<Arg name="MsgTyp"  value="4"/>
					<Arg name="ObjNod"  value="$NodNo"/>
					<Arg name="BusTyp"  value="48"/>
					<Arg name="AplCod"  value="482150"/>
					<Arg name="FilNam"  value="$FilNam"/>
					<Arg name="Summary" value="$Summary"/>
					<Arg name="ObjTlr"  value="$TlrId"/> 
			  </Exec>
		  </ElseIf>
		  <!--20100605 移动直连 end-->
		  <!--20110401 省电信充值 begin-->	
		  <ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410002327)">       <!--省电信充值成功报表打印-->
			  <Set>FmtFil=/app/ics/app/trf1/etc/TRF101_RPT_441999.XML</Set>
				<Set>FilNam=STRCAT(TRF101_,$TxnDat,GETDATETIME(HHMISS))</Set>	
				<Exec func="EXT:GenerateReport">
					<Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
					<Arg name="FmtFil" value="$FmtFil"/>
					<Arg name="CAgtNo" value="$CAgtNo"/>
					<Arg name="TxnDat" value="$TxnDat"/>
					<Arg name="PNodNo"  value="$NodNo"/>
					<Arg name="PTlrId"  value="$TlrId"/>
				</Exec>
				<Exec func="PUB:SendFileMessage">
					<Arg name="MsgTyp"  value="4"/>
					<Arg name="ObjNod"  value="$NodNo"/>
					<Arg name="BusTyp"  value="48"/>
					<Arg name="AplCod"  value="482150"/>
					<Arg name="FilNam"  value="$FilNam"/>
					<Arg name="Summary" value="$Summary"/>
					<Arg name="ObjTlr"  value="$TlrId"/> 
			  </Exec>
		  </ElseIf>
		  <!--20110401 省电信充值 end-->
		  <!--20120510 省移动划扣 begin-->	
		  <ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410005218)">       <!--省移动划扣成功报表打印-->
			  <Set>FmtFil=/app/ics/app/mob/etc/MOB01_RPT_441999.XML</Set>
				<Set>FilNam=STRCAT(MOB01_,$TxnDat,GETDATETIME(HHMISS))</Set>	
				<Exec func="EXT:GenerateReport">
					<Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
					<Arg name="FmtFil" value="$FmtFil"/>
					<Arg name="CAgtNo" value="$CAgtNo"/>
					<Arg name="TxnDat" value="$TxnDat"/>
					<Arg name="PNodNo"  value="$NodNo"/>
					<Arg name="PTlrId"  value="$TlrId"/>
				</Exec>
				<Exec func="PUB:SendFileMessage">
					<Arg name="MsgTyp"  value="4"/>
					<Arg name="ObjNod"  value="$NodNo"/>
					<Arg name="BusTyp"  value="48"/>
					<Arg name="AplCod"  value="482150"/>
					<Arg name="FilNam"  value="$FilNam"/>
					<Arg name="Summary" value="$Summary"/>
					<Arg name="ObjTlr"  value="$TlrId"/> 
			  </Exec>
		  </ElseIf>
		  <!--20120510 省移动划扣 end-->	
		  <ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410001344)">       <!--羊城通自助充值 TODO测试环境单位编号替换-->
        <Set>FmtFil=/app/ics/app/ycta/etc/RPT_YCTA_441999.XML</Set>
        <Set>FilNam=STRCAT(YCTA01,$TxnDat,GETDATETIME(HHMISS))</Set>  
        <Exec func="EXT:GenerateReport">
          <Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
          <Arg name="FmtFil" value="$FmtFil"/>
          <Arg name="CAgtNo" value="$CAgtNo"/>
          <Arg name="TxnDat" value="$TxnDat"/>
          <Arg name="PNodNo"  value="$NodNo"/>
          <Arg name="PTlrId"  value="$TlrId"/>
        </Exec>
        <Exec func="PUB:SendFileMessage">
          <Arg name="MsgTyp"  value="4"/>
          <Arg name="ObjNod"  value="$NodNo"/>
          <Arg name="BusTyp"  value="48"/>
          <Arg name="AplCod"  value="482150"/>
          <Arg name="FilNam"  value="$FilNam"/>
          <Arg name="Summary" value="$Summary"/>
          <Arg name="ObjTlr"  value="$TlrId"/> 
        </Exec>

		  </ElseIf>
		  <!--20130328 大学城一卡通扣款 begin-->	
		  <ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410006737)">       <!--大学城一卡通扣款成功报表打印-->
			  <Set>FmtFil=/app/ics/app/icca/etc/ICCA01_RPT_441999.XML</Set>
				<Set>FilNam=STRCAT(ICCA01_,$TxnDat,GETDATETIME(HHMISS))</Set>	
				<Exec func="EXT:GenerateReport">
					<Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
					<Arg name="FmtFil" value="$FmtFil"/>
					<Arg name="CAgtNo" value="$CAgtNo"/>
					<Arg name="TxnDat" value="$TxnDat"/>
					<Arg name="PNodNo"  value="$NodNo"/>
					<Arg name="PTlrId"  value="$TlrId"/>
				</Exec>
				<Exec func="PUB:SendFileMessage">
					<Arg name="MsgTyp"  value="4"/>
					<Arg name="ObjNod"  value="$NodNo"/>
					<Arg name="BusTyp"  value="48"/>
					<Arg name="AplCod"  value="482150"/>
					<Arg name="FilNam"  value="$FilNam"/>
					<Arg name="Summary" value="$Summary"/>
					<Arg name="ObjTlr"  value="$TlrId"/> 
			  </Exec>
		  </ElseIf>
		  <!--20130328 大学城一卡通扣款 end-->
		  <!--20131120 华商学院代收学费 begin-->
		  <ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410008481)">       <!--华商学院代收学费成功报表打印-->
		  	<Exec func="PUB:ReadRecord">  <!--查询 -->
			  	<Arg name="SqlCmd" value="Qrysrfajnl"/>
			  </Exec>
			  <Switch expression="~RetCod">
		    	<Case value="-1">               
		    		<Set>RspCod=360002</Set>
		    		<Set>RspMsg=STRCAT(数据库错误!,$SqlCod)</Set>
		    		<Return/>
		    	</Case>
		    	<Case value="0">               
		    		<Break/>
		    	</Case>
		    	<Default>
		    		<Set>RspCod=360002</Set>
		    		<Set>RspMsg=数据不存在</Set>
		    		<Return/>
		    	</Default>
		    </Switch>
			  <Set>FmtFil=/app/ics/app/srfa/etc/SRFA01_RPT_441999.XML</Set>
				<Set>FilNam=STRCAT(SRFA01_,$TxnDat,GETDATETIME(HHMISS))</Set>	
				<Exec func="EXT:GenerateReport">
					<Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
					<Arg name="FmtFil" value="$FmtFil"/>
					<Arg name="CAgtNo" value="$CAgtNo"/>
					<Arg name="TxnDat" value="$TxnDat"/>
					<Arg name="PNodNo"  value="$NodNo"/>
					<Arg name="PTlrId"  value="$TlrId"/>
				</Exec>
				<Exec func="PUB:SendFileMessage">
					<Arg name="MsgTyp"  value="4"/>
					<Arg name="ObjNod"  value="$NodNo"/>
					<Arg name="BusTyp"  value="48"/>
					<Arg name="AplCod"  value="482150"/>
					<Arg name="FilNam"  value="$FilNam"/>
					<Arg name="Summary" value="$Summary"/>
					<Arg name="ObjTlr"  value="$TlrId"/> 
			  </Exec>
		  </ElseIf>
		  <!--20131120 华商学院代收学费 end-->
		  <Else>	                                                       <!-- 天讯、保险业务 -->
    		<Set>FmtFil=etc/LSHA1_RPT_441999.XML</Set>
	  		<Set>FilNam=STRCAT(LSHA01,$TxnDat,GETDATETIME(HHMISS))</Set>	
				<Exec func="EXT:GenerateReport">
		    	<Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
					<Arg name="FmtFil" value="$FmtFil"/>
					<Arg name="CAgtNo" value="$CAgtNo"/>
					<Arg name="TxnDat" value="$TxnDat"/>
					<Arg name="PNodNo"  value="$NodNo"/>
		    	<Arg name="PTlrId"  value="$TlrId"/>
				</Exec>
				<Exec func="PUB:SendFileMessage">
					<Arg name="MsgTyp"  value="4"/>
					<Arg name="ObjNod"  value="$NodNo"/>
					<Arg name="BusTyp"  value="48"/>
					<Arg name="AplCod"  value="482150"/>
					<Arg name="FilNam"  value="$FilNam"/>
					<Arg name="Summary" value="$Summary"/>
					<Arg name="ObjTlr"  value="$TlrId"/> 
				</Exec>    
		  </Else>
		</If>
		<ElseIf condition="$PrtFlg=2">  <!--2 可疑交易报表-->
		  <!--车船税、银旅通、移动充值无可疑报表-->
			<If condition="OR(IS_EQUAL_STRING($CAgtNo,4410000971),IS_EQUAL_STRING($CAgtNo,4410000960),IS_EQUAL_STRING($CAgtNo,4410001540),IS_EQUAL_STRING($CAgtNo,4410005218),IS_EQUAL_STRING($CAgtNo,4410001344))">
				<Set>MsgTyp=E</Set>
			  <Set>RspCod=470728</Set>
	 	    <Set>RspMsg=该业务无此报表</Set>
				<Return/>
			</If>
			<!--20131120 华商学院代收学费 begin-->
			<If condition="IS_EQUAL_STRING($CAgtNo,4410008481)">
				<Set>MsgTyp=E</Set>
			  <Set>RspCod=470728</Set>
	 	    <Set>RspMsg=该业务无此报表</Set>
				<Return/>
			</If>
			<!--20131120 华商学院代收学费 end-->
			<!--福利彩票专用可疑报表-->
			<If condition="IS_EQUAL_STRING($CAgtNo,4410000577)">
		  	<Set>FmtFil=/app/ics/app/lshd/etc/LSHD2_RPT_441999.XML</Set>
	      <Set>FilNam=STRCAT(LSHD2,$TxnDat,GETDATETIME(HHMISS))</Set>	
		    <Exec func="EXT:GenerateReport">
		     	<Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
		  		<Arg name="FmtFil" value="$FmtFil"/>
		  		<Arg name="CAgtNo" value="$CAgtNo"/>
		  		<Arg name="TxnDat" value="$TxnDat"/>
		  		<Arg name="PNodNo"  value="$NodNo"/>
		      <Arg name="PTlrId"  value="$TlrId"/>
		  	</Exec>
		  	<Exec func="PUB:SendFileMessage">
		  		<Arg name="MsgTyp"  value="4"/>
		  		<Arg name="ObjNod"  value="$NodNo"/>
		  		<Arg name="BusTyp"  value="48"/>
		  		<Arg name="AplCod"  value="482150"/>
		  		<Arg name="FilNam"  value="$FilNam"/>
		  		<Arg name="Summary" value="$Summary"/>
		  		<Arg name="ObjTlr"  value="$TlrId"/> 
		  	</Exec> 
			</If>
			<!--天讯及其他业务可疑报表-->
			<Else>		
		  	<Set>FmtFil=etc/LSHA5_RPT_441999.XML</Set>
	      <Set>FilNam=STRCAT(LSHA05,$TxnDat,GETDATETIME(HHMISS))</Set>	
		    <Exec func="EXT:GenerateReport">
		     	<Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
		  		<Arg name="FmtFil" value="$FmtFil"/>
		  		<Arg name="CAgtNo" value="$CAgtNo"/>
		  		<Arg name="TxnDat" value="$TxnDat"/>
		  		<Arg name="PNodNo"  value="$NodNo"/>
		      <Arg name="PTlrId"  value="$TlrId"/>
		  	</Exec>
		  	<Exec func="PUB:SendFileMessage">
		  		<Arg name="MsgTyp"  value="4"/>
		  		<Arg name="ObjNod"  value="$NodNo"/>
		  		<Arg name="BusTyp"  value="48"/>
		  		<Arg name="AplCod"  value="482150"/>
		  		<Arg name="FilNam"  value="$FilNam"/>
		  		<Arg name="Summary" value="$Summary"/>
		  		<Arg name="ObjTlr"  value="$TlrId"/> 
		  	</Exec> 
		  </Else>
		</ElseIf>
		<!--车船税失败报表和移动调帐报表-->	
		<ElseIf condition="$PrtFlg=3">
			<If condition="IS_EQUAL_STRING($CAgtNo,4410001540)">       <!--移动调账报表-->
				<!--20110408 取移动返回调帐文件-->
				<Set>ClrDat=CALCDATE($TxnDat,-,d,1)</Set>
				<!--Set>DatFil1=STRCAT(AIRJT,$ClrDat,.1.001.BALANCE)</Set-->
				<Set>DatFil1=STRCAT(AIRJT,$TxnDat,.1.001.BALANCE)</Set>
				<Exec func="PUB:FtpGet" error="IGNORE">
					<Arg name="IpAdr" value="130.22.4.56"/>
					<Arg name="UsrNam" value="gdmobile"/>
					<Arg name="UsrPwd" value="gdmobile"/>
					<Arg name="ObjDir" value="recv"/>
					<Arg name="ObjFil" value="$DatFil1"/>
					<Arg name="LclDir" value="dat/opf"/>
					<Arg name="LclFil" value="$DatFil1"/>
				</Exec>		
				<If condition="~RetCod!=0">
					<Set>RspCod=478716</Set>
					<Set>RspMsg=取第三方文件失败</Set>
					<Return/>
				</If>	
				<Set>sFilename=STRCAT(GETENV(WORKDIR),/dat/opf/,$DatFil1)</Set>
				<Exec func="YDCZ:YDCZtz" error="IGNORE">
					<Args>				
				   	 <Arg name="sFilename" value="$sFilename"/>
					</Args>
				</Exec>					
				<If condition="IS_NOEQUAL_STRING($MQCODE,000000)">
				 <Set>RspCod=360002</Set>
				 <Set>RspMsg=打开文件，更新状态失败</Set>
				 <Return/>
				</If>
				<Set>FmtFil=/app/ics/app/lshe/etc/LSHE02_RPT_441999.XML</Set>
				<Set>FilNam=STRCAT(LSHE02_,$TxnDat,GETDATETIME(HHMISS))</Set>	
				<Exec func="EXT:GenerateReport">
					<Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
					<Arg name="FmtFil" value="$FmtFil"/>
					<Arg name="CAgtNo" value="$CAgtNo"/>
					<Arg name="TxnDat" value="$TxnDat"/>
					<Arg name="PNodNo"  value="$NodNo"/>
					<Arg name="PTlrId"  value="$TlrId"/>
				</Exec>
				<Exec func="PUB:SendFileMessage">
					<Arg name="MsgTyp"  value="4"/>
					<Arg name="ObjNod"  value="$NodNo"/>
					<Arg name="BusTyp"  value="48"/>
					<Arg name="AplCod"  value="482150"/>
					<Arg name="FilNam"  value="$FilNam"/>
					<Arg name="Summary" value="$Summary"/>
					<Arg name="ObjTlr"  value="$TlrId"/> 
				</Exec>
			</If>
		  <!--车船税失败报表-->
			<ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410000960)">	
				<Set>FmtFil=etc/LSHA10_RPT_441999.XML</Set>
				<Set>FilNam=STRCAT(LSHA10_,$TxnDat,GETDATETIME(HHMISS))</Set>	
				<Exec func="EXT:GenerateReport">
					<Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
					<Arg name="FmtFil" value="$FmtFil"/>
					<Arg name="CAgtNo" value="$CAgtNo"/>
					<Arg name="TxnDat" value="$TxnDat"/>
					<Arg name="PNodNo"  value="$NodNo"/>
					<Arg name="PTlrId"  value="$TlrId"/>
				</Exec>
				<Exec func="PUB:SendFileMessage">
					<Arg name="MsgTyp"  value="4"/>
					<Arg name="ObjNod"  value="$NodNo"/>
					<Arg name="BusTyp"  value="48"/>
					<Arg name="AplCod"  value="482150"/>
					<Arg name="FilNam"  value="$FilNam"/>
					<Arg name="Summary" value="$Summary"/>
					<Arg name="ObjTlr"  value="$TlrId"/> 
				</Exec>
			</ElseIf>
			<Else>
		  	<Set>MsgTyp=E</Set>
				<Set>RspCod=470728</Set>
		    <Set>RspMsg=该业务无此报表</Set>
			  <Return/>
			</Else>  
		</ElseIf>	
		
		<!--20091030 begin-->
		<!--退款报表-->	
		<ElseIf condition="$PrtFlg=4">
		  <If condition="IS_EQUAL_STRING($CAgtNo,4410001273)">       <!--粤通卡退款报表-->
				<Set>FmtFil=/app/ics/app/lshj/etc/LSHJ02_RPT_441999.XML</Set>
				<Set>FilNam=STRCAT(LSHJ02_,$TxnDat,GETDATETIME(HHMISS))</Set>	
				<Exec func="EXT:GenerateReport">
					<Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
					<Arg name="FmtFil" value="$FmtFil"/>
					<Arg name="CAgtNo" value="$CAgtNo"/>
					<Arg name="TxnDat" value="$TxnDat"/>
					<Arg name="PNodNo"  value="$NodNo"/>
					<Arg name="PTlrId"  value="$TlrId"/>
				</Exec>
				<Exec func="PUB:SendFileMessage">
					<Arg name="MsgTyp"  value="4"/>
					<Arg name="ObjNod"  value="$NodNo"/>
					<Arg name="BusTyp"  value="48"/>
					<Arg name="AplCod"  value="482150"/>
					<Arg name="FilNam"  value="$FilNam"/>
					<Arg name="Summary" value="$Summary"/>
					<Arg name="ObjTlr"  value="$TlrId"/> 
				</Exec>
			</If>
			<ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410001871)">       <!--月票卡退款报表-->
			  <Set>FmtFil=/app/ics/app/isf/etc/SPC102_RPT_441999.XML</Set>
				<Set>FilNam=STRCAT(SPC102_,$TxnDat,GETDATETIME(HHMISS))</Set>	
				<Exec func="EXT:GenerateReport">
					<Arg name="ObjFil" value="STRCAT(GETENV(WORKDIR),/dat/term/send/,$FilNam)"/>
					<Arg name="FmtFil" value="$FmtFil"/>
					<Arg name="CAgtNo" value="$CAgtNo"/>
					<Arg name="TxnDat" value="$TxnDat"/>
					<Arg name="PNodNo"  value="$NodNo"/>
					<Arg name="PTlrId"  value="$TlrId"/>
				</Exec>
				<Exec func="PUB:SendFileMessage">
					<Arg name="MsgTyp"  value="4"/>
					<Arg name="ObjNod"  value="$NodNo"/>
					<Arg name="BusTyp"  value="48"/>
					<Arg name="AplCod"  value="482150"/>
					<Arg name="FilNam"  value="$FilNam"/>
					<Arg name="Summary" value="$Summary"/>
					<Arg name="ObjTlr"  value="$TlrId"/> 
			 </Exec>
			</ElseIf>
			<Else>
		  	<Set>MsgTyp=E</Set>
				<Set>RspCod=470728</Set>
		    <Set>RspMsg=该业务无此报表</Set>
			  <Return/>
			</Else>  
		</ElseIf>		
		<!--20091030 end-->	
		<Else>
		</Else>
			<Set>MsgTyp=N</Set>
			<Set>RspCod=000000</Set>
			<Set>RspMsg=交易成功</Set>
    </FlowCtrl>
  </Transaction>

	<Transaction code="482108" desc="移动查询话费交易">
		<FlowCtrl>
			<Exec func="PUB:GetLogNo"/>
			<If condition="INTCMP($RsFld2,3,3012)">
			<Set>Len=0174</Set>
			</If>
			<Else>
			<Set>Len=0160</Set>
			</Else>
			
			<Exec func="PUB:CallThirdOther" error="IGNORE">   <!--第三方查询-->
				<Arg name="HTxnCd" value="482108"/>
				<Arg name="ObjSvr" value="STDALSHA"/>
			</Exec>

       <!-- add by xuan begin 20140306 -->
      <If condition="INTCMP(~RetCod,1,0)">
        <Set>MsgTyp=E</Set>
        <Set>RspCod=LSH999</Set>
        <Set>RspMsg=调用第三方时:系统错误或超时或未发送,请检查后重做 </Set>
        <Return/>
      </If>
      <!-- add by xuan end 20140306 -->

			<Set>RspCod=$RspCod</Set>
		</FlowCtrl>
	</Transaction>

	<Transaction code="482110" desc="移动缴费">
		<Attributes>
			<Attribute name="integrity" value="2" code="482107" interval="5" timeout="30" maxtimes="15"/> <!--自动冲正-->
		</Attributes>
		<Attributes>
      <Attribute name="nodatabase" value="2"/>
    </Attributes>
		<DynSentence name="QryCrpAgr"><!--查询单位信息 -->
			<Sentence>
				SELECT TActNo, BBusTyp FROM savcrpagr WHERE CAgtNo='%s' AND SvrSts='1'
			</Sentence>
			<Fields>CAgtNo|</Fields>
		</DynSentence>
		<FlowCtrl>
			<Exec func="PUB:InitTransaction"/>            <!--交易初始化,预留-->
			<Exec func="PUB:ReadRecord">
				<Arg name="SqlCmd" value="QryCrpAgr"/>
			</Exec>
		
		  <!--add by xuan for sfb 20120315-->
      <If condition="OR(IS_EQUAL_STRING($TxnSrc,WE441),IS_EQUAL_STRING($TxnSrc,SF441))"><!--网上银行或者收富宝-->
        <Set>PayMod=1</Set>
      </If>
      <Else>                                                  <!--自助终端-->
        <Set>PayMod=0</Set>
      </Else>
	
			<Set>NodNo=441800</Set>
			<Set>RcvAmt=$TxnAmt</Set>
      <Set>CntrId=03</Set>
			<Set>RsFld3=$TCusNm</Set>	
			<If condition="OR(INTCMP($ActTyp,3,0),INTCMP($ActTyp,3,2),INTCMP($ActTyp,3,4))"><!--对私-->
				<Set>HTxnCd=471140</Set>
				<Set>VchChk=0</Set>
				<!--Set>PayMod=0</Set-->
				<Set>ActFlg=$ActTyp</Set>
				<Set>VchCod=00000000</Set>
			</If>
			<ElseIf condition="INTCMP($ActTyp,3,1)"><!--对公-->
				<Set>HTxnCd=451610</Set>
				<Set>ActNod=SUBSTR($TActNo,1,6)</Set>
				<Set>ActSqn=SUBSTR($TActNo,14,5)</Set>
				<Delete>TActNo</Delete>
				<Set>BusTyp=CRP51</Set>
				<Set>BusSub=01</Set>   <!--应用子码，对应业务类型CRP51-->
				<Set>ActFlg=2</Set>
			</ElseIf>
			<Else>    <!--第三方-->
				<!--
				<Set>TTxnCd=STRCAT($TTxnCd,_T)</Set>
				<Set>ThdSvr=STDDOPFP</Set>-->
				<!--他行卡暂时不做-->
				<Return/>
			</Else>
			
			<If condition="INTCMP($RsFld2,3,3002)">
			<Set>Len=0174</Set>
			</If>
			<Else>
			<Set>Len=0160</Set>
			</Else>
			
			<Set>FTxnTm=GETDATETIME()</Set>
			<Quote name="Chk_TxnSrc"/>
      <!--20090615 begin-->
			<Quote name="TxnSrc_TxnCnl"/>
      <!--20090615 end-->
 
			<Exec func="PUB:ReadModuleCfg">
				<Arg name="Application" value="GZ_TELE"/>
				<Arg name="Transaction" value="482102"/>
			</Exec>

			<Call package="AFE" function="AFE_SglBkPay"/>
			<If condition="$RspCod=000000">
				<Set>MsgTyp=N</Set>
			</If>

		</FlowCtrl>
	</Transaction>
	
	<Transaction code="482112" desc="联通缴费">
		<Attributes>
			<Attribute name="integrity" value="2" code="482107" interval="5" timeout="30" maxtimes="15"/> <!--自动冲正-->
		</Attributes>
		<Attributes>
      <Attribute name="nodatabase" value="2"/>
    </Attributes>
		<DynSentence name="QryCrpAgr"><!--查询单位信息 -->
			<Sentence>
				SELECT TActNo, BBusTyp FROM savcrpagr WHERE CAgtNo='%s' AND SvrSts='1'
			</Sentence>
			<Fields>CAgtNo|</Fields>
		</DynSentence>
		<FlowCtrl>
			<Exec func="PUB:InitTransaction"/>            <!--交易初始化,预留-->
			<Exec func="PUB:ReadRecord">
				<Arg name="SqlCmd" value="QryCrpAgr"/>
			</Exec>
		
		  <!--add by xuan for sfb 20120315-->
      <If condition="OR(IS_EQUAL_STRING($TxnSrc,WE441),IS_EQUAL_STRING($TxnSrc,SF441))"><!--网上银行或者收富宝-->
        <Set>PayMod=1</Set>
      </If>
      <Else>                                                  <!--自助终端-->
        <Set>PayMod=0</Set>
      </Else>
	
			<Set>NodNo=441800</Set>
			<Set>RcvAmt=$TxnAmt</Set>
      <Set>CntrId=02</Set>
			<Set>RsFld3=$TCusNm</Set>
			<If condition="OR(INTCMP($ActTyp,3,0),INTCMP($ActTyp,3,2),INTCMP($ActTyp,3,4))"><!--对私-->
				<Set>HTxnCd=471140</Set>
				<Set>VchChk=0</Set>
				<!--Set>PayMod=0</Set-->
				<Set>ActFlg=$ActTyp</Set>
				<Set>VchCod=00000000</Set>
			</If>
			<ElseIf condition="INTCMP($ActTyp,3,1)"><!--对公-->
				<Set>HTxnCd=451610</Set>
				<Set>ActNod=SUBSTR($TActNo,1,6)</Set>
				<Set>ActSqn=SUBSTR($TActNo,14,5)</Set>
				<Delete>TActNo</Delete>
				<Set>BusTyp=CRP51</Set>
				<Set>BusSub=01</Set>   <!--应用子码，对应业务类型CRP51-->
				<Set>ActFlg=2</Set>
			</ElseIf>
			<Else>    <!--第三方-->
				<!--
				<Set>TTxnCd=STRCAT($TTxnCd,_T)</Set>
				<Set>ThdSvr=STDDOPFP</Set>-->
				<!--他行卡暂时不做-->
				<Return/>
			</Else>
			
			<If condition="INTCMP($RsFld2,3,3002)">
			<Set>Len=0174</Set>
			</If>
			<Else>
			<Set>Len=0160</Set>
			</Else>
			
			<Set>FTxnTm=GETDATETIME()</Set>
			<Quote name="Chk_TxnSrc"/>
      <!--20090615 begin-->
			<Quote name="TxnSrc_TxnCnl"/>
      <!--20090615 end-->
 
			<Exec func="PUB:ReadModuleCfg">
				<Arg name="Application" value="GZ_TELE"/>
				<Arg name="Transaction" value="482102"/>
			</Exec>

			<Call package="AFE" function="AFE_SglBkPay"/>

			<If condition="$RspCod=000000">
				<Set>MsgTyp=N</Set>
			</If>
		</FlowCtrl>
	</Transaction>

	<Transaction code="482151" desc="自助通缴费清算">
		<DynSentence name="QryCrpAgr"><!--查询单位信息 -->
			<Sentence>
				SELECT a.TActNo,b.CrpNam,b.STLACT FROM savcrpagr a,savcrpinf b WHERE a.CAgtNo='%s'
				AND a.CrpCod=b.CrpCod AND a.BrNo=b.BrNo
			</Sentence>
			<Fields>CAgtNo|</Fields>
		</DynSentence>
		<DynSentence name="Updafetxnjnl"><!--修改信息-->
			<Sentence>
				update afetxnjnl set ChkFlg='1' WHERE ActDat ='%s' and CAgtNo='%s' and HTxnSt IN ('S','T','U') and HRspcd='SC0000' and TTxnst IN ('S','U')
			</Sentence>
			<Fields>ClrDat|CAgtNo|</Fields>
		</DynSentence>
		<!--20091030 begin-->
		<DynSentence name="UpdYCTYKafetxnjnl"><!--修改羊城通月卡信息-->
			<Sentence>
				update afetxnjnl set ChkFlg='1' WHERE ActDat ='%s' and CAgtNo='%s' and HTxnSt='S' and HRspcd='SC0000' and TXNSTS='S' and THDCHK in('Y','B','0','A','D')
			</Sentence>
			<Fields>ClrDat|CAgtNo|</Fields>
		</DynSentence>
		<DynSentence name="UpdYTKafetxnjnl"><!--修改粤通卡信息-->
			<Sentence>
				update afetxnjnl set ChkFlg='1' WHERE ActDat ='%s' and CAgtNo='%s' and HTxnSt='S' and HRspcd='SC0000' and ThdChk IN ('G','F','D','E','Y','S','0','H','B')
			</Sentence>
			<Fields>ClrDat|CAgtNo|</Fields>
		</DynSentence>
		<!--20091030 end-->
    <DynSentence name="UpdTelafetxnjnl"><!--修改电信直连信息-->
      <Sentence>
        update afetxnjnl set ChkFlg='1' where ActDat = '%s' and CAgtNo= '%s' and HTxnSt='S' and ChkFlg='0'
      </Sentence>
      <Fields>ClrDat|CAgtNo|</Fields>
    </DynSentence>
    <DynSentence name="UpdTYCPafetxnjnl"><!--修改体彩信息-->
      <Sentence>
        update afetxnjnl set ChkFlg='1' where ActDat = '%s' and CAgtNo= '%s' and HTxnSt='S' and ChkFlg='0'
      </Sentence>
      <Fields>ClrDat|CAgtNo|</Fields>
    </DynSentence>
    <DynSentence name="UpdYDCZafetxnjnl"><!--修改移动直连充值信息-->
			<Sentence>
				update afetxnjnl set ChkFlg='1' WHERE substr(ChkTim,1,8)='%s' and CAgtNo='%s' and HTxnSt IN ('S','T','U') and HRspcd='SC0000' and TTxnst='S' and ChkFlg='0'
			</Sentence>
			<Fields>ClrDat|CAgtNo|</Fields>
		</DynSentence>
    <DynSentence name="UpdYDHKafetxnjnl"><!--修改移动直连划扣信息-->
      <Sentence>
        update afetxnjnl set ChkFlg='1' where TActDt = '%s' and CAgtNo= '%s' and HTxnSt='S' and ChkFlg='0'
      </Sentence>
      <Fields>ClrDat|CAgtNo|</Fields>
    </DynSentence>
    <DynSentence name="UpdDXCiccatxnjnl"><!--修改大学城一卡通代扣信息-->
      <Sentence>
        update iccatxnjnl set ChkFlg='1' where ActDat = '%s' and CAgtNo= '%s' and HTxnSt='S' and ChkFlg='0'
      </Sentence>
      <Fields>ClrDat|CAgtNo|</Fields>
    </DynSentence>
    <DynSentence name="UpdHSUsrftxnjnl"><!--华商学院学费代收流水表-->
      <Sentence>
        update srftxnjnl441 set ChkFlg='1' where ActDat = '%s' and HTxnSt IN ('S','T','U') and HRspcd='SC0000' and ChkFlg='0'
      </Sentence>
      <Fields>ClrDat|</Fields>
    </DynSentence>
		<FlowCtrl>
			<Exec func="PUB:InitTransaction"/>            <!--交易初始化,预留-->
		  <Exec func="PUB:GetLogNo"/>
		  
		  <If condition="OR(IS_EQUAL_STRING($CAgtNo,4410000539),IS_EQUAL_STRING($CAgtNo,4410002654),IS_EQUAL_STRING($CAgtNo,4410002655),IS_EQUAL_STRING($CAgtNo,4410002656))"><!--天讯业务-->
		  	<Exec func="PUB:AddAuthReason" >
            <Arg name="AthCod" value="50" />
            <Arg name="AthMsg" value="482152" />
      	</Exec>
      	<Exec  func="PUB:CheckLocalAuth" >
            <Arg name="ObjSvr" value="SHSTPUB1" />
      	</Exec>
			</If>
			
			<If condition="IS_EQUAL_STRING($CAgtNo,4410008481)"><!--华商学院代收学费业务-->
		  	<Set>AplCls=453</Set>
		  	<Exec func="PUB:InitTransaction"/>            <!--交易初始化,预留-->
		    <Exec func="PUB:GetLogNo"/>
			</If>
			
			<Exec func="PUB:ReadRecord">
				<Arg name="SqlCmd" value="QryCrpAgr"/>
			</Exec>
			
			<Set>HTxnCd=451900</Set>
      <Set>BusTyp=PCL76</Set>
      <Set>RgCFlg=1</Set>   <!--贷方回单，不登记0，登记 1 -->
      <Set>ActBk1=441999</Set>
      <Set>ActBr1=441800</Set>
      <Set>ActSq1=SUBSTR($TActNo,14,5)</Set>
      <Set>CdFlg1=D</Set>
      <Set>OuAmt1=$TxnAmt</Set>
      <Set>PayAt5=$STLACT</Set>
      <Set>CdFlg5=C</Set>
      <Set>InAmt5=$TxnAmt</Set>
     
      <!-- 羊城通自动充值划款增加摘要内容 add by xuan 20090827 -->
      <If condition="IS_EQUAL_STRING($CAgtNo,4410001099)">
        <Set>Smr=STRCAT($ClrDat,羊城通自动充值款) </Set>
      </If>

      <Exec func="PUB:CallHostOther">
				<Arg name="HTxnCd" value="$HTxnCd"/>
				<Arg name="ObjSvr" value="SHSTPUB1"/>
			</Exec>
		
		<!--
				<Set>MsgTyp=N</Set>
			<Set>RspCod=000000</Set>
			<Set>RspMsg=交易成功</Set>
			-->
			
      <If condition="~RetCod=0">  <!--recsts 0:初始化 1:成功 2:失败 -->
      	<!--20091030 begin-->
				<If condition="IS_EQUAL_STRING($CAgtNo,441XXXXXX)"><!--羊城通月卡业务-->
      		<Exec func="PUB:ExecSql">
						<Arg name="SqlCmd" value="UpdYCTYKafetxnjnl"/>
					</Exec>
      	</If>
      	<ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410001273)">        <!--粤通卡业务-->
					<Exec func="PUB:ExecSql">
						<Arg name="SqlCmd" value="UpdYTKafetxnjnl"/>
					</Exec>
				</ElseIf>
      	<ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410001421)">        <!--电信直连业务-->
					<Exec func="PUB:ExecSql">
						<Arg name="SqlCmd" value="UpdTelafetxnjnl"/>
					</Exec>
				</ElseIf>
      	<ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410001871)">        <!--体育彩票业务-->
					<Exec func="PUB:ExecSql">
						<Arg name="SqlCmd" value="UpdTYCPafetxnjnl"/>
					</Exec>
				</ElseIf>
				<ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410001540)">        <!--移动直连充值业务-->
					<Exec func="PUB:ExecSql">
						<Arg name="SqlCmd" value="UpdYDCZafetxnjnl"/>
					</Exec>
				</ElseIf>
      	<ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410005218)">        <!--移动直连划扣业务20120510-->
					<Exec func="PUB:ExecSql">
						<Arg name="SqlCmd" value="UpdYDHKafetxnjnl"/>
					</Exec>
				</ElseIf>
      	<ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410006737)">        <!--大学城一卡通代扣业务20130328-->
					<Exec func="PUB:ExecSql">
						<Arg name="SqlCmd" value="UpdDXCiccatxnjnl"/>
					</Exec>
				</ElseIf>
				<ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410008481)">        <!--华商学院学费代收20131120-->
					<Exec func="PUB:ExecSql">
						<Arg name="SqlCmd" value="UpdHSUsrftxnjnl"/>
					</Exec>
				</ElseIf>
				
				<Else>
					<Exec func="PUB:ExecSql">
						<Arg name="SqlCmd" value="Updafetxnjnl"/>
					</Exec>
				</Else>
        <Exec func="PUB:PutResponse"/>
				<!--20091030 end--> 
				<!--20120903 begin 反洗钱接口调用-->
        <Quote name="AntiMoneylaudry"/>
        <!--20120903 end 反洗钱接口调用-->
			</If>
	
		</FlowCtrl>
	</Transaction>
	
	<Transaction code="482152" desc="自助通对可疑交易进行状态修改">
		<DynSentence name="Updafetxnjnl"><!--修改信息-->
			<Sentence>
				update afetxnjnl set HTxnSt='%s' WHERE ActDat ='%s' and CAgtNo='%s' and HTxnSt IN ('T','U') and LogNo='%s'
			</Sentence>
			<Fields>HTxnSt|TxnDat|CAgtNo|LogNo|</Fields>
		</DynSentence>
		<FlowCtrl>
		<Exec func="PUB:InitTransaction"/>            <!--交易初始化,预留-->
		
		<!--
		<Exec func="PUB:AddAuthReason" >
            <Arg name="AthCod" value="50" />
            <Arg name="AthMsg" value="482152" />
    </Exec>
    <Exec  func="PUB:CheckLocalAuth" >
            <Arg name="ObjSvr" value="SHSTPUB1" />
    </Exec>
    -->
    <If condition="$HTxnSt=S">
        <Set>HtNam=成功</Set>
    </If>
    <Else>
       <Set>HtNam=失败</Set>
    </Else> 
         
		<Exec func="PUB:ExecSql">
            <Arg name="SqlCmd" value="Updafetxnjnl"/>
    </Exec>	
             
		
		</FlowCtrl>
	</Transaction>
	
	<Transaction code="482153" desc="自助通对可疑交易进行状态查询">
		<DynSentence name="QryCrpAgr"><!--查询信息-->
			<Sentence>
				select ActNo,TCUSNM,TCUSID,TxnAmt from afetxnjnl WHERE ActDat ='%s' and CAgtNo='%s'  and LogNo='%s' and HTxnSt IN ('T','U') and ChkFlg='0'
			</Sentence>
			<Fields>TxnDat|CAgtNo|LogNo|</Fields>
		</DynSentence>
		<FlowCtrl>
		<Exec func="PUB:InitTransaction"/>            <!--交易初始化,预留-->
		<Exec func="PUB:ReadRecord">
				<Arg name="SqlCmd" value="QryCrpAgr"/>
		</Exec>
		
		</FlowCtrl>
	</Transaction>
	
	<Transaction code="482154" desc="自助通查询清算金额">
		<DynSentence name="QryCrpAgr"><!--天讯缴费/银旅通/省电信充值业务信息-->
			<Sentence>
				select sum(cast(TxnAmt as bigint)) as SumAmt,coalesce(COUNT(*),0) TotCnt from afetxnjnl where ActDat = '%s' and CAgtNo= '%s' and HTxnSt IN ('S','T','U') and HRspcd='SC0000' and  TTxnst IN ('S','U') and ChkFlg='0'
			</Sentence>
			<Fields>TxnDat|CAgtNo|</Fields>
		</DynSentence>
		<DynSentence name="QryLotAgr"><!--查询彩票清算信息-->
			<Sentence>
				select sum(cast(TxnAmt as bigint)) as SumAmt,coalesce(COUNT(*),0) TotCnt from lshdjnl441 where substr(TraTim,1,8)='%s' and status='0'
			</Sentence>
			<Fields>TxnDat|</Fields>
		</DynSentence>
		<DynSentence name="QryCCSAgr"><!--查询车船税清算信息-->
			<Sentence>
				select sum(cast(TxnAmt as bigint)) as SumAmt,coalesce(COUNT(*),0) TotCnt from afetxnjnl where ActDat = '%s' and CAgtNo= '%s' and HTxnSt='S' and ThdChk='1' and ChkFlg='0' and  TTxnst='S' and HRspcd='SC0000'
			</Sentence>
			<Fields>TxnDat|CAgtNo|</Fields>
		</DynSentence>
		<!--20091030 begin-->
		<DynSentence name="QryYCTYKAgr"><!--查询羊城通月卡清算信息-->
			<Sentence>
				select sum(cast(TxnAmt as bigint)) as SumAmt,coalesce(COUNT(*),0) TotCnt from afetxnjnl where ActDat = '%s' and CAgtNo= '%s' and HTxnSt='S' and HRspcd='SC0000' and TXNSTS='S' and THDCHK in('Y','B') and ChkFlg='0'
			</Sentence>
			<Fields>TxnDat|CAgtNo|</Fields>
		</DynSentence>
		<DynSentence name="QryYTKAgr"><!--查询粤通卡清算信息-->
			<Sentence>
				select sum(cast(TxnAmt as bigint)) as SumAmt,coalesce(COUNT(*),0) TotCnt from afetxnjnl where ActDat = '%s' and CAgtNo= '%s' and HTxnSt='S' and HRspcd='SC0000' and ThdChk IN ('G','F','D','E','Y','S') and ChkFlg='0'
			</Sentence>
			<Fields>TxnDat|CAgtNo|</Fields>
		</DynSentence>
		<!--20091030 end-->
    <DynSentence name="QryTelAgr"><!--查询电信直连清算信息-->
      <Sentence>
        select sum(cast(TxnAmt as bigint)) as SumAmt,coalesce(COUNT(*),0) TotCnt from afetxnjnl where ActDat
= '%s' and CAgtNo= '%s' and HTxnSt='S' and ChkFlg='0'
      </Sentence>
      <Fields>TxnDat|CAgtNo|</Fields>
    </DynSentence>
    <DynSentence name="QryTYCPAgr"><!--查询手机体彩清算信息-->
      <Sentence>
        select sum(cast(TxnAmt as bigint)) as SumAmt,coalesce(COUNT(*),0) TotCnt from afetxnjnl where ActDat= '%s' and CAgtNo= '%s' and HTxnSt='S' and ChkFlg='0'
      </Sentence>
      <Fields>TxnDat|CAgtNo|</Fields>
    </DynSentence>		
    <DynSentence name="QryYDCZPAgr"><!--查询移动直连充值信息-->
      <Sentence>
        select sum(cast(TxnAmt as bigint)) as SumAmt,coalesce(COUNT(*),0) TotCnt from afetxnjnl where substr(ChkTim,1,8)='%s' and CAgtNo= '%s' and HTxnSt IN ('S','T','U') and HRspcd='SC0000' and TTxnst='S' and ChkFlg='0'
      </Sentence>
      <Fields>TxnDat|CAgtNo|</Fields>
    </DynSentence>
    <DynSentence name="QryYDHKAgr"><!--查询移动直连划扣信息-->
      <Sentence>
        select sum(cast(TxnAmt as bigint)) as SumAmt,coalesce(COUNT(*),0) TotCnt from afetxnjnl where TActDt= '%s' and CAgtNo= '%s' and HTxnSt='S' and ChkFlg='0'
      </Sentence>
      <Fields>TxnDat|CAgtNo|</Fields>
    </DynSentence>
    <DynSentence name="QryDXCAgr"><!--查询大学城一卡通代扣信息-->
      <Sentence>
        select sum(cast(TxnAmt as bigint)) as SumAmt,coalesce(COUNT(*),0) TotCnt from iccatxnjnl where ActDat= '%s' and CAgtNo= '%s' and HTxnSt='S' and ChkFlg='0'
      </Sentence>
      <Fields>TxnDat|CAgtNo|</Fields>
    </DynSentence>
    <DynSentence name="Seltsrfajnl"><!--华商学院学费代收20131120-->
      <Sentence>
        select sum(cast(TxnAmt as bigint)) as SumAmt,coalesce(COUNT(*),0) TotCnt from srftxnjnl441 where ActDat= '%s' and HTxnSt IN ('S','T','U') and ChkFlg='0'
      </Sentence>
      <Fields>TxnDat|CAgtNo|</Fields>
    </DynSentence>
		<FlowCtrl>
		<Exec func="PUB:InitTransaction"/>            <!--交易初始化,预留-->
		
		<If condition="IS_EQUAL_STRING($CAgtNo,4410000577)">            <!--彩票专用清算-->
			<Exec func="PUB:ReadRecord">
				<Arg name="SqlCmd" value="QryLotAgr"/>
			</Exec>
		</If>		
		<ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410000960)">        <!--车船税专用清算-->
			<Set>DatFil1=STRCAT(GETENV(WORKDIR),/dat/opf/,ZZT_,$TxnDat,_CCS.TXT)</Set>
    	<Exec func="PUB:IsExistFile" error="IGNORE">
				<Arg name="FileName" value="$DatFil1"/>
			</Exec>
			<If condition="~RetCod!=0">
				<Set>RspCod=360002</Set>
				<Set>MsgTyp=E</Set>
				<Set>RspMsg=请先打印报表</Set>
				<Return/>
			</If>	
			<Exec func="PUB:ReadRecord">
				<Arg name="SqlCmd" value="QryCCSAgr"/>
			</Exec>
			
			<!--车船税对帐文件20090511 begin-->
			<Set>FilNam=STRCAT(ZZT_,$TxnDat,_CCS.TXT)</Set>
			<Exec func="PUB:FtpPut">
				<Arg name="IpAdr" value="132.97.117.13"/>
				<Arg name="UsrNam" value="jth"/>
				<Arg name="UsrPwd" value="jth"/>
				<Arg name="ObjDir" value="/"/>
				<Arg name="ObjFil" value="$FilNam"/>
				<Arg name="LclDir" value="dat/opf"/>
				<Arg name="LclFil" value="$FilNam"/>
			</Exec>
			<If condition="~RetCod!=0">
				<Set>MsgTyp=E</Set>
				<Set>RspCod=MF0992</Set>
				<Set>RspMsg=指定路径下的文件未找到</Set>
				<Return/>
			</If>
			<!--20090511 end-->	

		</ElseIf>
		<!--20091030 begin-->
		<ElseIf condition="IS_EQUAL_STRING($CAgtNo,441XXXXXXXX)">        <!--羊城通月卡专用清算-->
			<Exec func="PUB:ReadRecord">
				<Arg name="SqlCmd" value="QryYCTYKAgr"/>
			</Exec>
		</ElseIf>
    <!--电信直连专用清算-->
    <ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410001421)">
      <Exec func="PUB:ReadRecord">
        <Arg name="SqlCmd" value="QryTelAgr"/>
      </Exec>
    </ElseIf>
		<ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410001273)">        <!--粤通卡专用清算-->
			<Exec func="PUB:ReadRecord">
				<Arg name="SqlCmd" value="QryYTKAgr"/>
			</Exec>
		</ElseIf>	
		<!--20091030 end-->
    <ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410001871)">        <!--手机购体彩专用清算-->
      <Exec func="PUB:ReadRecord">
        <Arg name="SqlCmd" value="QryTYCPAgr"/>
      </Exec>
    </ElseIf>	
    <ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410001540)">        <!--移动直连充值清算-->
      <Exec func="PUB:ReadRecord">
        <Arg name="SqlCmd" value="QryYDCZPAgr"/>
      </Exec>
    </ElseIf>
    <ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410005218)">        <!--移动直连划扣清算20120510-->
      <Exec func="PUB:ReadRecord">
        <Arg name="SqlCmd" value="QryYDHKAgr"/>
      </Exec>
    </ElseIf>
    <ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410006737)">        <!--大学城一卡通代扣清算20130328-->
      <Exec func="PUB:ReadRecord">
        <Arg name="SqlCmd" value="QryDXCAgr"/>
      </Exec>
    </ElseIf>
    <ElseIf condition="IS_EQUAL_STRING($CAgtNo,4410008481)">        <!--华商学院学费代收20131120-->
      <If condition="IS_EQUAL_STRING($CAgtNo,4410008481)"><!--华商学院代收学费业务-->
		  	<Set>AplCls=453</Set>
		  	<Exec func="PUB:InitTransaction"/>            <!--交易初始化,预留-->
			</If>
      <Exec func="PUB:ReadRecord">
        <Arg name="SqlCmd" value="Seltsrfajnl"/>
      </Exec>
    </ElseIf>
		<Else>
			<Exec func="PUB:ReadRecord">                        <!--天讯其他业务清算-->
				<Arg name="SqlCmd" value="QryCrpAgr"/>
			</Exec>
		</Else>
			
		<If condition="$TotCnt=0">
				<Set>MsgTyp=E</Set>
        <Set>RspCod=331012</Set>
        <Set>RspMsg=没有清算数据</Set>
        <Return/>
    </If>
		</FlowCtrl>
	</Transaction>

	<Transaction code="482160" desc="保险缴费">
		<Attributes>
			<Attribute name="integrity" value="2" code="482161" interval="5" timeout="30" maxtimes="15"/> <!--自动冲正-->
		</Attributes>
		<Attributes>
      <Attribute name="nodatabase" value="2"/>
    </Attributes>
		<DynSentence name="QryCrpAgr"><!--查询单位信息 -->
			<Sentence>
				SELECT TActNo, BBusTyp FROM savcrpagr WHERE CAgtNo='%s' AND SvrSts='1'
			</Sentence>
			<Fields>CAgtNo|</Fields>
		</DynSentence>
		<FlowCtrl>
			<Exec func="PUB:InitTransaction"/>            <!--交易初始化,预留-->
			<Exec func="PUB:ReadRecord">
				<Arg name="SqlCmd" value="QryCrpAgr"/>
			</Exec>
			
			<Set>NodNo=441800</Set>
			<Set>RcvAmt=$TxnAmt</Set>
			<If condition="OR(INTCMP($ActTyp,3,2),INTCMP($ActTyp,3,4))"><!--对私-->
				<Set>HTxnCd=471140</Set>
				<Set>VchChk=0</Set>
				<Set>PayMod=1</Set>
				<Set>ActFlg=$ActTyp</Set>
				<Set>VchCod=00000000</Set>
			</If>
			<Else>
				<Set>MsgTyp=E</Set>
			  <Set>RspCod=482199</Set>
        <Set>RspMsg=帐户类型错</Set>
				<Return/>
			</Else>
			
			<Set>FTxnTm=GETDATETIME()</Set>
			<Quote name="Chk_TxnSrc"/>
      
			<Exec func="PUB:ReadModuleCfg">
				<Arg name="Application" value="$AppNm"/>
				<Arg name="Transaction" value="482102"/>
			</Exec>
			<Call package="AFE" function="AFE_SglBkPay"/>
			<If condition="$RspCod=000000">
				<Set>MsgTyp=N</Set>
			</If>
		</FlowCtrl>
	</Transaction>

 <Transaction code="482161" desc="保险费缴费冲正">
   <FlowCtrl>
			<Exec func="PUB:InitTransaction"/>
			<Quote name="Chk_TxnSrc"/>
			
			<Exec func="PUB:ReadModuleCfg">
				<Arg name="Application" value="GZ_INSU1"/>
				<Arg name="Transaction" value="482107"/>
			</Exec>
			<Call package="AFE" function="AFE_BkCancel"/>
			<If condition="$RspCod=000000">
				<Set>MsgTyp=N</Set>
			</If>
		</FlowCtrl>
	</Transaction>

	<Transaction code="482106" desc="广州银信通协议同步">
		<DynSentence name="MultiQuery0">
			<Sentence>
			SELECT * FROM sfmcusagra WHERE ActDat='%s'
			</Sentence>
			<Fields>CrtDat|</Fields>
		</DynSentence>
		<DynSentence name="MultiQuery1">
			<Sentence>
			SELECT * FROM sfmcusagra WHERE MobTel='%s'
			</Sentence>
			<Fields>MobTel|</Fields>
		</DynSentence>
		<DynSentence name="MultiQuery2">
			<Sentence>
			SELECT * FROM sfmcusagra WHERE CusId='%s'
			</Sentence>
			<Fields>CusId|</Fields>
		</DynSentence>
		<DynSentence name="MultiQuery3">
			<Sentence>
			SELECT * FROM sfmcusagra WHERE ActNo='%s'
			</Sentence>
			<Fields>ActNo|</Fields>
		</DynSentence>
		
		<FlowCtrl>
			<If condition="$TxnTyp=0">
			<Exec func="PUB:OpenCursor" error="IGNORE">
				<Arg name="SqlCmd"  value="MultiQuery0"/>
				<Arg name="RecKey"  value="$CrtDat"/>
			</Exec>
			<If condition="~RetCod!=0">
				<Exec func="PUB:RollbackWork" error="IGNORE" />
				<Exec func="PUB:Unlock">
					<Arg name="RecKey" value="STRCAT($BrNo,$AplCls,$TxnCod)"/>
				</Exec>
				<Set>MsgTyp=E</Set>
				<Set>RspCod=PFA999</Set>
				<Set>RspMsg=打开游标【XX39】出错</Set>
				<Return/>
			</If>
			<Set>SndFil=STRCAT(SFMTB,DELBOTHSPACE($NodTrc),.dat)</Set>
      <Set>RtnFil=STRCAT(dat/sfm/,$SndFil)</Set>
			<While>
				<Exec func="PUB:FetchCursor" error="IGNORE"/>
				<If condition="~RetCod=100">
					<Break/>
				</If>
				<Exec func="PUB:WriteFile" error="IGNORE">
					<Arg name="FileName" value="$RtnFil"/>
					<Arg name="OpenMode" value="a+"/>
					<Arg name="Data"	   value="ADDCHAR($BrNo,6, ,0)"/> 
					<Arg name="Data"	   value="ADDCHAR($AgrNo,13, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($CusId,13, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($ActNo,21, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($IsdAct,21, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($IdTyp,2, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($IdNo,30, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($UniNo,4, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($MobTel,15, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($FeeTyp,1, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($PyrTyp,1, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($PyrAct,21, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($PyrNo,5, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($SndFlg,1, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($CrtDat,8, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($CrtNod,6, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($CrtTlr,7, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($ActDat,8, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($NodNo,6, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($TlrId,7, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($AltAmt,1, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($AmtLmt,15,0,1)"/>
					<Arg name="Data"	   value="ADDCHAR($Flg1,1, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($Flg2,1, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($Flg3,1, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($Flg4,1, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($Flg5,1, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($Flg6,1, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($Flg7,1, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($Free1,1, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($Free2,1, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($Free3,1, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($ActTyp,1, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($Status,1, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($TxnCnla,1, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($RsFld1,32, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($RsFld2,32, ,0)"/>
					<Arg name="Data"	   value="ADDCHAR($RsFld3,32, ,0)"/>
					<Arg name="ESCFMT"   value="\\n"/>
				</Exec>
			</While>
			<Exec func="PUB:CloseCursor" error="IGNORE"/>
<!--判断返回文件是否存在-->
			<Exec func="PUB:IsExistFile" error="IGNORE">
				<Arg name="FileName" value="STRCAT(GETENV(WORKDIR),/,$RtnFil)"/>
			</Exec>
      <If condition="~RetCod=0">
				<Set>BrNo=441999</Set>
				<Set>SfmFil=$SndFil</Set>
				<Set>IcsFil=$SndFil</Set>
				<Set>msglen=00000020</Set>
				<Exec func="PUB:FtpPut">
					<Arg name="FtpId" value="SFMTB1"/>
				</Exec>
				<Exec func="PUB:CommitWork"/>
	      <If condition="~RetCod!=0">
					<Exec func="PUB:RollbackWork" error="IGNORE" />
					<Exec func="PUB:Unlock">
						<Arg name="RecKey" value="STRCAT($BrNo,$AplCls,$TxnCod)"/>
					</Exec>
					<Set>MsgTyp=E</Set>
					<Set>RspCod=PFA999</Set>
					<Set>RspMsg=发送文件到短信平台失败</Set>
	        <Return/>
	      </If>
	    </If>
			<Exec func="PUB:Unlock">
				<Arg name="RecKey" value="STRCAT($BrNo,$AplCls,$TxnCod)"/>
			</Exec>
			<Set>MsgTyp=N</Set>
			<Set>RspCod=000000</Set>
			<Set>RspMsg=发送文件到短信平台成功</Set>
			</If>
			<ElseIf condition="$TxnTyp=1">
			<Exec func="PUB:MultiQuery">
				<Args>
					<Arg name="SqlCmd"  value="MultiQuery1"/>
					<Arg name="RecKey"  value="$MobTel"/>
					<Arg name="RecNumPerPage"  value="200"/>
				</Args>
			</Exec>
			</ElseIf>
			<ElseIf condition="$TxnTyp=2">
			<Exec func="PUB:MultiQuery">
				<Args>
					<Arg name="SqlCmd"  value="MultiQuery2"/>
					<Arg name="RecKey"  value="$CusId"/>
					<Arg name="RecNumPerPage"  value="200"/>
				</Args>
			</Exec>
			</ElseIf>
			<ElseIf condition="$TxnTyp=3">
			<Exec func="PUB:MultiQuery">
				<Args>
					<Arg name="SqlCmd"  value="MultiQuery3"/>
					<Arg name="RecKey"  value="$ActNo"/>
					<Arg name="RecNumPerPage"  value="200"/>
				</Args>
			</Exec>
			</ElseIf>
		</FlowCtrl>
	</Transaction>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<!-- 20120816 补丁内容：手机银行，个人网银签约交易-->
	
	<!-- 自助通渠道客户签约标志 渠道包括 网银，手机银行，自助通-->
	<Transaction code="482170" desc="客户签约查询">
		<DynSentence name="IsCrdExist"><!--查询短信签约信息 -->
			<Sentence>
				SELECT count(*) isExit FROM LSHACONTRACT WHERE CRDNO='%s'
			</Sentence>
			<Fields>CrdNo|</Fields>
		</DynSentence>
		
		
	  <FlowCtrl>
		<Exec func="PUB:InitTransaction"/>
		<Exec func="PUB:GetAppInfo"/>
		
		
		<!--Get the crdno passed from the netbank -->
		<Set>CrdNo=DELSPACE($CrdNo,all)</Set>
		
		
		<Exec func="PUB:ReadRecord">  <!--查询 -->
				<Arg name="SqlCmd" value="IsCrdExist"/>
		</Exec>
		<If condition="~RetCod=-1">
        <Set>MsgTyp=E</Set> 
        <Set>RspCod=SSA999</Set>
        <Set>RspMsg=数据库查询失败</Set>
        <Return/>
    </If>
		<!--Query the contract table whether contains the crdno -->
		<!-- if the isExit bigger than 0 which means the crdno has already signed the contract -->
		<If condition="INTCMP($isExit,3,0)"> <!-- 3: 代表=符号 --> 
			<Set>QryRst=F</Set> <!-- 代表没有签约-->
		</If>
		<ElseIf condition="INTCMP($isExit,6,0)"> <!-- : 代表 大于 符号 --> 
			<Set>QryRst=T</Set><!-- 代表已经签约-->
		</ElseIf>
		
		
		</FlowCtrl>
	</Transaction>
	
	
	
	<!-- 自助通渠道客户签约标志 渠道包括 网银，手机银行，自助通-->
	<Transaction code="482171" desc="客户签约注册">
	  <DynSentence name="QryCrdInfo"><!--查询短信签约信息 -->
			<Sentence>
				SELECT ACTNAM cusnam, IDNO idno FROM agtcrdrec WHERE CRDNO='%s'
			</Sentence>
			<Fields>CrdNo|</Fields>
		</DynSentence>
		<DynSentence name="InsertCard"><!--查询短信签约信息 -->
			<Sentence>
				Insert INTO LSHACONTRACT VALUES ('%s','%s','%s')
			</Sentence>
			<Fields>CrdNo|IDNO|CusNam|</Fields>
		</DynSentence>
		
		
	  <FlowCtrl>
		     <Exec func="PUB:InitTransaction"/>
		     <Exec func="PUB:GetAppInfo"/>
		     
		     
		     <!--Get the crdno passed from the netbank -->
		     <Set>CrdNo=DELSPACE($CrdNo,all)</Set>
		     <Set>IDNO= </Set>
		     <Set>CusNam= </Set>
	       
		     <Set>isSuccess=U</Set>
		     
		     <!--
		     <Exec func="PUB:ReadRecord"> 
		     		<Arg name="SqlCmd" value="QryCrdInfo"/>
		     </Exec>
		     <If condition="~RetCod=-1">
             <Set>MsgTyp=E</Set> 
             <Set>RspCod=SSA999</Set>
             <Set>RspMsg=数据库查询失败</Set>
             <Return/>
         </If>
          -->
         
         
         
		     
		     <Exec func="PUB:ExecSql" error="IGNORE">
		     		<Arg name="SqlCmd" value="InsertCard" />
		     </Exec>
		     <If condition="~RetCod!=0">
             <Set>isSuccess=F</Set>
         </If>
         <ElseIf condition="~RetCod=0">
         	 <Set>isSuccess=T</Set>
         </ElseIf>
		 </FlowCtrl>
	</Transaction>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</Application>
