<?xml version='1.0' encoding='ISO-8859-1'?>
<Application name="UNC" code="206">
  <!--电力电费业务本地主控-->
  <ConfigDeclare>
    <!--Config name="BatFormat"   value="etc/UNCA_FMT_441999.XML"/-->
    <Config name="ParaFile"    value="etc/CFG_UNCA_441999.XML"/>
    <Config name="OPFCSW"      value="etc/CSW_UNCA_441999.XML"/>
  </ConfigDeclare>
  <BusDefDeclare>
    <Busdef name="BrNo"      value="441999"/>
    <Busdef name="AplCls"    value="445"/>
  </BusDefDeclare>
  <PackageDeclare>
    <Package name="AFE"        value="etc/DAFE_PKG.XML"/>
  </PackageDeclare>
  <TableDeclare>
    <Table name="afetxnjnl"    value="afetxnjnl"/>  <!--业务流水表-->
    <Table name="afebatrec"    value="afebatrec"/>  <!--批量扩展表-->
  </TableDeclare>
  <GlobalFunction>
    <Include file="etc/ActJudge_IIT.XML"/>     <!--区别对公对私帐号-->
    <!--add by xuan_20101108-->
    <Function name="_after">
      <Process>
        <If condition="ISNULL($MsgTyp)">
          <If condition="ISNULL(DELBOTHSPACE($RspCod))"> <!--若RspCod为空，则认为成功-->
            <Set>MsgTyp=N</Set>
            <Set>RspCod=000000</Set>
          </If>
          <Else>
            <If condition="IS_NOEQUAL_STRING($RspCod,000000)"> <!--返回码不为000000-->
              <Set>MsgTyp=E</Set>
            </If>
            <Else>
              <Set>MsgTyp=N</Set>
            </Else>
          </Else>
        </If>
      </Process>
    </Function>
  <!--end by xuan_20101108-->
  </GlobalFunction>
  <Define>
    <!--检查交易来源,并增加交易受理渠道(471140接口)字段-->
    <Macro name="Chk_TxnSrc">
      <If condition="INTCMP(STRLEN(DELBOTHSPACE($TxnSrc)),3,0)">
        <Set>TxnCnl=TRM</Set>
        <Set>CnlTyp=0</Set>
      </If>
      <Else>
        <Set>TxnSrc=DELBOTHSPACE($TxnSrc)</Set>
        <Exec func="PUB:CodeSwitching">
          <Arg name="DatSrc"  value="OPFCSW"/>
          <Arg name="SourNam" value="TxnSrc"/>
          <Arg name="DestNam" value="CnlTyp"/>
          <Arg name="TblNam"  value="TxnSrc2CnlTyp"/>
        </Exec>
      </Else>
    </Macro>
  
    <!-- 通过交易来源,增加交易渠道字段,用于交易流水表字段 -->
    <Macro name="TxnSrc_TxnCnl">
      <Set>TxnSrc=DELBOTHSPACE($TxnSrc)</Set>
      <Exec func="PUB:CodeSwitching">
        <Arg name="DatSrc"  value="OPFCSW"/>
        <Arg name="SourNam" value="TxnSrc"/>
        <Arg name="DestNam" value="TxnCnl"/>
        <Arg name="TblNam"  value="TxnSrc2TxnCnl"/>
      </Exec>
    </Macro>
  
  </Define>

  <Transaction code="484502" desc="终端签到认证2">
    <FlowCtrl>
      <Exec func="PUB:InitTransaction"/>
      
      <Exec func="PUB:CallThirdOther">
        <Arg name="HTxnCd" value="484502"/>
        <Arg name="ObjSvr" value="STDAYCT2"/>
      </Exec>
      <If condition="$RspCod!=000000">
        <Set>RspCod=YCT999</Set>
        <Set>MsgTyp=E</Set>
        <Set>RspMsg=签到失败!</Set>
        <Return/>
      </If>
      <Set>RspCod=000000</Set>
      <Set>MsgTyp=N</Set>

    </FlowCtrl>
  </Transaction>


</Application>